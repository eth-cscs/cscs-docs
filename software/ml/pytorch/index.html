
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.cscs.ch/software/ml/pytorch/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../../tutorials/ml/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>PyTorch - CSCS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pytorch" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="CSCS Documentation" class="md-header__button md-logo" aria-label="CSCS Documentation" data-md-component="logo">
      
  <img src="../../../assets/cscs-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CSCS Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PyTorch
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/eth-cscs/cscs-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CSCS Documentation" class="md-nav__button md-logo" aria-label="CSCS Documentation" data-md-component="logo">
      
  <img src="../../../assets/cscs-logo.png" alt="logo">

    </a>
    CSCS Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eth-cscs/cscs-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../alps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Alps
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Alps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alps/platforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Platforms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../clusters/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Clusters
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Clusters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/besso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Besso
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/bristen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bristen
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/clariden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clariden
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/daint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Daint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/eiger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eiger
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/santis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Santis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alps/hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alps/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../platforms/mlp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Machine Learning Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Machine Learning Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/clariden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clariden
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/bristen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bristen
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../platforms/hpcp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    HPC Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            HPC Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/daint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Daint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/eiger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eiger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../platforms/cwp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Climate and Weather Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Climate and Weather Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clusters/santis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Santis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../access/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Connecting to Alps
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Connecting to Alps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../access/mfa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi Factor Authentication (MFA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../access/web/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../access/ssh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../access/firecrest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FirecREST
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../access/hpc-console/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HPC Console
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../access/jupyterlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JupyterLab
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../access/vscode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../running/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Running Jobs
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Running Jobs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../running/slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slurm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../running/hyperqueue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HyperQueue
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../running/known-issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known issues
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../environments/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Environments
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Environments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/terminal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started in the terminal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../uenv/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    uenv
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            uenv
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../uenv/configure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../uenv/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../uenv/deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../uenv/release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../container-engine/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Container Engine
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Container Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../container-engine/run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the Container Engine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../container-engine/resource-hook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hooks and native resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../container-engine/edf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EDF reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../container-engine/known-issue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known issues
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../build-install/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Building and Installing Software
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Building and Installing Software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../prgenv/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Programming Environments
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Programming Environments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prgenv/prgenv-gnu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prgenv-gnu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prgenv/prgenv-nvfortran/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prgenv-nvfortran
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prgenv/linalg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linalg
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prgenv/julia/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    julia
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prgenv/cpe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cray modules (CPE)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How to build software
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            How to build software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../build-install/uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uenv
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Packaging and Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Packaging and Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../uenv/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../build-install/containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating Containers with podman
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Applications and Frameworks
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Applications and Frameworks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../sciapps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Scientific Applications
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Scientific Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sciapps/cp2k/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CP2K
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sciapps/gromacs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GROMACS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sciapps/lammps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LAMMPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sciapps/namd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NAMD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sciapps/quantumespresso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantum ESPRESSO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sciapps/vasp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VASP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Machine Learning
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Machine Learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    PyTorch
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    PyTorch
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#running-pytorch-with-the-container-engine-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Running PyTorch with the Container Engine (recommended)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running PyTorch with the Container Engine (recommended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-the-base-image" class="md-nav__link">
    <span class="md-ellipsis">
      Select the base image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-container-runtime-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Define Container Runtime Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optionally-extend-container-with-virtual-environment" class="md-nav__link">
    <span class="md-ellipsis">
      (Optionally) extend container with virtual environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submit-jobs-with-the-container-engine-in-slurm" class="md-nav__link">
    <span class="md-ellipsis">
      Submit jobs with the Container Engine in Slurm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Known Issues
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-pytorch-with-a-uenv" class="md-nav__link">
    <span class="md-ellipsis">
      Running PyTorch with a uenv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running PyTorch with a uenv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#versioning" class="md-nav__link">
    <span class="md-ellipsis">
      Versioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      How to use
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-python-packages-on-top-of-the-uenv" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Python packages on top of the uenv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-pytorch-jobs-with-slurm" class="md-nav__link">
    <span class="md-ellipsis">
      Running PyTorch jobs with Slurm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tutorials/ml/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3_3" id="__nav_7_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/ml/llm-inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Inference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/ml/llm-fine-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Fine-tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/ml/llm-nanotron-training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Pre-training
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cw/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Climate and Weather
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Climate and Weather
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cw/wrf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WRF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cw/netcdf-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    netcdf-tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../communication/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Communication Libraries
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Communication Libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../communication/cray-mpich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cray MPICH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../communication/mpich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MPICH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../communication/openmpi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenMPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../communication/nccl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NCCL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../communication/rccl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RCCL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../communication/libfabric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    libfabric
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../commercial/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Commercial software
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            Commercial software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commercial/matlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Matlab
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../sciviz/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Scientific Visualization
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            Scientific Visualization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sciviz/paraview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ParaView
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../unsupported/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prohibited Software
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../devtools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Debugging and Performance Analysis
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Debugging and Performance Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devtools/nvidia-nsight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using NVIDIA Nsight
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Using Linaro Forge
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Using Linaro Forge
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devtools/linaro-uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linaro uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devtools/linaro-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linaro performance analysis tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devtools/linaro-ddt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linaro debugger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devtools/vihps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Score-P/Scalasca
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../running/jobreport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job report
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../storage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Data Management and Storage
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Data Management and Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../storage/filesystems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Systems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../storage/transfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Transfer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../storage/longterm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Long Term Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../storage/object/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Object Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../services/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../services/devportal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Portal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../services/cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../services/kubernetes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../services/kubernetes/clusters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clusters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../services/kubernetes/kubernetes-upgrades/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes Upgrades
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../services/kubernetes/node-updates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node OS Updates
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../accounts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Accounts and Projects
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Accounts and Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../accounts/ump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Account and Resources Management Tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../accounts/waldur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project and Resources Management Tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../accounts/account-create/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating a new account
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../guides/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/internet-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internet Access on Alps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../policies/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Policies
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13" id="__nav_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Policies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../policies/regulations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Regulations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../policies/code-of-conduct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../policies/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Support Policies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../policies/slack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slack Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../policies/maintenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scheduled Maintenance and System Unavailability Policies
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../contributing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#running-pytorch-with-the-container-engine-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Running PyTorch with the Container Engine (recommended)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running PyTorch with the Container Engine (recommended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-the-base-image" class="md-nav__link">
    <span class="md-ellipsis">
      Select the base image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-container-runtime-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Define Container Runtime Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optionally-extend-container-with-virtual-environment" class="md-nav__link">
    <span class="md-ellipsis">
      (Optionally) extend container with virtual environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submit-jobs-with-the-container-engine-in-slurm" class="md-nav__link">
    <span class="md-ellipsis">
      Submit jobs with the Container Engine in Slurm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Known Issues
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-pytorch-with-a-uenv" class="md-nav__link">
    <span class="md-ellipsis">
      Running PyTorch with a uenv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running PyTorch with a uenv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#versioning" class="md-nav__link">
    <span class="md-ellipsis">
      Versioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      How to use
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-python-packages-on-top-of-the-uenv" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Python packages on top of the uenv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-pytorch-jobs-with-slurm" class="md-nav__link">
    <span class="md-ellipsis">
      Running PyTorch jobs with Slurm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/eth-cscs/cscs-docs/edit/main/docs/software/ml/pytorch.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  


<p><a href="" id="ref-software-pytorch"></a></p>
<h1 id="pytorch">PyTorch<a class="headerlink" href="#pytorch" title="Permanent link">&para;</a></h1>
<div class="admonition info">
<p>PyTorch is <a class="autorefs autorefs-internal" title="Officially Supported Applications" href="../../../policies/support/#officially-supported-applications">supported software</a> on Alps.
See the <a class="autorefs autorefs-internal" title="Applications and frameworks" href="../../#applications-and-frameworks">main applications page</a> for more information.</p>
</div>
<p>PyTorch is available both as a container with the <a class="autorefs autorefs-internal" href="../../container-engine/#container-engine">Container Engine (CE)</a> and a <a class="autorefs autorefs-internal" href="../../uenv/#uenv">uenv</a> software stack. The best choice for your use case depends on the amount of control required over the lower level libraries.</p>
<p>While NGC provides an optimized build of PyTorch with many dependencies included, uenv allows a more flexible choice of lower level libraries and represents a thinner layer over the host system. Both options can be customized - a container via a Dockerfile and a uenv (in advanced use cases) via its recipe and both, additionally, via Python virtual environments built on top. Due to the simplicity and reproducible performance, containers are generally the recommended default for most users.</p>
<p><a href="" id="ref-ce-pytorch"></a></p>
<h2 id="running-pytorch-with-the-container-engine-recommended">Running PyTorch with the Container Engine (recommended)<a class="headerlink" href="#running-pytorch-with-the-container-engine-recommended" title="Permanent link">&para;</a></h2>
<p>Running PyTorch from a container ensures maximum portability, reproducibility, and ease of use across machines. This is achieved by </p>
<ol>
<li>selecting an appropriate base image and customizing it in a Dockerfile</li>
<li>defining the container runtime environment in an EDF</li>
<li>(optionally) extending with a virtual environment</li>
<li>submitting jobs with CE in SLURM </li>
</ol>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>These steps are illustrated in the <a class="autorefs autorefs-internal" title="Machine Learning Platform Tutorials" href="../../../tutorials/ml/#machine-learning-platform-tutorials">machine learning tutorials</a> and the instructions detailed in the <a class="autorefs autorefs-internal" title="Building container images on Alps" href="../../../build-install/containers/#building-container-images-on-alps">podman build guide</a>.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Preliminary steps</p>
<p>Before proceeding with the next steps, make sure you have storage for podman configured as in the <a class="autorefs autorefs-internal" title="Preliminary step: configuring Podmanwzxhzdk:8s storage" href="../../../build-install/containers/#preliminary-step-configuring-podmans-storage">build guide</a> and make sure to apply <a class="autorefs autorefs-internal" title="Lustre tuning" href="../../../guides/storage/#lustre-tuning">recommended Lustre settings</a> to every directory (e.g. <code>$SCRATCH/ce-images</code>) dedicated to container images before importing them with enroot. This is necessary to guarantee good filesystem performance.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>lfs<span class="w"> </span>setstripe<span class="w"> </span>-E<span class="w"> </span>4M<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-E<span class="w"> </span>64M<span class="w"> </span>-c<span class="w"> </span><span class="m">4</span><span class="w"> </span>-E<span class="w"> </span>-1<span class="w"> </span>-c<span class="w"> </span>-1<span class="w"> </span>-S<span class="w"> </span>4M<span class="w"> </span><span class="nv">$SCRATCH</span>/ce-images<span class="w"> </span><span class="c1"># (1)!</span>
</span></code></pre></div>
<ol>
<li>This makes sure that files stored subsequently end up on the same storage node (up to 4 MB), on 4 storage nodes (between 4 and 64 MB) or are striped across all storage nodes (above 64 MB)</li>
</ol>
</div>
<h3 id="select-the-base-image">Select the base image<a class="headerlink" href="#select-the-base-image" title="Permanent link">&para;</a></h3>
<p>For most applications, the <a href="https://catalog.ngc.nvidia.com/orgs/nvidia/containers/pytorch">PyTorch NGC container</a> is a good base image as PyTorch comes pre-installed with an optimized build including many dependencies. The <a href="https://docs.nvidia.com/deeplearning/frameworks/pytorch-release-notes/index.html">Release Notes</a> give an overview of installed packages and compatibility. This image can be further customized in a Dockerfile and built with podman as detailed in the <a class="autorefs autorefs-internal" title="Building container images on Alps" href="../../../build-install/containers/#building-container-images-on-alps">podman build guide</a>.</p>
<h3 id="define-container-runtime-environment">Define Container Runtime Environment<a class="headerlink" href="#define-container-runtime-environment" title="Permanent link">&para;</a></h3>
<p>Having built and imported a container image with podman and enroot, the next step is to configure the runtime environment with an environment definition file (EDF). In particular, this includes specifying the image, any directories mounted from the host and a working directory for the process in the container to start in as in the <a class="autorefs autorefs-internal" title="Container Engine" href="../../container-engine/#container-engine">quickstart examples for CE</a>.</p>
<p>Apart from this, there are specific features relevant for machine learning made available through <a class="autorefs autorefs-internal" title="Annotations" href="../../container-engine/resource-hook/#annotations">annotations</a>, which customize the container at runtime.</p>
<ul>
<li>When using NCCL inside the container, include the <a class="autorefs autorefs-internal" title="AWS OFI NCCL hook" href="../../container-engine/resource-hook/#aws-ofi-nccl-hook">aws-ofi-nccl</a> plugin which enables the container to interface with the host&rsquo;s libfabric and, thus, use the Slingshot high-speed interconnect. This is crucial for multi-node communication performance.</li>
<li>An <a class="autorefs autorefs-internal" title="SSH hook" href="../../container-engine/resource-hook/#ssh-hook">SSH annotation</a> allows adding a light-weight SSH server to the container without the need to modify the container image</li>
</ul>
<p>A resulting example TOML file following best practices may look like</p>
<div class="language-toml highlight"><span class="filename">$HOME/my-app/ngc-pytorch-my-app-25.06.toml</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${SCRATCH}/ce-images/ngc-pytorch-my-app+25.06.sqsh&quot;</span><span class="w"> </span><span class="c1"># (1)!</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">mounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="s2">&quot;/capstor&quot;</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="s2">&quot;/iopsstor&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="s2">&quot;/users/${USER}/my-app&quot;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="p">]</span><span class="w"> </span><span class="c1"># (2)!</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">workdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${HOME}/my-app&quot;</span><span class="w"> </span><span class="c1"># (3)!</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="k">[annotations]</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="n">com</span><span class="p">.</span><span class="n">hooks</span><span class="p">.</span><span class="n">aws_ofi_nccl</span><span class="p">.</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="c1"># (4)!</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="n">com</span><span class="p">.</span><span class="n">hooks</span><span class="p">.</span><span class="n">aws_ofi_nccl</span><span class="p">.</span><span class="n">variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cuda12&quot;</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="k">[env]</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="n">NCCL_DEBUG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="w"> </span><span class="c1"># (5)!</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="n">CUDA_CACHE_DISABLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="c1"># (6)!</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="n">TORCH_NCCL_ASYNC_ERROR_HANDLING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="c1"># (7)!</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="n">MPICH_GPU_SUPPORT_ENABLED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="c1"># (8)!</span>
</span></code></pre></div>
<ol>
<li>It is important to use curly braces for environment variables used in the EDF</li>
<li>The path <code>/users</code> is not mounted as a whole since it often contains user-specific initialization scripts for the host environment and many frameworks leave temporary data behind that can lead to non-trivial runtime errors when swapping container images. Thus, it is recommended to selectively mount specific subfolders under <code>${HOME}</code> if needed.</li>
<li>You can use <code>${PWD}</code> as an alternative to use the path submitted from when the container is started</li>
<li>This enables NCCL installed in the container to make effective use of the Slingshot interconnect on Alps by interfacing with the <a class="autorefs autorefs-internal" title="AWS OFI NCCL hook" href="../../container-engine/resource-hook/#aws-ofi-nccl-hook">AWS OFI NCCL plugin</a>. While not strictly needed for single node workloads, it is good practice to keep it always on.</li>
<li>This makes NCCL output debug info during initialization, which can be useful to spot communication-related issues in a distributed scenario. Subsystems with debug log can be configured with <a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-debug-subsys"><code>NCCL_DEBUG_SUBSYS</code></a>.</li>
<li>Avoid writing JITed binaries to the (distributed) file system, which could lead to performance issues.</li>
<li>Async error handling when an exception is observed in NCCL watchdog: aborting NCCL communicator and tearing down process upon error</li>
<li>Disable GPU support in MPICH, as it can lead to deadlocks when using together with NCCL</li>
</ol>
<details class="note">
<summary>Access to SLURM from inside the container</summary>
<p>In case access to SLURM is required from inside the container, you can add the following lines to the mounts above:</p>
<div class="language-toml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">...</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">mounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">   </span><span class="s2">&quot;/capstor&quot;</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">   </span><span class="s2">&quot;/iopsstor&quot;</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">   </span><span class="s2">&quot;/users/${USER}/my-app&quot;</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">   </span><span class="s2">&quot;/etc/slurm&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1"># (1)!</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">   </span><span class="s2">&quot;/usr/lib64/libslurm-uenv-mount.so&quot;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">   </span><span class="s2">&quot;/etc/container_engine_pyxis.conf&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="p">]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="p">...</span>
</span></code></pre></div>
<ol>
<li>Enable Slurm commands (together with two subsequent mounts)</li>
</ol>
</details>
<div class="admonition note">
<p class="admonition-title">Best practice for production jobs</p>
<p>For stability and reproducibility, use self-contained containers for production jobs. Using code mounted from the distributed filesystem may leave compiled artefacts behind that can result in unintentional runtime errors when e.g. swapping the container image. In particular, it is recommended to avoid mounting all of <code>$HOME</code>, so that environments are properly isolated and e.g. the Triton cache (that by default ends up in <code>$HOME/.triton</code>) resides in an ephemeral location of the filesystem.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Collaborating in Git</p>
<p>For reproducibility, it is recommended to always track the Dockerfile, EDF and an optional virtual environment specification alongside your application code in a Git repository.</p>
</div>
<p><a href="" id="ref-ce-pytorch-venv"></a></p>
<h3 id="optionally-extend-container-with-virtual-environment">(Optionally) extend container with virtual environment<a class="headerlink" href="#optionally-extend-container-with-virtual-environment" title="Permanent link">&para;</a></h3>
<p>While production jobs should include as many dependencies as possible in the container image, during development it can be convenient to manage frequently changing packages in a virtual environment built on top of the container image. This can include both dependencies and actively developed packages (that can be installed in editable mode with <code>pip install -e .</code>).</p>
<p>To create such a virtual environment, <em>inside the container</em> use the Python <code>venv</code> module with the option <code>--system-site-packages</code> to ensure that packages are installed <em>in addition</em> to the existing packages. Without this option, packages may accidentally be re-installed shadowing a version that is already present in the container.
A workflow installing additional packages in a virtual environment may look like this:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="gp">[clariden-lnXXX]$ </span>srun<span class="w"> </span>-A<span class="w"> </span>&lt;ACCOUNT&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span>--environment<span class="o">=</span>./ngc-pytorch-my-app-25.06.toml<span class="w"> </span>--pty<span class="w"> </span>bash<span class="w"> </span><span class="c1"># (1)!</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="gp">user@nidYYYYYY$ </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>--system-site-packages<span class="w"> </span>venv-ngc-pt-25.06<span class="w"> </span><span class="c1"># (2)!</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="gp">user@nidYYYYYY$ </span><span class="nb">source</span><span class="w"> </span>venv-ngc-pt-25.06/bin/activate<span class="w"> </span><span class="c1"># (3)!</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="gp gp-VirtualEnv">(venv-ngc-pt-25.06)</span> <span class="gp">user@nidYYYYYY$ </span>pip<span class="w"> </span>install<span class="w"> </span>&lt;package&gt;<span class="w">  </span><span class="c1"># (3)!</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="gp gp-VirtualEnv">(venv-ngc-pt-25.06)</span> <span class="gp">user@nidYYYYYY$ </span><span class="nb">exit</span>
</span></code></pre></div>
<ol>
<li>Allocate an interactive session on a compute node</li>
<li>Create a virtual environment on top of the existing Python installation in the container (only necessary the first time)</li>
<li>Activate the newly created virtual environment (always necessary when running a Slurm job)</li>
<li>Install additional packages (only run this from a single process to avoid race conditions)</li>
</ol>
<p>The changes made to the virtual environment will outlive the container as they are persisted on the distributed filesystem.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keep in mind that:</p>
<ul>
<li>this virtual environment is <em>specific</em> to this particular container and won&rsquo;t actually work unless you are using it from inside this container - it relies on the resources packaged inside the container.</li>
<li>every Slurm job making use of this virtual environment will need to activate it first (<em>inside</em> the <code>srun</code> command). </li>
</ul>
</div>
<h3 id="submit-jobs-with-the-container-engine-in-slurm">Submit jobs with the Container Engine in Slurm<a class="headerlink" href="#submit-jobs-with-the-container-engine-in-slurm" title="Permanent link">&para;</a></h3>
<p>A general template for a Pytorch distributed training job with Slurm in analogy to the <a class="autorefs autorefs-internal" title="LLM Nanotron Pre-training Tutorial" href="../../../tutorials/ml/llm-nanotron-training/#llm-nanotron-pre-training-tutorial">last tutorial</a> may look like</p>
<div class="language-bash highlight"><span class="filename">$HOME/my-app/submit-dist-train.sh</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1">#SBATCH --account=&lt;ACCOUNT&gt;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1">#SBATCH --job-name=dist-train-ddp</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1">#SBATCH --time=01:00:00</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="c1">#SBATCH --nodes=2</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1">#SBATCH --ntasks-per-node=4</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1">#SBATCH --output=logs/slurm-%x-%j.log</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="c1"># (1)!</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="nb">ulimit</span><span class="w"> </span>-c<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># (2)!</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w"> </span><span class="c1"># (3)!</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w"> </span><span class="c1"># (4)!</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>srun<span class="w"> </span>-ul<span class="w"> </span>--environment<span class="o">=</span>./ngc-pytorch-my-app-25.06.toml<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="s2">    . venv-ngc-pt-25.06/bin/activate  # activate (optional) venv</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="s2">    MASTER_ADDR=\$(scontrol show hostnames \$SLURM_JOB_NODELIST | head -n 1) \</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="s2">    MASTER_PORT=29500 \</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="s2">    RANK=\${SLURM_PROCID} \</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="s2">    LOCAL_RANK=\${SLURM_LOCALID} \</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="s2">    WORLD_SIZE=\${SLURM_NTASKS} \</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="s2">    python dist-train.py &lt;dist-train-args&gt;</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="s2">&quot;</span>
</span></code></pre></div>
<ol>
<li>If <code>#SBATCH --error=...</code> is not specified, <code>#SBATCH --output</code> will also contain stderr (error messages)</li>
<li>In case the application crashes, it may leave behind large core dump files that contain an image of the process memory at the time of the crash. While these can be useful for debugging the reason of a specific crash (by e.g. loading them with <code>cuda-gdb</code> and looking at the stack trace with <code>bt</code>), they may accumulate over time and occupy a large space on the filesystem. For this reason, it is recommended to disable their creation (unless needed) by adding this line.</li>
<li>Loading the virtual environment is mandatory within every <code>srun</code> command if it is used to manage packages.</li>
<li>The environment variables are set to initialize PyTorch&rsquo;s distributed module through the environment (cf. <a href="https://docs.pytorch.org/docs/stable/distributed.html#environment-variable-initialization">docs</a>).</li>
</ol>
<p>For further details on execution logic, job monitoring and data management, please refer to the <a class="autorefs autorefs-internal" title="LLM Nanotron Pre-training Tutorial" href="../../../tutorials/ml/llm-nanotron-training/#llm-nanotron-pre-training-tutorial">nanotron tutorial</a> (which in particular also explains the usage of <code>torchrun</code> with Slurm). Make sure to apply <a class="autorefs autorefs-internal" title="Lustre tuning" href="../../../guides/storage/#lustre-tuning">recommended Lustre settings</a> to datasets, models and container images persisted to the distributed filesystem.</p>
<div class="admonition warning">
<p class="admonition-title">#SBATCH &ndash;environment</p>
<p>The operations performed before the <code>srun</code> command are executed in the host environment of a single compute node in the allocation. If you need to perform these steps in the container environment as well, you can alternatively use the <code>#SBATCH --environment=path/to/ngc-pytorch-my-app-25.06.toml</code> option <em>instead of</em> using <code>--environment</code> with <code>srun</code>.</p>
<p>Use of the <code>--environment</code> option for <code>sbatch</code> is still considered experimental and could result in unexpected behavior. In particular, avoid mixing <code>#SBATCH --environment</code> and <code>srun --environment</code> in the same job.</p>
<p>Use of <code>--environment</code> is currently only recommended for the <code>srun</code> command. </p>
</div>
<div class="admonition note">
<p class="admonition-title">Optimizing large-scale training jobs</p>
<p>The following settings were established to <strong>improve compute throughput</strong> of LLM training in <a href="https://github.com/NVIDIA/Megatron-LM">Megatron-LM</a>:</p>
<ul>
<li>
<p>Extensively evaluate all possible parallelization dimensions, including data-, tensor- and pipeline parallelism (including virtual pipeline parallelism) and more, when available. Identify storage-related bottlenecks by isolating data loading/generation operations into a separate benchmark.</p>
</li>
<li>
<p><a class="autorefs autorefs-internal" title="Transparent hugepages" href="../../../running/slurm/#transparent-hugepages">Disabling transparent huge pages</a> and <a class="autorefs autorefs-internal" title="NVIDIA vboost" href="../../../running/slurm/#nvidia-vboost">enabling the Nvidia vboost feature</a> has been observed to improve performance in large-scale LLM training in Megatron-LM. This can be achieved by adding these constraints to the sbatch script:
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">#SBATCH -C thp_never&amp;nvidia_vboost_enabled</span>
</span></code></pre></div></p>
</li>
<li>
<p>The argument <code>--ddp-bucket-size</code> controls the level of grouping of many small data-parallel communications into bigger ones and setting it to a high value can improve throughput (model-dependent, e.g. <code>10000000000</code>).</p>
</li>
<li>
<p>If in doubt about communication performance with NCCL at scale, use the <a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-debug"><code>NCCL_DEBUG</code></a> environment variable to validate that the aws-ofi-nccl plugin has been properly initialized and libfabric was recognized (further subsystems can be monitored with <a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-debug-subsys"><code>NCCL_DEBUG_SUBSYS</code></a>). If the issue persists, use <a href="https://github.com/NVIDIA/nccl-tests">nccl-tests</a> with the relevant communication patterns to check if the scaling behavior can be reproduced and contact CSCS support.</p>
</li>
</ul>
<p>Additionally, consider the <strong>best practice for checkpointing and data management</strong>:</p>
<ul>
<li>
<p>Following the advice on <a class="autorefs autorefs-internal" title="File Systems" href="../../../storage/filesystems/#file-systems">filesystems</a>, write checkpoints (sequential write) to <code>/capstor/scratch</code> and place randomly accessed training data (many small random reads) on <code>/iopsstor/scratch</code>. Use the <a class="autorefs autorefs-internal" title="Data Transfer" href="../../../storage/transfer/#data-transfer">data transfer instructions</a> to move data to/from <code>/capstor/store</code>. Make sure to apply recommended <a class="autorefs autorefs-internal" title="Lustre tuning" href="../../../guides/storage/#lustre-tuning">Lustre settings</a> on all directories containing significant amount of data, including those containing container images and managed by other tools (e.g. the HuggingFace cache, see <a href="https://huggingface.co/docs/huggingface_hub/en/package_reference/environment_variables#hfhome"><code>HF_HOME</code></a> in the <a class="autorefs autorefs-internal" title="LLM Inference Tutorial" href="../../../tutorials/ml/llm-inference/#llm-inference-tutorial">this tutorial</a>). In case your workload continues to be limited by filesystem performance, contact CSCS support.</p>
</li>
<li>
<p>Regularly adjust checkpoint writing intervals to the current overhead induced by writing a checkpoint (<span class="arithmatex">\(T_1\)</span>) and mean time between job failures (<span class="arithmatex">\(T_2\)</span>). As a first order approximation use a checkpointing interval of <span class="arithmatex">\(\sqrt{2 T_1 T_2}\)</span> (derived by <a href="https://doi.org/10.1145/361147.361115">Young</a> and <a href="https://doi.org/10.1016/j.future.2004.11.016">Daly</a>).</p>
</li>
<li>
<p>Avoid activities that put excessive load on third party services (such as web scraping or bulk downloads) in line with the <a class="autorefs autorefs-internal" title="Communicating with external services" href="../../../guides/internet-access/#communicating-with-external-services">guidelines on Internet Access on Alps</a>.</p>
</li>
</ul>
<p>Adjust for <strong>cluster availability</strong>:</p>
<ul>
<li>Submit your jobs with a Slurm time limit compatible with reservations (such as maintenance windows, cf. <code>scontrol show res</code>) to be able to get scheduled.</li>
</ul>
</div>
<details class="info">
<summary>Debugging segmentation faults</summary>
<p>Application crashes with segmentation faults can be investigated by inspecting core dump files that contain an image of the process memory at the time of the crash. For this purpose, you can load the core dump file with <code>cuda-gdb</code> installed in the container and look at the stack trace with <code>bt</code>. Note that in order to generate core dump files the line <code>ulimit -c 0</code> must be commented out in the above sbatch script.</p>
</details>
<h3 id="known-issues">Known Issues<a class="headerlink" href="#known-issues" title="Permanent link">&para;</a></h3>
<p>The <a href="https://docs.nvidia.com/deeplearning/frameworks/pytorch-release-notes/index.html">Release Notes</a> of every NGC PyTorch container contain a selected list of known issues.</p>
<details class="info">
<summary>Errors hidden by failures in UCX signal handler</summary>
<p>Application errors may trigger the UCX signal handler in the NGC container, which has caused secondary failures in the past, shadowing the initial error trace. These secondary failures may be significantly harder to fix than the initial problem.</p>
<p>An example is the following trace from the NGC PyTorch 25.01 with Megatron-LM:
<div class="language-console highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="go">640: [nid007306:244443:0:244443] Caught signal 11 (Segmentation fault: address not mapped to object at address 0x455)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="go">640: ==== backtrace (tid: 244443) ====</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="go">640:  0  /opt/hpcx/ucx/lib/libucs.so.0(ucs_handle_error+0x2cc) [0x4000d2b214dc]</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="go">640:  1  /opt/hpcx/ucx/lib/libucs.so.0(+0x3168c) [0x4000d2b2168c]</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="go">640:  2  /opt/hpcx/ucx/lib/libucs.so.0(+0x319b8) [0x4000d2b219b8]</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="go">640:  3  linux-vdso.so.1(__kernel_rt_sigreturn+0) [0x4000347707dc]</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="go">640:  4  /usr/local/cuda/lib64/libnvrtc.so.12.8.61(+0x935000) [0x400140a25000]</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="go">640:  5  [0x3d5c5e58]</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="go">640: =================================</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="go">srun: error: nid007306: task 640: Segmentation fault</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="go">srun: Terminating StepId=348680.1</span>
</span></code></pre></div>
In this case, the segmentation fault in the UCX signal handler (<code>ucs_handle_error</code>) was due to a broken NVRTC in the container. However, to obtain the trace of the initial error (which was unrelated), it was necessary to disable the UCX signal handler by setting the following environment variable in the sbatch script:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">UCX_HANDLE_ERRORS</span><span class="o">=</span>none
</span></code></pre></div></p>
</details>
<details class="info">
<summary>Avoid <code>--defer-embedding-wgrad-compute</code> in Megatron-LM</summary>
<p>In Megatron-LM, avoid using the option <code>--defer-embedding-wgrad-compute</code> to delay the embedding gradient computation as it can lead to an incorrect gradient norm that changes upon resuming at different scale.</p>
</details>
<p><a href="" id="ref-uenv-pytorch"></a></p>
<h2 id="running-pytorch-with-a-uenv">Running PyTorch with a uenv<a class="headerlink" href="#running-pytorch-with-a-uenv" title="Permanent link">&para;</a></h2>
<p>The PyTorch uenv software stack was designed with the intention of being able to run <a href="https://github.com/NVIDIA/Megatron-LM">Megatron-LM</a>-based pre-training workloads out of the box.
Thus, it comes with batteries included and does not just provide the bare <a href="https://github.com/pytorch/pytorch">PyTorch framework</a>.</p>
<div class="admonition note">
<p class="admonition-title">uenv</p>
<p>The <a class="autorefs autorefs-internal" title="Running PyTorch with a uenv" href="#running-pytorch-with-a-uenv">PyTorch uenv</a> is provided via the tool <a class="autorefs autorefs-internal" href="../../uenv/#uenv">uenv</a>.
Please have a look at the <a class="autorefs autorefs-internal" href="../../uenv/#uenv">uenv documentation</a> for more information about uenvs and how to use them.</p>
</div>
<h3 id="versioning">Versioning<a class="headerlink" href="#versioning" title="Permanent link">&para;</a></h3>
<p>The PyTorch uenv is versioned according to the PyTorch version it provides.</p>
<table>
<thead>
<tr>
<th>version</th>
<th>node types</th>
<th>system</th>
</tr>
</thead>
<tbody>
<tr>
<td>v2.6.0</td>
<td>gh200</td>
<td>clariden, daint</td>
</tr>
</tbody>
</table>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">v2.6.0</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<details class="info">
<summary>non-Python packages exposed via the <code>default</code> view</summary>
<table>
<thead>
<tr>
<th>Package</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>abseil-cpp</code></td>
<td>20240722.0</td>
</tr>
<tr>
<td><code>alsa-lib</code></td>
<td>1.2.3.2</td>
</tr>
<tr>
<td><code>autoconf</code></td>
<td>2.72</td>
</tr>
<tr>
<td><code>automake</code></td>
<td>1.16.5</td>
</tr>
<tr>
<td><code>aws-ofi-nccl</code></td>
<td>1.14.0</td>
</tr>
<tr>
<td><code>berkeley-db</code></td>
<td>18.1.40</td>
</tr>
<tr>
<td><code>bison</code></td>
<td>3.8.2</td>
</tr>
<tr>
<td><code>boost</code></td>
<td>1.86.0</td>
</tr>
<tr>
<td><code>bzip2</code></td>
<td>1.0.8</td>
</tr>
<tr>
<td><code>ca-certificates-mozilla</code></td>
<td>2023-05-30</td>
</tr>
<tr>
<td><code>cmake</code></td>
<td>3.30.5</td>
</tr>
<tr>
<td><code>cpuinfo</code></td>
<td>2024-09-26</td>
</tr>
<tr>
<td><code>cray-gtl</code></td>
<td>8.1.32</td>
</tr>
<tr>
<td><code>cray-mpich</code></td>
<td>8.1.32</td>
</tr>
<tr>
<td><code>cray-pals</code></td>
<td>1.3.2</td>
</tr>
<tr>
<td><code>cray-pmi</code></td>
<td>6.1.15</td>
</tr>
<tr>
<td><code>cuda</code></td>
<td>12.6.0</td>
</tr>
<tr>
<td><code>cudnn</code></td>
<td>9.2.0.82-12</td>
</tr>
<tr>
<td><code>curl</code></td>
<td>8.10.1</td>
</tr>
<tr>
<td><code>cutensor</code></td>
<td>2.0.1.2</td>
</tr>
<tr>
<td><code>diffutils</code></td>
<td>3.10</td>
</tr>
<tr>
<td><code>eigen</code></td>
<td>3.4.0</td>
</tr>
<tr>
<td><code>elfutils</code></td>
<td>0.191</td>
</tr>
<tr>
<td><code>expat</code></td>
<td>2.6.4</td>
</tr>
<tr>
<td><code>faiss</code></td>
<td>1.8.0</td>
</tr>
<tr>
<td><code>ffmpeg</code></td>
<td>5.1.4</td>
</tr>
<tr>
<td><code>fftw</code></td>
<td>3.3.10</td>
</tr>
<tr>
<td><code>findutils</code></td>
<td>4.9.0</td>
</tr>
<tr>
<td><code>flac</code></td>
<td>1.4.3</td>
</tr>
<tr>
<td><code>fmt</code></td>
<td>11.0.2</td>
</tr>
<tr>
<td><code>fp16</code></td>
<td>2020-05-14</td>
</tr>
<tr>
<td><code>fxdiv</code></td>
<td>2020-04-17</td>
</tr>
<tr>
<td><code>gawk</code></td>
<td>4.2.1</td>
</tr>
<tr>
<td><code>gcc</code></td>
<td>13.3.0</td>
</tr>
<tr>
<td><code>gcc-runtime</code></td>
<td>13.3.0</td>
</tr>
<tr>
<td><code>gdb</code></td>
<td>15.2</td>
</tr>
<tr>
<td><code>gdbm</code></td>
<td>1.23</td>
</tr>
<tr>
<td><code>gettext</code></td>
<td>0.22.5</td>
</tr>
<tr>
<td><code>git</code></td>
<td>2.47.0</td>
</tr>
<tr>
<td><code>glibc</code></td>
<td>2.31</td>
</tr>
<tr>
<td><code>gloo</code></td>
<td>2023-12-03</td>
</tr>
<tr>
<td><code>gmake</code></td>
<td>4.4.1</td>
</tr>
<tr>
<td><code>gmp</code></td>
<td>6.3.0</td>
</tr>
<tr>
<td><code>gmp</code></td>
<td>6.3.0</td>
</tr>
<tr>
<td><code>gnuconfig</code></td>
<td>2024-07-27</td>
</tr>
<tr>
<td><code>googletest</code></td>
<td>1.12.1</td>
</tr>
<tr>
<td><code>gperftools</code></td>
<td>2.16</td>
</tr>
<tr>
<td><code>hdf5</code></td>
<td>1.14.5</td>
</tr>
<tr>
<td><code>hwloc</code></td>
<td>2.11.1</td>
</tr>
<tr>
<td><code>hydra</code></td>
<td>4.2.1</td>
</tr>
<tr>
<td><code>krb5</code></td>
<td>1.21.3</td>
</tr>
<tr>
<td><code>libaio</code></td>
<td>0.3.113</td>
</tr>
<tr>
<td><code>libarchive</code></td>
<td>3.7.6</td>
</tr>
<tr>
<td><code>libbsd</code></td>
<td>0.12.2</td>
</tr>
<tr>
<td><code>libedit</code></td>
<td>3.1-20240808</td>
</tr>
<tr>
<td><code>libfabric</code></td>
<td>1.15.2.0</td>
</tr>
<tr>
<td><code>libffi</code></td>
<td>3.4.6</td>
</tr>
<tr>
<td><code>libgit2</code></td>
<td>1.8.0</td>
</tr>
<tr>
<td><code>libiconv</code></td>
<td>1.17</td>
</tr>
<tr>
<td><code>libidn2</code></td>
<td>2.3.7</td>
</tr>
<tr>
<td><code>libjpeg-turbo</code></td>
<td>3.0.3</td>
</tr>
<tr>
<td><code>libmd</code></td>
<td>1.0.4</td>
</tr>
<tr>
<td><code>libmicrohttpd</code></td>
<td>0.9.50</td>
</tr>
<tr>
<td><code>libogg</code></td>
<td>1.3.5</td>
</tr>
<tr>
<td><code>libpciaccess</code></td>
<td>0.17</td>
</tr>
<tr>
<td><code>libpng</code></td>
<td>1.6.39</td>
</tr>
<tr>
<td><code>libsigsegv</code></td>
<td>2.14</td>
</tr>
<tr>
<td><code>libssh2</code></td>
<td>1.11.1</td>
</tr>
<tr>
<td><code>libtool</code></td>
<td>2.4.6</td>
</tr>
<tr>
<td><code>libtool</code></td>
<td>2.4.7</td>
</tr>
<tr>
<td><code>libunistring</code></td>
<td>1.2</td>
</tr>
<tr>
<td><code>libuv</code></td>
<td>1.48.0</td>
</tr>
<tr>
<td><code>libvorbis</code></td>
<td>1.3.7</td>
</tr>
<tr>
<td><code>libxcrypt</code></td>
<td>4.4.35</td>
</tr>
<tr>
<td><code>libxml2</code></td>
<td>2.13.4</td>
</tr>
<tr>
<td><code>libyaml</code></td>
<td>0.2.5</td>
</tr>
<tr>
<td><code>lz4</code></td>
<td>1.10.0</td>
</tr>
<tr>
<td><code>lzo</code></td>
<td>2.10</td>
</tr>
<tr>
<td><code>m</code>4</td>
<td>1.4.19</td>
</tr>
<tr>
<td><code>magma</code></td>
<td>master</td>
</tr>
<tr>
<td><code>meson</code></td>
<td>1.5.1</td>
</tr>
<tr>
<td><code>mpc</code></td>
<td>1.3.1</td>
</tr>
<tr>
<td><code>mpfr</code></td>
<td>4.2.1</td>
</tr>
<tr>
<td><code>nasm</code></td>
<td>2.16.03</td>
</tr>
<tr>
<td><code>nccl</code></td>
<td>2.26.2-1</td>
</tr>
<tr>
<td><code>nccl-tests</code></td>
<td>2.13.6</td>
</tr>
<tr>
<td><code>ncurses</code></td>
<td>6.5</td>
</tr>
<tr>
<td><code>nghttp2</code></td>
<td>1.63.0</td>
</tr>
<tr>
<td><code>ninja</code></td>
<td>1.12.1</td>
</tr>
<tr>
<td><code>numactl</code></td>
<td>2.0.18</td>
</tr>
<tr>
<td><code>nvtx</code></td>
<td>3.1.0</td>
</tr>
<tr>
<td><code>openblas</code></td>
<td>0.3.28</td>
</tr>
<tr>
<td><code>openssh</code></td>
<td>9.9p1</td>
</tr>
<tr>
<td><code>openssl</code></td>
<td>3.4.0</td>
</tr>
<tr>
<td><code>opus</code></td>
<td>1.5.2</td>
</tr>
<tr>
<td><code>osu-micro-benchmarks</code></td>
<td>7.5</td>
</tr>
<tr>
<td><code>patchelf</code></td>
<td>0.17.2</td>
</tr>
<tr>
<td><code>pcre</code></td>
<td>8.45</td>
</tr>
<tr>
<td><code>pcre2</code></td>
<td>10.44</td>
</tr>
<tr>
<td><code>perl</code></td>
<td>5.40.0</td>
</tr>
<tr>
<td><code>pigz</code></td>
<td>2.8</td>
</tr>
<tr>
<td><code>pkgconf</code></td>
<td>2.2.0</td>
</tr>
<tr>
<td><code>protobuf</code></td>
<td>3.28.2</td>
</tr>
<tr>
<td><code>psimd</code></td>
<td>2020-05-17</td>
</tr>
<tr>
<td><code>pthreadpool</code></td>
<td>2023-08-29</td>
</tr>
<tr>
<td><code>python</code></td>
<td>3.13.0</td>
</tr>
<tr>
<td><code>python-venv</code></td>
<td>1.0</td>
</tr>
<tr>
<td><code>rdma-core</code></td>
<td>31.0</td>
</tr>
<tr>
<td><code>re2c</code></td>
<td>3.1</td>
</tr>
<tr>
<td><code>readline</code></td>
<td>8.2</td>
</tr>
<tr>
<td><code>rust</code></td>
<td>1.81.0</td>
</tr>
<tr>
<td><code>rust-bootstrap</code></td>
<td>1.81.0</td>
</tr>
<tr>
<td><code>sentencepiece</code></td>
<td>0.1.99</td>
</tr>
<tr>
<td><code>sleef</code></td>
<td>3.6.0_2024-03-20</td>
</tr>
<tr>
<td><code>sox</code></td>
<td>14.4.2</td>
</tr>
<tr>
<td><code>sqlite</code></td>
<td>3.46.0</td>
</tr>
<tr>
<td><code>swig</code></td>
<td>4.1.1</td>
</tr>
<tr>
<td><code>tar</code></td>
<td>1.34</td>
</tr>
<tr>
<td><code>texinfo</code></td>
<td>7.1</td>
</tr>
<tr>
<td><code>util-linux-uuid</code></td>
<td>2.40.2</td>
</tr>
<tr>
<td><code>util-macros</code></td>
<td>1.20.1</td>
</tr>
<tr>
<td><code>valgrind</code></td>
<td>3.23.0</td>
</tr>
<tr>
<td><code>xpmem</code></td>
<td>2.9.6</td>
</tr>
<tr>
<td><code>xz</code></td>
<td>5.4.6</td>
</tr>
<tr>
<td><code>yasm</code></td>
<td>1.3.0</td>
</tr>
<tr>
<td><code>zlib-ng</code></td>
<td>2.2.1</td>
</tr>
<tr>
<td><code>zstd</code></td>
<td>1.5.6</td>
</tr>
</tbody>
</table>
</details>
<details class="info">
<summary>Python packages exposed via the <code>default</code> view</summary>
<table>
<thead>
<tr>
<th>Package</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aniso8601</code></td>
<td>9.0.1</td>
</tr>
<tr>
<td><code>annotated-types</code></td>
<td>0.7.0</td>
</tr>
<tr>
<td><code>apex</code></td>
<td>0.1</td>
</tr>
<tr>
<td><code>appdirs</code></td>
<td>1.4.4</td>
</tr>
<tr>
<td><code>astunparse</code></td>
<td>1.6.3</td>
</tr>
<tr>
<td><code>blinker</code></td>
<td>1.6.2</td>
</tr>
<tr>
<td><code>certifi</code></td>
<td>2023.7.22</td>
</tr>
<tr>
<td><code>charset-normalizer</code></td>
<td>3.3.0</td>
</tr>
<tr>
<td><code>click</code></td>
<td>8.1.7</td>
</tr>
<tr>
<td><code>coverage</code></td>
<td>7.2.6</td>
</tr>
<tr>
<td><code>Cython</code></td>
<td>3.0.11</td>
</tr>
<tr>
<td><code>docker-pycreds</code></td>
<td>0.4.1</td>
</tr>
<tr>
<td><code>donfig</code></td>
<td>0.8.1.post1</td>
</tr>
<tr>
<td><code>einops</code></td>
<td>0.8.0</td>
</tr>
<tr>
<td><code>faiss</code></td>
<td>1.8.0</td>
</tr>
<tr>
<td><code>filelock</code></td>
<td>3.12.4</td>
</tr>
<tr>
<td><code>flash_attn</code></td>
<td>2.6.3</td>
</tr>
<tr>
<td><code>Flask</code></td>
<td>2.3.2</td>
</tr>
<tr>
<td><code>Flask-RESTful</code></td>
<td>0.3.9</td>
</tr>
<tr>
<td><code>fsspec</code></td>
<td>2024.5.0</td>
</tr>
<tr>
<td><code>gitdb</code></td>
<td>4.0.9</td>
</tr>
<tr>
<td><code>GitPython</code></td>
<td>3.1.40</td>
</tr>
<tr>
<td><code>huggingface_hub</code></td>
<td>0.26.2</td>
</tr>
<tr>
<td><code>idna</code></td>
<td>3.4</td>
</tr>
<tr>
<td><code>importlib_metadata</code></td>
<td>7.0.1</td>
</tr>
<tr>
<td><code>iniconfig</code></td>
<td>2.0.0</td>
</tr>
<tr>
<td><code>itsdangerous</code></td>
<td>2.1.2</td>
</tr>
<tr>
<td><code>Jinja2</code></td>
<td>3.1.4</td>
</tr>
<tr>
<td><code>joblib</code></td>
<td>1.2.0</td>
</tr>
<tr>
<td><code>lightning-utilities</code></td>
<td>0.11.2</td>
</tr>
<tr>
<td><code>MarkupSafe</code></td>
<td>2.1.3</td>
</tr>
<tr>
<td><code>mpmath</code></td>
<td>1.3.0</td>
</tr>
<tr>
<td><code>networkx</code></td>
<td>3.1</td>
</tr>
<tr>
<td><code>nltk</code></td>
<td>3.9.1</td>
</tr>
<tr>
<td><code>numcodecs</code></td>
<td>0.15.0</td>
</tr>
<tr>
<td><code>numpy</code></td>
<td>2.1.2</td>
</tr>
<tr>
<td><code>nvtx</code></td>
<td>0.2.5</td>
</tr>
<tr>
<td><code>packaging</code></td>
<td>24.1</td>
</tr>
<tr>
<td><code>pillow</code></td>
<td>11.0.0</td>
</tr>
<tr>
<td><code>pip</code></td>
<td>23.1.2</td>
</tr>
<tr>
<td><code>platformdirs</code></td>
<td>3.10.0</td>
</tr>
<tr>
<td><code>pluggy</code></td>
<td>1.5.0</td>
</tr>
<tr>
<td><code>protobuf</code></td>
<td>5.28.2</td>
</tr>
<tr>
<td><code>psutil</code></td>
<td>7.0.0</td>
</tr>
<tr>
<td><code>pybind11</code></td>
<td>2.13.6</td>
</tr>
<tr>
<td><code>pydantic</code></td>
<td>2.10.1</td>
</tr>
<tr>
<td><code>pydantic_core</code></td>
<td>2.27.1</td>
</tr>
<tr>
<td><code>pytest</code></td>
<td>8.2.1</td>
</tr>
<tr>
<td><code>pytest-asyncio</code></td>
<td>0.23.5</td>
</tr>
<tr>
<td><code>pytest-cov</code></td>
<td>4.0.0</td>
</tr>
<tr>
<td><code>pytest-mock</code></td>
<td>3.10.0</td>
</tr>
<tr>
<td><code>pytest-random-order</code></td>
<td>1.0.4</td>
</tr>
<tr>
<td><code>pytz</code></td>
<td>2023.3</td>
</tr>
<tr>
<td><code>PyYAML</code></td>
<td>6.0.2</td>
</tr>
<tr>
<td><code>regex</code></td>
<td>2022.8.17</td>
</tr>
<tr>
<td><code>requests</code></td>
<td>2.32.3</td>
</tr>
<tr>
<td><code>safetensors</code></td>
<td>0.4.5</td>
</tr>
<tr>
<td><code>sentencepiece</code></td>
<td>0.1.99</td>
</tr>
<tr>
<td><code>sentry-sdk</code></td>
<td>2.22.0</td>
</tr>
<tr>
<td><code>setproctitle</code></td>
<td>1.1.10</td>
</tr>
<tr>
<td><code>setuptools</code></td>
<td>69.2.0</td>
</tr>
<tr>
<td><code>six</code></td>
<td>1.16.0</td>
</tr>
<tr>
<td><code>smmap</code></td>
<td>5.0.0</td>
</tr>
<tr>
<td><code>sympy</code></td>
<td>1.13.1</td>
</tr>
<tr>
<td><code>tiktoken</code></td>
<td>0.4.0</td>
</tr>
<tr>
<td><code>tokenizers</code></td>
<td>0.21.0</td>
</tr>
<tr>
<td><code>torch</code></td>
<td>2.6.0</td>
</tr>
<tr>
<td><code>torchaudio</code></td>
<td>2.6.0a0+d883142</td>
</tr>
<tr>
<td><code>torchmetrics</code></td>
<td>1.5.2</td>
</tr>
<tr>
<td><code>torchvision</code></td>
<td>0.21.0</td>
</tr>
<tr>
<td><code>tqdm</code></td>
<td>4.66.3</td>
</tr>
<tr>
<td><code>transformer_engine</code></td>
<td>2.3.0.dev0+dd4c17d</td>
</tr>
<tr>
<td><code>transformers</code></td>
<td>4.48.3</td>
</tr>
<tr>
<td><code>triton</code></td>
<td>3.2.0+gitc802bb4f</td>
</tr>
<tr>
<td><code>typing_extensions</code></td>
<td>4.12.2</td>
</tr>
<tr>
<td><code>urllib3</code></td>
<td>2.1.0</td>
</tr>
<tr>
<td><code>versioneer</code></td>
<td>0.29</td>
</tr>
<tr>
<td><code>wandb</code></td>
<td>0.19.9</td>
</tr>
<tr>
<td><code>Werkzeug</code></td>
<td>3.0.4</td>
</tr>
<tr>
<td><code>wheel</code></td>
<td>0.41.2</td>
</tr>
<tr>
<td><code>wrapt</code></td>
<td>1.15.0</td>
</tr>
<tr>
<td><code>zarr</code></td>
<td>3.0.1</td>
</tr>
<tr>
<td><code>zipp</code></td>
<td>3.17.0</td>
</tr>
</tbody>
</table>
</details>
</div>
</div>
</div>
<p><a href="" id="ref-uenv-pytorch-how-to-use"></a></p>
<h3 id="how-to-use">How to use<a class="headerlink" href="#how-to-use" title="Permanent link">&para;</a></h3>
<p>There are two ways to access the software provided by the uenv, once it has been started.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">the default view</label><label for="__tabbed_2_2">Spack</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The simplest way to get started is to use the <code>default</code> file system view, which automatically loads all of the packages when the uenv is started.</p>
<div class="language-console highlight"><span class="filename">Test mpi compilers and python provided by pytorch/v2.6.0</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="gp">$ </span>uenv<span class="w"> </span>start<span class="w"> </span>pytorch/v2.6.0:v1<span class="w"> </span>--view<span class="o">=</span>default<span class="w"> </span><span class="c1"># (1)!</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="gp">$ </span>which<span class="w"> </span>python<span class="w"> </span><span class="c1"># (2)!</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="go">/user-environment/env/default/bin/python</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="gp">$ </span>python<span class="w"> </span>--version
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="go">Python 3.13.0</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="gp">$ </span>which<span class="w"> </span>mpicc<span class="w"> </span><span class="c1"># (3)!</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="go">/user-environment/env/default/bin/mpicc</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="gp">$ </span>mpicc<span class="w"> </span>--version
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="go">gcc (Spack GCC) 13.3.0</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="gp">$ </span>gcc<span class="w"> </span>--version<span class="w"> </span><span class="c1"># the compiler wrapper uses the gcc provided by the uenv</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="go">gcc (Spack GCC) 13.3.0</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="gp">$ </span><span class="nb">exit</span><span class="w"> </span><span class="c1"># (4)!</span>
</span></code></pre></div>
<ol>
<li>Start using the default view.</li>
<li>The python executable provided by the uenv is the default, and is a recent version.</li>
<li>The MPI compiler wrappers are also available.</li>
<li>Exit the uenv.</li>
</ol>
</div>
<div class="tabbed-block">
<p>The pytorch uenv can also be used as a base for building software with Spack, because it provides compilers, MPI, Python and common packages like HDF5.</p>
<p><a class="autorefs autorefs-internal" title="Building software using Spack" href="../../../build-install/uenv/#building-software-using-spack">Check out the guide for using Spack with uenv</a>.</p>
</div>
</div>
</div>
<p><a href="" id="ref-uenv-pytorch-venv"></a></p>
<h3 id="adding-python-packages-on-top-of-the-uenv">Adding Python packages on top of the uenv<a class="headerlink" href="#adding-python-packages-on-top-of-the-uenv" title="Permanent link">&para;</a></h3>
<p>Uenvs are read-only, and cannot be modified. However, it is possible to add Python packages on top of the uenv using virtual environments analogous to the setup with containers.</p>
<div class="language-console highlight"><span class="filename">Creating a virtual environment on top of the uenv</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="gp">$ </span>uenv<span class="w"> </span>start<span class="w"> </span>pytorch/v2.6.0:v1<span class="w"> </span>--view<span class="o">=</span>default<span class="w"> </span><span class="c1"># (1)!</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>--system-site-packages<span class="w"> </span>venv-uenv-pt2.6-v1<span class="w"> </span><span class="c1"># (2)!</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>venv-uenv-pt2.6-v1/bin/activate<span class="w"> </span><span class="c1"># (3)!</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="gp gp-VirtualEnv">(venv-uenv-pt2.6-v1)</span> <span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>&lt;package&gt;<span class="w"> </span><span class="c1"># (4)!</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="gp gp-VirtualEnv">(venv-uenv-pt2.6-v1)</span> <span class="gp">$ </span>deactivate<span class="w"> </span><span class="c1"># (5)!</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="gp">$ </span><span class="nb">exit</span><span class="w"> </span><span class="c1"># (6)!</span>
</span></code></pre></div>
<ol>
<li>The <code>default</code> view is recommended, as it loads all the packages provided by the uenv.
   This is important for PyTorch to work correctly, as it relies on the CUDA and NCCL libraries provided by the uenv.</li>
<li>The virtual environment is created in the current working directory, and can be activated and deactivated like any other Python virtual environment.</li>
<li>Activating the virtual environment will override the Python executable provided by the uenv, and use the one from the virtual environment instead.
   This is important to ensure that the packages installed in the virtual environment are used.</li>
<li>The virtual environment can be used to install any Python package.</li>
<li>The virtual environment can be deactivated using the <code>deactivate</code> command.
   This will restore the original Python executable provided by the uenv.</li>
<li>The uenv can be exited using the <code>exit</code> command or by typing <code>ctrl-d</code>.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Squashing the virtual environment</p>
<p>Python virtual environments can be slow on the parallel Lustre file system due to the amount of small files and potentially many processes accessing it.
If this becomes a bottleneck, consider <a class="autorefs autorefs-internal" title="Python virtual environments with uenv" href="../../../guides/storage/#python-virtual-environments-with-uenv">squashing the venv</a> into its own memory-mapped, read-only file system to enhance scalability and reduce load times.</p>
</div>
<details class="bug">
<summary>Python packages from uenv shadowing those in a virtual environment</summary>
<p>When using uenv with a virtual environment on top, the site-packages under <code>/user-environment</code> currently take precedence over those in the activated virtual environment. This is due to the uenv paths being included in the <code>PYTHONPATH</code> environment variable. As a consequence, despite installing a different version of a package in the virtual environment from what is available in the uenv, the uenv version will still be imported at runtime. A possible workaround is to prepend the virtual environment&rsquo;s site-packages to <code>PYTHONPATH</code> whenever activating the virtual environment.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import site; print(site.getsitepackages()[0])&#39;</span><span class="k">)</span><span class="s2">:</span><span class="nv">$PYTHONPATH</span><span class="s2">&quot;</span>
</span></code></pre></div>
It is recommended to apply this workaround if you are constrained by a Python package version installed in the uenv that you need to change for your application.</p>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keep in mind that</p>
<ul>
<li>this virtual environment is <em>specific</em> to this particular uenv and won&rsquo;t actually work unless you are using it from inside this uenv - it relies on the resources packaged inside the uenv.</li>
<li>every Slurm job making use of this virtual environment will need to activate it first (<em>inside</em> the <code>srun</code> command). </li>
</ul>
</div>
<p>Alternatively one can use the uenv as <a class="autorefs autorefs-internal" title="Building software using Spack" href="../../../build-install/uenv/#building-software-using-spack">upstream Spack instance</a> to to add both Python and non-Python packages.
However, this workflow is more involved and intended for advanced Spack users.</p>
<h3 id="running-pytorch-jobs-with-slurm">Running PyTorch jobs with Slurm<a class="headerlink" href="#running-pytorch-jobs-with-slurm" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><span class="filename">Slurm sbatch script</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="c1">#SBATCH --account=&lt;ACCOUNT&gt;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1">#SBATCH --job-name=dist-train-ddp</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1">#SBATCH --time=01:00:00</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c1">#SBATCH --nodes=2</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="c1">#SBATCH --ntasks-per-node=4</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="c1">#SBATCH --output=logs/slurm-%x-%j.log</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1"># (1)!</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="c1">#SBATCH --uenv=pytorch/v2.6.0:/user-environment</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="c1">#SBATCH --view=default</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="nb">ulimit</span><span class="w"> </span>-c<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># (2)!</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="c1">#################################</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="c1"># OpenMP environment variables #</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="c1">#################################</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">8</span><span class="w"> </span><span class="c1"># (3)!</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="c1">#################################</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="c1"># PyTorch environment variables #</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="c1">#################################</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TORCH_NCCL_ASYNC_ERROR_HANDLING</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="c1"># (4)!</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TRITON_HOME</span><span class="o">=</span>/dev/shm/<span class="w"> </span><span class="c1"># (5)!</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="c1">#################################</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="c1"># MPICH environment variables   #</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="c1">#################################</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MPICH_GPU_SUPPORT_ENABLED</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="c1"># (6)!</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="c1">#################################</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="c1"># CUDA environment variables    #</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="c1">#################################</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_CACHE_DISABLE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="c1"># (7)!</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="c1">############################################</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="c1"># NCCL and Fabric environment variables    #</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="c1">############################################</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="c1"># (8)!</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="c1"># This forces NCCL to use the libfabric plugin, enabling full use of the</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="c1"># Slingshot network. If the plugin can not be found, applications will fail to</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="c1"># start. With the default value, applications would instead fall back to e.g.</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="c1"># TCP, which would be significantly slower than with the plugin. More information</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="c1"># about `NCCL_NET` can be found at:</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="c1"># https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-net</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="nb">export</span><span class="w"> </span><span class="nv">NCCL_NET</span><span class="o">=</span><span class="s2">&quot;AWS Libfabric&quot;</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="c1"># Use GPU Direct RDMA when GPU and NIC are on the same NUMA node. More</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a><span class="c1"># information about `NCCL_NET_GDR_LEVEL` can be found at:</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a><span class="c1"># https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-net-gdr-level-formerly-nccl-ib-gdr-level</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a><span class="nb">export</span><span class="w"> </span><span class="nv">NCCL_NET_GDR_LEVEL</span><span class="o">=</span>PHB
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a><span class="nb">export</span><span class="w"> </span><span class="nv">NCCL_CROSS_NIC</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a><span class="c1"># Starting with nccl 2.27 a new protocol (LL128) was enabled by default, which</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a><span class="c1"># typically performs worse on Slingshot. The following disables that protocol.</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a><span class="nb">export</span><span class="w"> </span><span class="nv">NCCL_PROTO</span><span class="o">=</span>^LL128
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a><span class="c1"># These `FI` (libfabric) environment variables have been found to give the best</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a><span class="c1"># performance on the Alps network across a wide range of applications. Specific</span>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a><span class="c1"># applications may perform better with other values.</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a><span class="nb">export</span><span class="w"> </span><span class="nv">FI_CXI_DEFAULT_CQ_SIZE</span><span class="o">=</span><span class="m">131072</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a><span class="nb">export</span><span class="w"> </span><span class="nv">FI_CXI_DEFAULT_TX_SIZE</span><span class="o">=</span><span class="m">32768</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a><span class="nb">export</span><span class="w"> </span><span class="nv">FI_CXI_DISABLE_HOST_REGISTER</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a><span class="nb">export</span><span class="w"> </span><span class="nv">FI_CXI_RX_MATCH_MODE</span><span class="o">=</span>software
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a><span class="nb">export</span><span class="w"> </span><span class="nv">FI_MR_CACHE_MONITOR</span><span class="o">=</span>userfaultfd
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a><span class="c1"># (9)!</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a><span class="c1"># (10)!</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a>srun<span class="w"> </span>-ul<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a><span class="s2">    . ./venv-uenv-pt2.6-v1/bin/activate</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a><span class="s2">    MASTER_ADDR=\$(scontrol show hostnames \$SLURM_JOB_NODELIST | head -n 1) \</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a><span class="s2">    MASTER_PORT=29500 \</span>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73" href="#__codelineno-11-73"></a><span class="s2">    RANK=\${SLURM_PROCID} \</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74" href="#__codelineno-11-74"></a><span class="s2">    LOCAL_RANK=\${SLURM_LOCALID} \</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75" href="#__codelineno-11-75"></a><span class="s2">    WORLD_SIZE=\${SLURM_NTASKS} \</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76" href="#__codelineno-11-76"></a><span class="s2">    python dist-train.py &lt;dist-train-args&gt;</span>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77" href="#__codelineno-11-77"></a><span class="s2">&quot;</span>
</span></code></pre></div>
<ol>
<li>The <code>--uenv</code> option is used to specify the uenv to use for the job.
   The <code>--view=default</code> option is used to load all the packages provided by the uenv.</li>
<li>In case the application crashes, it may leave behind large core dump files that contain an image of the process memory at the time of the crash. While these can be useful for debugging the reason of a specific crash (by e.g. loading them with <code>cuda-gdb</code> and looking at the stack trace with <code>bt</code>), they may accumulate over time and occupy a large space on the filesystem. For this reason, it is recommended to disable their creation (unless needed) by adding this line.</li>
<li>Set <code>OMP_NUM_THREADS</code> if you are using OpenMP in your code.
   The number of threads should be not greater than the number of cores per task (<code>$SLURM_CPUS_PER_TASK</code>).
   The optimal number depends on the workload and should be determined by testing.
   Consider for example that typical workloads using PyTorch may fork the processes, so the number of threads should be around the number of cores per task divided by the number of processes.</li>
<li>Enable more graceful exception handling, see <a href="https://pytorch.org/docs/stable/torch_nccl_environment_variables.html">PyTorch documentation</a></li>
<li>Set the Triton home to a local path (e.g. <code>/dev/shm</code>) to avoid writing to the (distributed) file system.
   This is important for performance, as writing to the Lustre file system can be slow due to the amount of small files and potentially many processes accessing it. Avoid this setting with the container engine as it may lead to errors related to mount settings of <code>/dev/shm</code> (use a filesystem path inside the container instead).</li>
<li>Disable GPU support in MPICH, as it <a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/mpi.html#inter-gpu-communication-with-cuda-aware-mpi">can lead to deadlocks</a> when using together with nccl.</li>
<li>Avoid writing JITed binaries to the (distributed) file system, which could lead to performance issues.</li>
<li>These variables should always be set for correctness and optimal performance when using NCCL with uenv, see <a class="autorefs autorefs-internal" title="NCCL" href="../../communication/nccl/#nccl">the detailed explanation</a>.</li>
<li>Activate the virtual environment created on top of the uenv (if any).
   Please follow the guidelines for <a class="autorefs autorefs-internal" title="Python virtual environments with uenv" href="../../../guides/storage/#python-virtual-environments-with-uenv">python virtual environments with uenv</a> to enhance scalability and reduce load times. </li>
<li>The environment variables are used by PyTorch to initialize the distributed backend.
   The <code>MASTER_ADDR</code>, <code>MASTER_PORT</code> variables are used to determine the address and port of the master node.
   Additionally we also need <code>RANK</code> and <code>LOCAL_RANK</code> and <code>WORLD_SIZE</code> to identify the position of each rank within the Slurm step and node, respectively.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.action.edit", "navigation.indexes", "search.share", "navigation.instant", "navigation.tracking", "navigation.path", "navigation.top", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>