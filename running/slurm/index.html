
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.cscs.ch/running/slurm/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../hyperqueue/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Slurm - CSCS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#slurm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CSCS Documentation" class="md-header__button md-logo" aria-label="CSCS Documentation" data-md-component="logo">
      
  <img src="../../assets/cscs-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CSCS Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Slurm
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/eth-cscs/cscs-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CSCS Documentation" class="md-nav__button md-logo" aria-label="CSCS Documentation" data-md-component="logo">
      
  <img src="../../assets/cscs-logo.png" alt="logo">

    </a>
    CSCS Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eth-cscs/cscs-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../alps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Alps
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Alps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/platforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Platforms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../clusters/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Clusters
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Clusters
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/besso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Besso
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/bristen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bristen
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/clariden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clariden
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/daint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Daint
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/eiger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eiger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/santis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Santis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hardware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/mlp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Machine Learning Platform
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Machine Learning Platform
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/clariden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clariden
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/bristen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bristen
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/hpcp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    HPC Platform
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    HPC Platform
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/daint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Daint
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/eiger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eiger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/cwp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Climate and Weather Platform
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Climate and Weather Platform
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/santis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Santis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../access/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Connecting to Alps
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Connecting to Alps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/mfa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi Factor Authentication (MFA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/web/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/ssh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSH
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/firecrest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FirecREST
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/hpc-console/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HPC Console
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/jupyterlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JupyterLab
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/vscode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VSCode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Running Jobs
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Running Jobs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Slurm
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Slurm
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#accounts-and-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Accounts and resources
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prioritisation-and-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prioritisation and scheduling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partitions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Partitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debug-partition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug partition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normal-partition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Normal partition
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interactive-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interactive jobs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Interactive jobs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-node-shell" class="md-nav__link">
    <span class="md-ellipsis">
      
        Single node shell
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-node-allocation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi node allocation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-node-in-a-running-job" class="md-nav__link">
    <span class="md-ellipsis">
      
        Connecting to node in a running job
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Affinity
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slurm-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slurm features
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Slurm features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transparent-hugepages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transparent hugepages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nvidia-vboost" class="md-nav__link">
    <span class="md-ellipsis">
      
        NVIDIA vboost
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvidia-gh200-gpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      
        NVIDIA GH200 GPU Nodes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NVIDIA GH200 GPU Nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one-rank-per-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        One rank per GPU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-ranks-per-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple ranks per GPU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gh200-power-capping" class="md-nav__link">
    <span class="md-ellipsis">
      
        GH200 power capping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amd-cpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      
        AMD CPU nodes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AMD CPU nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openmp" class="md-nav__link">
    <span class="md-ellipsis">
      
        OpenMP
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node-over-subscription" class="md-nav__link">
    <span class="md-ellipsis">
      
        Node over-subscription
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Node over-subscription">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-sharing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Node sharing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-more-than-one-job-step-per-node" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running more than one job step per node
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-more-than-one-job-step-per-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running more than one job step per GPU
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hyperqueue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HyperQueue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../known-issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Known issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../environments/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Environments
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Environments
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/terminal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started in the terminal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/uenv/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    uenv
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    uenv
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/using/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using uenv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Managing uenv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building uenv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/configure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploying uenv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/container-engine/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Container Engine
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Container Engine
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/container-engine/run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using the Container Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/container-engine/resource-hook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hooks and native resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/container-engine/edf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EDF reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/container-engine/known-issue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Known issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/alps-extended-images/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alps Extended Images
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../build-install/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Building and Installing Software
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Building and Installing Software
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/prgenv/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Programming Environments
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Programming Environments
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/prgenv-gnu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    prgenv-gnu
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/prgenv-gnu-openmpi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    prgenv-gnu-openmpi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/prgenv-nvfortran/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    prgenv-nvfortran
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/linalg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    linalg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/julia/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    julia
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/cpe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cray modules (CPE)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    How to build software
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    How to build software
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    uenv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Packaging and Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Packaging and Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building uenv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating Containers with podman
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Applications and Frameworks
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Applications and Frameworks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/sciapps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Scientific Applications
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Scientific Applications
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/cp2k/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CP2K
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/gromacs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GROMACS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/lammps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LAMMPS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/namd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NAMD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/quantumespresso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quantum ESPRESSO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/vasp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VASP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/ml/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Machine Learning
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Machine Learning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/ml/pytorch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PyTorch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/ml/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3_3" id="__nav_7_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ml/llm-inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Inference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ml/llm-fine-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Fine-tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ml/llm-nanotron-training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Pre-training
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/cw/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Climate and Weather
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Climate and Weather
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/cw/netcdf-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    netcdf-tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/communication/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Communication Libraries
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Communication Libraries
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/libfabric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    libfabric
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/cray-mpich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cray MPICH
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/mpich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MPICH
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/openmpi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenMPI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/nccl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NCCL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/nvshmem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NVSHMEM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/userapps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    User Applications
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Applications
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/userapps/wrf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WRF
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/userapps/orca/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ORCA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/commercial/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Commercial Software
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Commercial Software
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/commercial/matlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Matlab
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/sciviz/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Scientific Visualization
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Scientific Visualization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciviz/paraview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ParaView
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/unsupported/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prohibited Software
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/devtools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Debugging and Performance Analysis
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Debugging and Performance Analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/nvidia-nsight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using NVIDIA Nsight
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Using Linaro Forge
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Using Linaro Forge
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/linaro-uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linaro uenv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/linaro-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linaro performance analysis tool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/linaro-ddt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linaro debugger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/vihps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using Score-P/Scalasca
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jobreport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Job report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gssr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPU report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../storage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Data Management and Storage
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data Management and Storage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/filesystems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/transfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Transfer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/longterm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Long Term Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/object/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Object Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../services/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/devportal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer Portal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CI/CD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../services/kubernetes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Kubernetes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/kubernetes/clusters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clusters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/kubernetes/kubernetes-upgrades/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Upgrades
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/kubernetes/node-updates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Node OS Updates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../accounts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Accounts and Projects
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Accounts and Projects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accounts/ump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Account and Resources Management Tool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accounts/waldur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project and Resources Management Tool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accounts/account-create/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating a new account
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/internet-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Internet Access on Alps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../policies/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Policies
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13" id="__nav_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Policies
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/regulations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    User Regulations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/code-of-conduct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code of Conduct
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    User Support Policies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/slack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Slack Code of Conduct
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/maintenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scheduled Maintenance and System Unavailability Policies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../contributing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Contributing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#accounts-and-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Accounts and resources
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prioritisation-and-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prioritisation and scheduling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partitions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Partitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debug-partition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug partition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normal-partition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Normal partition
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interactive-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interactive jobs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Interactive jobs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-node-shell" class="md-nav__link">
    <span class="md-ellipsis">
      
        Single node shell
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-node-allocation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi node allocation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-node-in-a-running-job" class="md-nav__link">
    <span class="md-ellipsis">
      
        Connecting to node in a running job
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Affinity
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slurm-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slurm features
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Slurm features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transparent-hugepages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transparent hugepages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nvidia-vboost" class="md-nav__link">
    <span class="md-ellipsis">
      
        NVIDIA vboost
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvidia-gh200-gpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      
        NVIDIA GH200 GPU Nodes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NVIDIA GH200 GPU Nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one-rank-per-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        One rank per GPU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-ranks-per-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple ranks per GPU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gh200-power-capping" class="md-nav__link">
    <span class="md-ellipsis">
      
        GH200 power capping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amd-cpu-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      
        AMD CPU nodes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AMD CPU nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openmp" class="md-nav__link">
    <span class="md-ellipsis">
      
        OpenMP
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node-over-subscription" class="md-nav__link">
    <span class="md-ellipsis">
      
        Node over-subscription
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Node over-subscription">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-sharing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Node sharing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-more-than-one-job-step-per-node" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running more than one job step per node
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-more-than-one-job-step-per-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running more than one job step per GPU
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Welcome
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Running Jobs
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/eth-cscs/cscs-docs/edit/main/docs/running/slurm.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  


<p><a href="" id="ref-slurm"></a></p>
<h1 id="slurm">Slurm<a class="headerlink" href="#slurm" title="Permanent link">&para;</a></h1>
<p>CSCS uses the <a href="https://slurm.schedmd.com/documentation.html">Slurm</a> workload manager to efficiently schedule and manage jobs on Alps vClusters.
Slurm is an open-source, highly scalable job scheduler that allocates computing resources, queues user jobs, and optimizes workload distribution across the cluster.
It supports advanced scheduling policies, job dependencies, resource reservations, and accounting, making it well-suited for high-performance computing environments.</p>
<p>Refer to the <a href="https://slurm.schedmd.com/quickstart.html">Quick Start User Guide</a> for commonly used terminology and commands.</p>
<div class="grid cards">
<ul>
<li>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M256.5 0c14.7 0 28.2 8.1 35.2 21l216 400c6.7 12.4 6.4 27.4-.8 39.5S486.6 480 472.6 480h-432c-14.1 0-27.1-7.4-34.3-19.5s-7.5-27.1-.8-39.5l216-400 2.9-4.6C231.7 6.2 243.6 0 256.5 0m-86.1 249.9 26.8 26.8c6.2 6.2 16.4 6.2 22.6 0l43.3-43.3c6-6 14.1-9.4 22.6-9.4h42.8L256.4 90.5l-86.1 159.4zM496.5 160a80 80 0 1 1 0-160 80 80 0 1 1 0 160"/></svg></span> <strong>Configuring jobs</strong></p>
<p>Specific guidance for configuring Slurm jobs on different node types.</p>
<p><a class="autorefs autorefs-internal" title="NVIDIA GH200 GPU Nodes" href="#nvidia-gh200-gpu-nodes"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> GH200 nodes (Daint, Clariden, Santis)</a></p>
<p><a class="autorefs autorefs-internal" title="AMD CPU nodes" href="#amd-cpu-nodes"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> AMD CPU-only nodes (Eiger)</a></p>
</li>
<li>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M256.5 0c14.7 0 28.2 8.1 35.2 21l216 400c6.7 12.4 6.4 27.4-.8 39.5S486.6 480 472.6 480h-432c-14.1 0-27.1-7.4-34.3-19.5s-7.5-27.1-.8-39.5l216-400 2.9-4.6C231.7 6.2 243.6 0 256.5 0m-86.1 249.9 26.8 26.8c6.2 6.2 16.4 6.2 22.6 0l43.3-43.3c6-6 14.1-9.4 22.6-9.4h42.8L256.4 90.5l-86.1 159.4zM496.5 160a80 80 0 1 1 0-160 80 80 0 1 1 0 160"/></svg></span> <strong>Node sharing</strong></p>
<p>Guides on how to effectively use all resources on nodes by running more than one job per node.</p>
<p><a class="autorefs autorefs-internal" href="#node-sharing"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Node sharing</a></p>
<p><a class="autorefs autorefs-internal" title="Running more than one job step per node" href="#running-more-than-one-job-step-per-node"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Multiple MPI jobs per node</a></p>
</li>
</ul>
</div>
<h2 id="accounts-and-resources">Accounts and resources<a class="headerlink" href="#accounts-and-resources" title="Permanent link">&para;</a></h2>
<p>Slurm associates each job with a CSCS project in order to perform accounting.
The project to use for accounting is specified using the <code>--account/-A</code> flag.
If no job is specified, the primary project is used as the default.</p>
<details class="example">
<summary>Which projects am I a member of?</summary>
<p>Users often are part of multiple projects, and by extension their associated <code>groupd_id</code> groups.
You can get a list of your groups using the <code>id</code> command in the terminal:
<div class="language-console highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">$ </span>id<span class="w"> </span><span class="nv">$USER</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">uid=12345(bobsmith) gid=32819(g152) groups=32819(g152),33119(g174),32336(vasp6)</span>
</span></code></pre></div>
Here the user <code>bobsmith</code> is in three projects (<code>g152</code>, <code>g174</code> and <code>vasp6</code>), with the project <code>g152</code> being their <strong>primary project</strong>.</p>
</details>
<details class="example">
<summary>What is my primary project?</summary>
<p>In the terminal, use the following command to find your <strong>primary group</strong>:
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="gp">$ </span>id<span class="w"> </span>-gn<span class="w"> </span><span class="nv">$USER</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="go">g152</span>
</span></code></pre></div></p>
</details>
<div class="language-console highlight"><span class="filename">Specifying the account on the command line</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="gp">$ </span>srun<span class="w"> </span>-A<span class="w"> </span>g123<span class="w">        </span>-n4<span class="w"> </span>-N1<span class="w"> </span>./run
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="gp">$ </span>srun<span class="w"> </span>--account<span class="o">=</span>g123<span class="w"> </span>-n4<span class="w"> </span>-N1<span class="w"> </span>./run
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="gp">$ </span>sbatch<span class="w"> </span>--account<span class="o">=</span>g123<span class="w"> </span>./job.sh
</span></code></pre></div>
<div class="language-bash highlight"><span class="filename">Specifying the account in an sbatch script</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c1">#SBATCH --account=g123</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1">#SBATCH --job-name=example-%j</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="c1">#SBATCH --time=00:30:00</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="c1">#SBATCH --nodes=4</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>...
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The flags <code>--account</code> and <code>-Cmc</code> that were required on the old <a class="autorefs autorefs-internal" href="../../clusters/eiger/#eiger">Eiger</a> cluster are no longer required.</p>
</div>
<h2 id="prioritisation-and-scheduling">Prioritisation and scheduling<a class="headerlink" href="#prioritisation-and-scheduling" title="Permanent link">&para;</a></h2>
<p>Job priorities are determined based on each project&rsquo;s resource usage relative to its quarterly allocation, as well as in comparison to other projects.
An aging factor is also applied to each job in the queue to ensure fairness over time.</p>
<p>Since users from various projects are continuously submitting jobs, the relative priority of jobs is dynamic and may change frequently.
As a result, estimated start times are approximate and subject to change based on new job submissions.</p>
<p>Additionally, short-duration jobs may be selected for backfilling  a process where the scheduler fills in available time slots while preparing to run a larger, higher-priority job.</p>
<p><a href="" id="ref-slurm-partitions"></a></p>
<h2 id="partitions">Partitions<a class="headerlink" href="#partitions" title="Permanent link">&para;</a></h2>
<p>At CSCS, Slurm is configured to accommodate the diverse range of node types available in our HPC clusters.
These nodes vary in architecture, including CPU-only nodes and nodes equipped with different types of GPUs.
Because of this heterogeneity, Slurm must be tailored to ensure efficient resource allocation, job scheduling, and workload management specific to each node type.</p>
<p>Each type of node has different resource constraints and capabilities, which Slurm takes into account when scheduling jobs.
For example, CPU-only nodes may have configurations optimized for multi-threaded CPU workloads, while GPU nodes require additional parameters to allocate GPU resources efficiently.
Slurm ensures that user jobs request and receive the appropriate resources while preventing conflicts or inefficient utilization.</p>
<p><a href="" id="ref-slurm-partitions-nodecount"></a></p>
<div class="admonition example">
<p class="admonition-title">How to check the partitions and number of nodes therein?</p>
<p>You can check the size of the system by running the following command in the terminal:
<div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="gp">$ </span>sinfo<span class="w"> </span>--format<span class="w"> </span><span class="s2">&quot;| %20R | %10D | %10s | %10l | %10A |&quot;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="go">| PARTITION            | NODES      | JOB_SIZE   | TIMELIMIT  | NODES(A/I) |</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="go">| debug                | 32         | 1-2        | 30:00      | 3/29       |</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="go">| normal               | 1266       | 1-infinite | 1-00:00:00 | 812/371    |</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="go">| xfer                 | 2          | 1          | 1-00:00:00 | 1/1        |</span>
</span></code></pre></div>
The last column shows the number of nodes that have been allocated in currently running jobs (<code>A</code>) and the number of jobs that are idle (<code>I</code>).</p>
</div>
<p><a href="" id="ref-slurm-partition-debug"></a></p>
<h3 id="debug-partition">Debug partition<a class="headerlink" href="#debug-partition" title="Permanent link">&para;</a></h3>
<p>The Slurm <code>debug</code> partition is useful for quick turnaround workflows. The partition has a short maximum time (timelimit can be seen with <code>sinfo -p debug</code>), and a low number of maximum nodes (the <code>MaxNodes</code> can be seen with <code>scontrol show partition=debug</code>).</p>
<p><a href="" id="ref-slurm-partition-normal"></a></p>
<h3 id="normal-partition">Normal partition<a class="headerlink" href="#normal-partition" title="Permanent link">&para;</a></h3>
<p>This is the default partition, and will be used when you do not explicitly set a partition.
This is the correct choice for standard jobs. The maximum time is usually set to 24 hours (<code>sinfo -p normal</code> for timelimit), and the maximum nodes can be as much as nodes are available.</p>
<p>The following sections will provide detailed guidance on how to use Slurm to request and manage CPU cores, memory, and GPUs in jobs.
These instructions will help users optimize their workload execution and ensure efficient use of CSCS computing resources.</p>
<h2 id="interactive-jobs">Interactive jobs<a class="headerlink" href="#interactive-jobs" title="Permanent link">&para;</a></h2>
<h3 id="single-node-shell">Single node shell<a class="headerlink" href="#single-node-shell" title="Permanent link">&para;</a></h3>
<p>It is possible to spawn a shell on a compute node to run commands interactively.
This is useful to e.g. compile applications, build container images, etc.
To start an interactive shell on a compute node, you can use the<code>--pty</code> flag and execute your shell:
<div class="language-console highlight"><span class="filename">Single node shell</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="gp"># </span>run<span class="w"> </span>a<span class="w"> </span>bash<span class="w"> </span>shell<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>node
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="gp">$ </span>srun<span class="w"> </span>--pty<span class="w"> </span>bash
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="gp"># </span>use<span class="w"> </span>a<span class="w"> </span>partition<span class="w"> </span><span class="k">for</span><span class="w"> </span>small<span class="w"> </span>jobs:<span class="w"> </span>the<span class="w"> </span>debug<span class="w"> </span>partition<span class="w"> </span>on<span class="w"> </span>most<span class="w"> </span>Alps<span class="w"> </span>system
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="gp"># </span>is<span class="w"> </span>good<span class="w"> </span><span class="k">for</span><span class="w"> </span>this:
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="gp">$ </span>srun<span class="w"> </span>--pty<span class="w"> </span>--partition<span class="o">=</span>debug<span class="w"> </span>bash
</span></code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The example above executes the <code>bash</code> shell, which is the default shell for most users on Alps.
It is also possible to execute a different shell, for example <code>zsh</code>.</p>
</div>
<h3 id="multi-node-allocation">Multi node allocation<a class="headerlink" href="#multi-node-allocation" title="Permanent link">&para;</a></h3>
<p>Sometimes it is useful to first allocate nodes, and then interactively submit jobs to the allocated nodes.
To allocate nodes, you should use the command <code>salloc</code>.
<div class="language-console highlight"><span class="filename">Allocate 2 nodes</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="gp">$ </span>salloc<span class="w"> </span>-N2<span class="w"> </span>--partition<span class="o">=</span>debug
</span></code></pre></div>
This will allocate 2 nodes on the <code>debug</code> partition.
It is not mandatory to use the <code>debug</code> partition with <code>salloc</code>, you can use any partition.
However the <code>debug</code> partition usually has a shorter waiting time to allocate the requested resources.
Now you can run several commands, and they will all run in the same allocation, i.e. they will not go through the SLURM queue.
<div class="language-console highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="gp">$ </span>srun<span class="w"> </span>-n2<span class="w"> </span>hostname
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="gp">$ </span>srun<span class="w"> </span>-n2<span class="w"> </span>date
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="gp"># </span>deallocate<span class="w"> </span>the<span class="w"> </span><span class="m">2</span><span class="w"> </span>nodes
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="gp">$ </span><span class="nb">exit</span>
</span></code></pre></div>
This will first run the command <code>hostname</code> on both nodes, and then it will run as second job the command <code>date</code>.
This allows you to quickly iterate without going for every command through the SLURM queue.
Do not forget to <code>exit</code> the shell, once you are done, otherwise the allocation will consume your node hours compute budget.
If in doubt, use the commands <code>squeue --me</code> to verify if your allocation is still running, and <code>scancel &lt;JOB-ID&gt;</code> to cancel the job (i.e. the allocation).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The command <code>salloc</code> will open a new shell, therefore you can free the allocation with <code>exit</code>.
The newly opened shell will have many <code>SLURM_*</code> environment variables set, most important is the variable <code>SLURM_JOB_ID</code>,
which is used to submit the following <code>srun</code> calls to the allocation.</p>
</div>
<h3 id="connecting-to-node-in-a-running-job">Connecting to node in a running job<a class="headerlink" href="#connecting-to-node-in-a-running-job" title="Permanent link">&para;</a></h3>
<p>It is possible to connect to a node in a running job.
First you will need the <code>jobid</code>, which you can find e.g. via <code>squeue --me</code>.
To connect to the first node of the job use the command
<div class="language-console highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="gp">$ </span>srun<span class="w"> </span>--jobid<span class="o">=</span>&lt;JOB-ID&gt;<span class="w"> </span>--overlap<span class="w"> </span>--pty<span class="w"> </span>bash
</span></code></pre></div>
This will drop you into a shell on the first compute node of the job.
If you want to connect to a specific node of your job, use additionally the flag <code>--nodelist=nidXXXXXX</code>.</p>
<h2 id="affinity">Affinity<a class="headerlink" href="#affinity" title="Permanent link">&para;</a></h2>
<p>The following sections will document how to use Slurm on different compute nodes available on Alps.
To demonstrate the effects different Slurm parameters, we will use a little command line tool <a href="https://github.com/bcumming/affinity">affinity</a> that prints the CPU cores and GPUs that are assigned to each MPI rank in a job, and which node they are run on.</p>
<p>We strongly recommend using a tool like affinity to understand and test the Slurm configuration for jobs, because the behavior of Slurm is highly dependent on the system configuration.
Parameters that worked on a different cluster&mdash;or with a different Slurm version or configuration on the same cluster&mdash;are not guaranteed to give the same results.</p>
<p>It is straightforward to build the affinity tool to experiment with Slurm configurations.</p>
<div class="language-console highlight"><span class="filename">Compiling affinity</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="gp">$ </span>uenv<span class="w"> </span>start<span class="w"> </span>prgenv-gnu/24.11:v2<span class="w"> </span>--view<span class="o">=</span>default<span class="w">     </span><span class="c1">#(1)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="gp">$ </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bcumming/affinity.git
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>affinity<span class="p">;</span><span class="w"> </span>mkdir<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build<span class="p">;</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="gp">$ </span><span class="nv">CC</span><span class="o">=</span>gcc<span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>g++<span class="w"> </span>cmake<span class="w"> </span>..<span class="w">                           </span><span class="c1">#(2)</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="gp">$ </span><span class="nv">CC</span><span class="o">=</span>gcc<span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>g++<span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span>-DAFFINITY_GPU_BACKEND<span class="o">=</span>cuda<span class="w">       </span><span class="c1">#(3)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="gp">$ </span><span class="nv">CC</span><span class="o">=</span>gcc<span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>g++<span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span>-DAFFINITY_GPU_BACKEND<span class="o">=</span>rocm<span class="w">       </span><span class="c1">#(4)</span>
</span></code></pre></div>
<ol>
<li>
<p>Affinity can be built using <a class="autorefs autorefs-internal" href="../../software/prgenv/prgenv-gnu/#prgenv-gnu"><code>prgenv-gnu</code></a> on all clusters.</p>
</li>
<li>
<p>By default affinity will build with MPI support and no GPU support: configure with no additional arguments on a CPU-only system like <a class="autorefs autorefs-internal" href="../../clusters/eiger/#eiger">Eiger</a>.</p>
</li>
<li>
<p>Enable CUDA support on systems that provide NVIDIA GPUs.</p>
</li>
<li>
<p>Enable ROCM support on systems that provide AMD GPUs.</p>
</li>
</ol>
<p>The build generates the following executables:</p>
<ul>
<li><code>affinity.omp</code>: tests thread affinity with no MPI (always built).</li>
<li><code>affinity.mpi</code>: tests thread affinity with MPI (built by default).</li>
<li><code>affinity.cuda</code>: tests thread and GPU affinity with MPI (built with <code>-DAFFINITY_GPU_BACKEND=cuda</code>).</li>
<li><code>affinity.rocm</code>: tests thread and GPU affinity with MPI (built with <code>-DAFFINITY_GPU_BACKEND=rocm</code>).</li>
</ul>
<details class="example">
<summary>Testing CPU affinity</summary>
<p>Test CPU affinity (this can be used on both CPU and GPU enabled nodes).
<div class="language-console highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="gp">$ </span>uenv<span class="w"> </span>start<span class="w"> </span>prgenv-gnu/24.11:v2<span class="w"> </span>--view<span class="o">=</span>default
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="gp">$ </span>srun<span class="w"> </span>-n8<span class="w"> </span>-N2<span class="w"> </span>-c72<span class="w"> </span>./affinity.mpi
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="go">affinity test for 8 MPI ranks</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="go">rank   0 @ nid006363: thread 0 -&gt; cores [  0: 71]</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="go">rank   1 @ nid006363: thread 0 -&gt; cores [ 72:143]</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="go">rank   2 @ nid006363: thread 0 -&gt; cores [144:215]</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="go">rank   3 @ nid006363: thread 0 -&gt; cores [216:287]</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="go">rank   4 @ nid006375: thread 0 -&gt; cores [  0: 71]</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="go">rank   5 @ nid006375: thread 0 -&gt; cores [ 72:143]</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="go">rank   6 @ nid006375: thread 0 -&gt; cores [144:215]</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="go">rank   7 @ nid006375: thread 0 -&gt; cores [216:287]</span>
</span></code></pre></div></p>
<p>In this example there are 8 MPI ranks:</p>
<ul>
<li>ranks <code>0:3</code> are on node <code>nid006363</code>;</li>
<li>ranks <code>4:7</code> are on node <code>nid006375</code>;</li>
<li>each rank has 72 threads numbered <code>0:71</code>;</li>
<li>all threads on each rank have affinity with the same 72 cores;</li>
<li>each rank gets 72 cores, e.g. rank 1 gets cores <code>72:143</code> on node <code>nid006363</code>.</li>
</ul>
</details>
<details class="example">
<summary>Testing GPU affinity</summary>
<p>Use <code>affinity.cuda</code> or <code>affinity.rocm</code> to test on GPU-enabled systems.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="gp">$ </span>srun<span class="w"> </span>-n4<span class="w"> </span>-N1<span class="w"> </span>./affinity.cuda<span class="w">                      </span><span class="c1">#(1)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="go">GPU affinity test for 4 MPI ranks</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="go">rank      0 @ nid005555</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="go"> cores   : [0:7]</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="go"> gpu   0 : GPU-2ae325c4-b542-26c2-d10f-c4d84847f461</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="go"> gpu   1 : GPU-5923dec6-288f-4418-f485-666b93f5f244</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="go"> gpu   2 : GPU-170b8198-a3e1-de6a-ff82-d440f71c05da</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="go"> gpu   3 : GPU-0e184efb-1d1f-f278-b96d-15bc8e5f17be</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="go">rank      1 @ nid005555</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="go"> cores   : [72:79]</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="go"> gpu   0 : GPU-2ae325c4-b542-26c2-d10f-c4d84847f461</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="go"> gpu   1 : GPU-5923dec6-288f-4418-f485-666b93f5f244</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="go"> gpu   2 : GPU-170b8198-a3e1-de6a-ff82-d440f71c05da</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="go"> gpu   3 : GPU-0e184efb-1d1f-f278-b96d-15bc8e5f17be</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="go">rank      2 @ nid005555</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="go"> cores   : [144:151]</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="go"> gpu   0 : GPU-2ae325c4-b542-26c2-d10f-c4d84847f461</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="go"> gpu   1 : GPU-5923dec6-288f-4418-f485-666b93f5f244</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="go"> gpu   2 : GPU-170b8198-a3e1-de6a-ff82-d440f71c05da</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="go"> gpu   3 : GPU-0e184efb-1d1f-f278-b96d-15bc8e5f17be</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="go">rank      3 @ nid005555</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="go"> cores   : [216:223]</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="go"> gpu   0 : GPU-2ae325c4-b542-26c2-d10f-c4d84847f461</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="go"> gpu   1 : GPU-5923dec6-288f-4418-f485-666b93f5f244</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="go"> gpu   2 : GPU-170b8198-a3e1-de6a-ff82-d440f71c05da</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="go"> gpu   3 : GPU-0e184efb-1d1f-f278-b96d-15bc8e5f17be</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="gp">$ </span>srun<span class="w"> </span>-n4<span class="w"> </span>-N1<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>./affinity.cuda<span class="w">    </span><span class="c1">#(2)</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="go">GPU affinity test for 4 MPI ranks</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="go">rank      0 @ nid005675</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="go"> cores   : [0:7]</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="go"> gpu   0 : GPU-a16a8dac-7661-a44b-c6f8-f783f6e812d3</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="go">rank      1 @ nid005675</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="go"> cores   : [72:79]</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="go"> gpu   0 : GPU-ca5160ac-2c1e-ff6c-9cec-e7ce5c9b2d09</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="go">rank      2 @ nid005675</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="go"> cores   : [144:151]</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="go"> gpu   0 : GPU-496a2216-8b3c-878e-e317-36e69af11161</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="go">rank      3 @ nid005675</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="go"> cores   : [216:223]</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="go"> gpu   0 : GPU-766e3b8b-fa19-1480-b02f-0dfd3f2c87ff</span>
</span></code></pre></div>
<ol>
<li>
<p>Test GPU affinity: note how all 4 ranks see the same 4 GPUs.</p>
</li>
<li>
<p>Test GPU affinity: note how the <code>--gpus-per-task=1</code> parameter assigns a unique GPU to each rank.</p>
</li>
</ol>
</details>
<div class="admonition info">
<p class="admonition-title">Quick affinity checks</p>
<p>The Slurm flag <a href="https://slurm.schedmd.com/srun.html#OPT_cpu-bind"><code>--cpu-bind=verbose</code></a> prints information about MPI ranks and their thread affinity.</p>
<p>The mask it prints is not very readable, but it can be used with the <code>true</code> command to quickly test Slurm parameters without building the Affinity tool.</p>
<div class="language-console highlight"><span class="filename">hello</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="gp">$ </span>srun<span class="w"> </span>--cpu-bind<span class="o">=</span>verbose<span class="w"> </span>-c32<span class="w"> </span>-n4<span class="w"> </span>-N1<span class="w"> </span>--hint<span class="o">=</span>nomultithread<span class="w"> </span>--<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="go">cpu-bind=MASK - nid002156, task  0  0 [147694]: mask 0xffffffff set</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="go">cpu-bind=MASK - nid002156, task  1  1 [147695]: mask 0xffffffff0000000000000000 set</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="go">cpu-bind=MASK - nid002156, task  2  2 [147696]: mask 0xffffffff00000000 set</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="go">cpu-bind=MASK - nid002156, task  3  3 [147697]: mask 0xffffffff000000000000000000000000 set</span>
</span></code></pre></div>
<p>You can also check GPU affinity by inspecting the value of the <code>CUDA_VISIBLE_DEVICES</code> environment variable.</p>
</div>
<p><a href="" id="ref-slurm-features"></a></p>
<h2 id="slurm-features">Slurm features<a class="headerlink" href="#slurm-features" title="Permanent link">&para;</a></h2>
<p>Slurm allows specifying <a href="https://slurm.schedmd.com/sbatch.html#OPT_constraint">constraints</a> for jobs, which can be used to change features available on nodes in a job.
CSCS implements a few custom features, described below, that can be selected on certain clusters.
To check which features are available on a cluster, for example on the <code>normal</code> partition, use <code>sinfo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="gp">$ </span>sinfo<span class="w"> </span>--partition<span class="w"> </span>normal<span class="w"> </span>--format<span class="w"> </span>%b
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="go">ACTIVE_FEATURES</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="go">gh,gpu,thp_never,thp_always,thp_madvise,nvidia_vboost_enabled,nvidia_vboost_disabled</span>
</span></code></pre></div>
<p>One or more constraints can be selected using the <code>--constraint</code>/<code>-C</code> flag of <code>sbatch</code> or <code>srun</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sbatch<span class="w"> </span>--constraint<span class="w"> </span>thp_never<span class="p">&amp;</span>nvidia_vboost_enabled<span class="w"> </span>batch.sh
</span></code></pre></div>
<p><a href="" id="ref-slurm-features-thp"></a></p>
<h3 id="transparent-hugepages">Transparent hugepages<a class="headerlink" href="#transparent-hugepages" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">The THP Slurm feature is only available on <a class="autorefs autorefs-internal" title="NVIDIA GH200 GPU Nodes" href="../../alps/hardware/#nvidia-gh200-gpu-nodes">GH200 nodes</a></p>
</div>
<p><a href="https://www.kernel.org/doc/html/v6.17/admin-guide/mm/transhuge.html">Transparent hugepages (THP)</a> are a Linux kernel feature that allows automatically coalescing pages into huge pages without the user application explicitly asking for hugepages:</p>
<blockquote>
<p>Performance critical computing applications dealing with large memory working sets are already running on top of libhugetlbfs and in turn hugetlbfs.
Transparent HugePage Support (THP) is an alternative mean of using huge pages for the backing of virtual memory with huge pages that supports the automatic promotion and demotion of page sizes and without the shortcomings of hugetlbfs.</p>
</blockquote>
<p>While this feature generally improves performance, we have observed degrading application performance with the THP feature enabled due to the page coalescing blocking progress on certain operations.
An example of this is ICON, a latency-sensitive application where small delays can can cause large performance drops.</p>
<p>THP support is enabled by default, and the current setting can be checked with:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="gp">$ </span>cat<span class="w"> </span>/sys/kernel/mm/transparent_hugepage/enabled
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="go">[always] madvise never</span>
</span></code></pre></div>
<p>A detailed explanation of how the different options behave can be found in the <a href="https://www.kernel.org/doc/html/v6.17/admin-guide/mm/transhuge.html#global-thp-controls">THP documentation</a>.</p>
<p>The available Slurm features to select the THP mode are listed below:</p>
<table>
<thead>
<tr>
<th>Kernel setting</th>
<th>Slurm constraint</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>always</code></td>
<td><code>thp_always</code> (default)</td>
</tr>
<tr>
<td><code>madvise</code></td>
<td><code>thp_madvise</code></td>
</tr>
<tr>
<td><code>never</code></td>
<td><code>thp_never</code></td>
</tr>
</tbody>
</table>
<p><a href="" id="ref-slurm-features-vboost"></a></p>
<h3 id="nvidia-vboost">NVIDIA vboost<a class="headerlink" href="#nvidia-vboost" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">The NVIDIA vboost Slurm feature is only available on <a class="autorefs autorefs-internal" title="NVIDIA GH200 GPU Nodes" href="../../alps/hardware/#nvidia-gh200-gpu-nodes">GH200 nodes</a></p>
</div>
<p>The <a href="https://docs.nvidia.com/nemo-framework/user-guide/latest/performance/performance-guide.html#gpu-core-clock-optimization">NVIDIA NeMo documentation</a> describes the vboost feature as:</p>
<blockquote>
<p>NVIDIA GPUs support a CPU core clock boost mode, which increases the core clock rate by reducing the off-chip memory clock rate.
This is particularly beneficial for LLMs, which are typically compute throughput-bound.</p>
</blockquote>
<p>The vboost slider is at <code>0</code> by default, and the current value can be checked checked with <code>nvidia-smi</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="gp">$ </span>nvidia-smi<span class="w"> </span>boost-slider<span class="w"> </span>--list
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="go">+-------------------------------------------------+</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="go">| GPU Boost Slider                                |</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="go">| GPU     Slider       Max Value    Current Value |</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="go">|=================================================|</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="go">|   0     vboost           4              0       |</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="go">+-------------------------------------------------+</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="go">|   1     vboost           4              0       |</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="go">+-------------------------------------------------+</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="go">|   2     vboost           4              0       |</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="go">+-------------------------------------------------+</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="go">|   3     vboost           4              0       |</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="go">+-------------------------------------------------+</span>
</span></code></pre></div>
<p>The slider can be set to <code>1</code> using the <code>nvidia_vboost_enable</code> feature:</p>
<table>
<thead>
<tr>
<th>vboost setting</th>
<th>Slurm constraint</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td><code>nvidia_vboost_disable</code> (default)</td>
</tr>
<tr>
<td><code>1</code></td>
<td><code>nvidia_vboost_enable</code></td>
</tr>
</tbody>
</table>
<p><a href="" id="ref-slurm-gh200"></a></p>
<h2 id="nvidia-gh200-gpu-nodes">NVIDIA GH200 GPU Nodes<a class="headerlink" href="#nvidia-gh200-gpu-nodes" title="Permanent link">&para;</a></h2>
<p>The <a class="autorefs autorefs-internal" title="NVIDIA GH200 GPU Nodes" href="../../alps/hardware/#nvidia-gh200-gpu-nodes">GH200 nodes on Alps</a> have four GPUs per node, and Slurm job submissions must be configured appropriately to best make use of the resources.
Applications that can saturate the GPUs with a single process per GPU should generally prefer this mode.
<a class="autorefs autorefs-internal" title="One rank per GPU" href="#one-rank-per-gpu">Configuring Slurm jobs to use a single GPU per rank</a> is also the most straightforward setup.
Some applications perform badly with a single rank per GPU, and require use of <a href="https://docs.nvidia.com/deploy/mps/index.html">NVIDIA&rsquo;s Multi-Process Service (MPS)</a> to oversubscribe GPUs with multiple ranks per GPU.</p>
<p>The best Slurm configuration is application- and workload-specific, so it is worth testing which works best in your particular case.
See <a class="autorefs autorefs-internal" href="../../software/sciapps/#scientific-applications">Scientific Applications</a> for information about recommended application-specific Slurm configurations.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The GH200 nodes have their GPUs configured in <a href="https://docs.nvidia.com/deploy/mps/index.html#gpu-compute-modes">&ldquo;default&rdquo; compute mode</a>.
The &ldquo;default&rdquo; mode is used to avoid issues with certain containers.
Unlike &ldquo;exclusive process&rdquo; mode, &ldquo;default&rdquo; mode allows multiple processes to submit work to a single GPU simultaneously.
This also means that different ranks on the same node can inadvertently use the same GPU leading to suboptimal performance or unused GPUs, rather than job failures.</p>
<p>Some applications benefit from using multiple ranks per GPU. However, <a class="autorefs autorefs-internal" title="Multiple ranks per GPU" href="#multiple-ranks-per-gpu">MPS should be used</a> in these cases.</p>
<p>If you are unsure about which GPU is being used for a particular rank, print the <code>CUDA_VISIBLE_DEVICES</code> variable, along with e.g. <code>SLURM_LOCALID</code>, <code>SLURM_PROCID</code>, and <code>SLURM_NODEID</code> variables, in your job script.
If the variable is unset or empty all GPUs are visible to the rank and the rank will in most cases only use the first GPU.</p>
</div>
<p><a href="" id="ref-slurm-gh200-single-rank-per-gpu"></a></p>
<h3 id="one-rank-per-gpu">One rank per GPU<a class="headerlink" href="#one-rank-per-gpu" title="Permanent link">&para;</a></h3>
<p>Configuring Slurm to use one GH200 GPU per rank is easiest done using the <code>--ntasks-per-node=4</code> and <code>--gpus-per-task=1</code> Slurm flags.
For advanced users, using <code>--gpus-per-task</code> is equivalent to setting <code>CUDA_VISIBLE_DEVICES</code> to <code>SLURM_LOCALID</code>, assuming the job is using four ranks per node.
The examples below launch jobs on two nodes with four ranks per node using <code>sbatch</code> and <code>srun</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1">#SBATCH --job-name=gh200-single-rank-per-gpu</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1">#SBATCH --nodes=2</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1">#SBATCH --ntasks-per-node=4</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c1">#SBATCH --gpus-per-task=1</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>srun<span class="w"> </span>&lt;application&gt;
</span></code></pre></div>
<p>Omitting the <code>--gpus-per-task</code> results in <code>CUDA_VISIBLE_DEVICES</code> being unset, which will lead to most applications using the first GPU on all ranks.</p>
<p><a href="" id="ref-slurm-gh200-multi-rank-per-gpu"></a></p>
<h3 id="multiple-ranks-per-gpu">Multiple ranks per GPU<a class="headerlink" href="#multiple-ranks-per-gpu" title="Permanent link">&para;</a></h3>
<p>Using multiple ranks per GPU can improve performance e.g. of applications that don&rsquo;t generate enough work for a GPU using a single rank, or ones that scale badly to all 72 cores of the Grace CPU.
In these cases Slurm jobs must be configured to assign multiple ranks to a single GPU.
This is best done using <a href="https://docs.nvidia.com/deploy/mps/index.html">NVIDIA&rsquo;s Multi-Process Service (MPS)</a>.
To use MPS, launch your application using the following wrapper script, which will use one rank per node to start an MPS daemon for each GPU of the node,
and assign GPUs to ranks according to the CPU mask of a rank, ensuring the closest GPU is used:</p>
<div class="language-bash highlight"><span class="filename">mps-wrapper.sh</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nb">set</span><span class="w"> </span>-eu
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="nv">mps_prefix</span><span class="o">=</span><span class="s2">&quot;/tmp/</span><span class="k">$(</span>id<span class="w"> </span>-un<span class="k">)</span><span class="s2">/slurm-</span><span class="si">${</span><span class="nv">SLURM_JOBID</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">SLURM_STEPID</span><span class="si">}</span><span class="s2">/nvidia&quot;</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="nv">num_gpus</span><span class="o">=</span><span class="m">4</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="c1"># Reset CUDA environment variables to default values without MPS</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_DEVICE_MAX_CONNECTIONS</span><span class="o">=</span><span class="m">8</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_DEVICE_MAX_COPY_CONNECTIONS</span><span class="o">=</span><span class="m">8</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="c1"># Each GPU is attached to the corresponding NUMA node</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="c1"># Disable HWLOC_KEEP_NVIDIA_GPU_NUMA_NODES to avoid GPU NUMA nodes appearing in the list of CUDA devices</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="nv">numa_node</span><span class="o">=</span><span class="k">$(</span><span class="nv">HWLOC_KEEP_NVIDIA_GPU_NUMA_NODES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>hwloc-calc<span class="w"> </span>--physical<span class="w"> </span>--intersect<span class="w"> </span>NUMAnode<span class="w"> </span><span class="k">$(</span>hwloc-bind<span class="w"> </span>--get<span class="w"> </span>--taskset<span class="k">))</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="c1"># We expect exactly one non-negative integer for the NUMA node</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">numa_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>+$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The MPS wrapper script only works when the process mask of the rank is adjacent to exactly one GPU. The CPU mask is </span><span class="k">$(</span>hwloc-bind<span class="w"> </span>--get<span class="w"> </span>--taskset<span class="k">)</span><span class="s2"> and the list of adjacent numa nodes is </span><span class="si">${</span><span class="nv">numa_node</span><span class="si">}</span><span class="s2"> for rank </span><span class="si">${</span><span class="nv">SLURM_PROCID</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="k">fi</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="k">function</span><span class="w"> </span>start_daemon<span class="w"> </span><span class="o">{</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="o">=</span><span class="si">${</span><span class="nv">mps_prefix</span><span class="si">}</span>-mps-<span class="si">${</span><span class="nv">1</span><span class="si">}</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_MPS_LOG_DIRECTORY</span><span class="o">=</span><span class="si">${</span><span class="nv">mps_prefix</span><span class="si">}</span>-log-<span class="si">${</span><span class="nv">1</span><span class="si">}</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUDA_MPS_LOG_DIRECTORY</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">    </span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="w"> </span>nvidia-cuda-mps-control<span class="w"> </span>-d
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="o">}</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="c1"># Start MPS control daemons from a single rank per node, one for each GPU on the node</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$SLURM_LOCALID</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">    </span><span class="c1"># We attempt to kill previous MPS instances, but if we can&#39;t (either none</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">    </span><span class="c1"># have been started or they are unkillable) we ignore it and attempt to run</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">    </span><span class="c1"># anyway</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">    </span>pkill<span class="w"> </span>--uid<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-un<span class="k">)</span><span class="w"> </span><span class="s1">&#39;^nvidia-cuda-mps-&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">$((</span><span class="nv">num_gpus</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="k">)))</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="w">        </span>start_daemon<span class="w"> </span><span class="si">${</span><span class="nv">i</span><span class="si">}</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="w">    </span><span class="k">done</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="k">fi</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="c1"># Set MPS options for this rank. Each rank will access the MPS of the GPU</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="c1"># corresponding to the NUMA node. CUDA_VISIBLE_DEVICES should not be set. The</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="c1"># chosen MPS determines which device is visible.</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="o">=</span><span class="si">${</span><span class="nv">mps_prefix</span><span class="si">}</span>-mps-<span class="si">${</span><span class="nv">numa_node</span><span class="si">}</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_MPS_LOG_DIRECTORY</span><span class="o">=</span><span class="si">${</span><span class="nv">mps_prefix</span><span class="si">}</span>-log-<span class="si">${</span><span class="nv">numa_node</span><span class="si">}</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="c1"># Wait until the control daemon for our rank is up. The daemon creates a pid</span>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="c1"># file which we can wait for. See</span>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a><span class="c1"># https://docs.nvidia.com/deploy/mps/appendix-tools-and-interface-reference.html.</span>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="c1"># Wait up to mps_pid_file_timeout seconds for the pid file to be created. In</span>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="c1"># jobs with a large number of ranks some ranks may take a long time to start. If</span>
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="c1"># that happens consider increasing the timeout.</span>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a><span class="nv">mps_pid_file_timeout</span><span class="o">=</span><span class="m">120</span>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a><span class="nv">pid_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="si">}</span><span class="s2">/nvidia-cuda-mps-control.pid&quot;</span>
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>timeout<span class="w"> </span><span class="si">${</span><span class="nv">mps_pid_file_timeout</span><span class="si">}</span><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;until [[ -f \&quot;</span><span class="si">${</span><span class="nv">pid_file</span><span class="si">}</span><span class="s2">\&quot; ]]; do sleep 1; done&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The MPS wrapper script timed out waiting for MPS pid file </span><span class="si">${</span><span class="nv">pid_file</span><span class="si">}</span><span class="s2"> on rank </span><span class="si">${</span><span class="nv">SLURM_PROCID</span><span class="si">}</span><span class="s2">. MPS daemon likely did not start correctly or the rank starting the MPS daemons took too long to start.&quot;</span>
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a><span class="k">fi</span>
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a>
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a><span class="c1"># Run the command</span>
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a><span class="c1"># We are using `exec`, because we want e.g. signals to be forwarded directly to the application, and not this wrapper script</span>
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p>One limitation of the script above is that CPU bindings only belong to one NUMA domain.
It is currently up to the user to ensure that this limitation is respected when configuring Slurm jobs.</p>
<div class="admonition warning">
<p class="admonition-title">CUDA environment variables</p>
<p>The MPS wrapper script above resets the <code>CUDA_DEVICE_MAX_CONNECTIONS</code> and <code>CUDA_DEVICE_MAX_COPY_CONNECTIONS</code> environment variables to their default values.
If your application requires different values for these variables, modify the script accordingly.</p>
</div>
<p>Save the above script as <code>mps-wrapper.sh</code> and make it executable with <code>chmod +x mps-wrapper.sh</code>.
If the <code>mps-wrapper.sh</code> script is in the current working directory, you can then launch jobs using MPS for example as follows:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="c1">#SBATCH --job-name=gh200-multiple-ranks-per-gpu</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="c1">#SBATCH --nodes=2</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1">#SBATCH --ntasks-per-node=32</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="c1">#SBATCH --cpus-per-task=8</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>srun<span class="w"> </span>./mps-wrapper.sh<span class="w"> </span>&lt;application&gt;
</span></code></pre></div>
<p>Note that in the example job above:</p>
<ul>
<li><code>--gpus-per-node</code> is not set at all; the <code>mps-wrapper.sh</code> script ensures that the right GPU is visible for each rank using <code>CUDA_VISIBLE_DEVICES</code></li>
<li><code>--ntasks-per-node</code> is set to 32; this results in 8 ranks per GPU</li>
<li><code>--cpus-per-task</code> is set to 8; this ensures that threads are not allowed to migrate across the whole GH200 node</li>
</ul>
<p>The configuration that is optimal for your application may be different.</p>
<p><a href="" id="ref-slurm-gh200-power-capping"></a></p>
<h3 id="gh200-power-capping">GH200 power capping<a class="headerlink" href="#gh200-power-capping" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This power capping functionality is an experimental feature developed by CSCS.
It is currently being tested with key users on the Starlex test cluster.</p>
<p>This documentation will be updated once it has been deployed onto the production clusters.</p>
</div>
<p>The combined power of each GH200 module (CPU + GPU) on Alps is capped at approximately 660 W.
The modules are configured such that CPU power requirements have priority over GPU requirements, which can impact GPU performance for applications that overlap CPU and GPU computations.
If an application uses many CPU cores concurrently with the GPU, there may not be sufficient power available for the GPU.</p>
<p>To mitigate this, CSCS provides a Slurm option that allows setting a power cap for the CPU.
However, this also limits CPU power when the GPU is not in use. Therefore, this feature should only be used for applications that use both CPU and GPU simultaneously, and it may require experimentation with different settings to achieve optimal performance.</p>
<p>The CPU power cap is set using <code>--power-cap=&lt;value&gt;</code>, where <code>&lt;value&gt;</code> is the power cap in watts, in the range <code>50300</code>.</p>
<p>It can be set either for the entire job in an sbatch script:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">#SBATCH --power-cap=100</span>
</span></code></pre></div>
or for an individual job step using srun:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>srun<span class="w"> </span>-n4<span class="w"> </span>-N1<span class="w"> </span>--power-cap<span class="o">=</span><span class="m">100</span><span class="w"> </span>./run
</span></code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If <code>--power-cap</code> is specified both in <code>sbatch</code> and in <code>srun</code>, the value set in <code>srun</code> takes precedence.
This allows fine-tuning the CPU power cap for individual job steps.</p>
<p>However, when multiple <code>srun</code> commands are executed in parallel (for example using background execution with <code>&amp;</code>), each <code>srun</code> may overwrite the currently active power cap.
In this case, the last <code>srun</code> that applies its setting determines the effective power cap.</p>
<p>Running multiple parallel <code>srun</code> commands with the <strong>same</strong> <code>--power-cap</code> value is safe.
Using <strong>different</strong> values in parallel <code>srun</code> commands may lead to unintended behavior and should be avoided.</p>
</div>
<p><a href="" id="ref-slurm-amdcpu"></a></p>
<h2 id="amd-cpu-nodes">AMD CPU nodes<a class="headerlink" href="#amd-cpu-nodes" title="Permanent link">&para;</a></h2>
<p>Alps has nodes with two AMD Epyc Rome CPU sockets per node for CPU-only workloads, most notably in the <a class="autorefs autorefs-internal" href="../../clusters/eiger/#eiger">Eiger</a> cluster provided by the <a class="autorefs autorefs-internal" href="../../platforms/hpcp/#hpc-platform">HPC Platform</a>.
For a detailed description of the node hardware, see the <a class="autorefs autorefs-internal" title="AMD Rome CPU Nodes" href="../../alps/hardware/#amd-rome-cpu-nodes">AMD Rome node</a> hardware documentation.</p>
<details class="info">
<summary>Node description</summary>
<ul>
<li>The node has 2 x 64 core sockets</li>
<li>Each socket is divided into 4 NUMA regions<ul>
<li>the 16 cores in each NUMA region have faster memory access to their of 32 GB</li>
</ul>
</li>
<li>Each core has two processing units (PUs)</li>
</ul>
<p><img alt="Screenshot" src="../../images/slurm/eiger-topo.png" /></p>
</details>
<p>Each MPI rank is assigned a set of cores on a node, and Slurm provides flags that can be used directly as flags to <code>srun</code>, or as arguments in an <code>sbatch</code> script.
Here are some basic flags that we will use to distribute work.</p>
<table>
<thead>
<tr>
<th>flag</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-n</code>, <code>--ntasks</code></td>
<td>The total number of MPI ranks</td>
</tr>
<tr>
<td><code>-N</code>, <code>--nodes</code></td>
<td>The total number of nodes</td>
</tr>
<tr>
<td><code>--ntasks-per-node</code></td>
<td>The total number of nodes</td>
</tr>
<tr>
<td><code>-c</code>, <code>--cpus-per-task</code></td>
<td>The number of cores to assign to each rank.</td>
</tr>
<tr>
<td><code>--hint=nomultithread</code></td>
<td>Use only one PU per core</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Slurm is highly configurable</p>
<p>These are a subset of the most useful flags.
Call <code>srun --help</code> or <code>sbatch --help</code> to get a complete list of all the flags available on your target cluster.
Note that the exact set of flags available depends on the Slurm version, how Slurm was configured, and Slurm plugins.</p>
</div>
<p>The first example assigns 2 MPI ranks per node, with 64 cores per rank, with the two PUs per core:
<div class="language-console highlight"><span class="filename">One MPI rank per socket</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="gp"># </span>one<span class="w"> </span>node
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="gp">$ </span>srun<span class="w"> </span>-n2<span class="w"> </span>-N1<span class="w"> </span>-c64<span class="w"> </span>./affinity.mpi
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="go">affinity test for 2 MPI ranks</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="go">rank   0 @ nid002199: thread 0 -&gt; cores [  0: 31,128:159]</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="go">rank   1 @ nid002199: thread 0 -&gt; cores [ 64: 95,192:223]</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="gp"># </span>two<span class="w"> </span>nodes
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="gp">$ </span>srun<span class="w"> </span>-n4<span class="w"> </span>-N2<span class="w"> </span>-c64<span class="w"> </span>./affinity.mpi
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="go">affinity test for 4 MPI ranks</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="go">rank   0 @ nid001512: thread 0 -&gt; cores [  0: 31,128:159]</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="go">rank   1 @ nid001512: thread 0 -&gt; cores [ 64: 95,192:223]</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="go">rank   2 @ nid001515: thread 0 -&gt; cores [  0: 31,128:159]</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="go">rank   3 @ nid001515: thread 0 -&gt; cores [ 64: 95,192:223]</span>
</span></code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the above example we use <code>--ntasks/-n</code> and <code>--nodes/-N</code>.
It is possible to achieve the same effect using <code>--nodes</code> and <code>--ntasks-per-node</code>, for example the following both give 8 ranks on 4 nodes:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>srun<span class="w"> </span>--nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--ntasks<span class="o">=</span><span class="m">8</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>srun<span class="w"> </span>--nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">2</span>
</span></code></pre></div>
</div>
<p>It is often more efficient to only run one task per core instead of the default two PU, which can be achieved using the <code>--hint=nomultithread</code> option.
<div class="language-console highlight"><span class="filename">One MPI rank per socket with 1 PU per core</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="gp">$ </span>srun<span class="w"> </span>-n2<span class="w"> </span>-N1<span class="w"> </span>-c64<span class="w"> </span>--hint<span class="o">=</span>nomultithread<span class="w"> </span>./affinity.mpi
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="go">affinity test for 2 MPI ranks</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="go">rank   0 @ nid002199: thread 0 -&gt; cores [  0: 63]</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="go">rank   1 @ nid002199: thread 0 -&gt; cores [ 64:127]</span>
</span></code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Always test</p>
<p>The best configuration for performance is highly application specific, with no one-size-fits-all configuration.
Take the time to experiment with <code>--hint=nomultithread</code>.</p>
</div>
<p>Memory on the node is divided into NUMA (non-uniform memory access) regions.
The 256 GB of a standard-memory node are divided into 8 NUMA nodes of 32 GB, with 16 cores associated with each node:</p>
<ul>
<li>memory access is optimal when all the cores of a rank are on the same NUMA node;</li>
<li>memory access to NUMA regions on the other socket are significantly slower.</li>
</ul>
<details class="info">
<summary>How to investigate the NUMA layout of a node</summary>
<p>Use the command <code>numactl -H</code>.</p>
<p><div class="language-console highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="gp">$ </span>srun<span class="w"> </span>-n1<span class="w"> </span>numactl<span class="w"> </span>-H
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="go">available: 8 nodes (0-7)</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="go">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="go">node 0 size: 63733 MB</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="go">node 0 free: 62780 MB</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="go">node 1 cpus: 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="go">node 1 size: 64502 MB</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="go">node 1 free: 61774 MB</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="go">node 2 cpus: 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="go">node 2 size: 64456 MB</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="go">node 2 free: 63385 MB</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="go">node 3 cpus: 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="go">node 3 size: 64490 MB</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="go">node 3 free: 62613 MB</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="go">node 4 cpus: 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="go">node 4 size: 64502 MB</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="go">node 4 free: 63897 MB</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="go">node 5 cpus: 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="go">node 5 size: 64502 MB</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="go">node 5 free: 63769 MB</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="go">node 6 cpus: 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="go">node 6 size: 64502 MB</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="go">node 6 free: 63870 MB</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="go">node 7 cpus: 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="go">node 7 size: 64428 MB</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="go">node 7 free: 63712 MB</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="go">node distances:</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="go">node   0   1   2   3   4   5   6   7</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="go">  0:  10  12  12  12  32  32  32  32</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="go">  1:  12  10  12  12  32  32  32  32</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="go">  2:  12  12  10  12  32  32  32  32</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="go">  3:  12  12  12  10  32  32  32  32</span>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="go">  4:  32  32  32  32  10  12  12  12</span>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="go">  5:  32  32  32  32  12  10  12  12</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="go">  6:  32  32  32  32  12  12  10  12</span>
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="go">  7:  32  32  32  32  12  12  12  10</span>
</span></code></pre></div>
The <code>node distances</code> table shows that the cores have the fastest memory access to memory in their own region (<code>10</code>), and fast access (<code>12</code>) to NUMA regions on the same socket.
The cost of accessing memory of a NUMA node on the other socket is much higher (<code>32</code>).</p>
<p>Note that this command was run on a large-memory node that has 8 x 64 GB NUMA regions, for a total of 512 GB.</p>
</details>
<p>The examples above placed one rank per socket, which is not optimal for NUMA access, because cores assigned to each rank are spread over the 4 NUMA nodes on the socket.
To constrain tasks to NUMA nodes, use 16 cores per task:</p>
<div class="language-console highlight"><span class="filename">One MPI rank per NUMA region</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="gp">$ </span>srun<span class="w"> </span>-n8<span class="w"> </span>-N1<span class="w"> </span>-c16<span class="w"> </span>--hint<span class="o">=</span>nomultithread<span class="w"> </span>./affinity.mpi
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="go">affinity test for 8 MPI ranks</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="go">rank   0 @ nid002199: thread 0 -&gt; cores [  0: 15]</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="go">rank   1 @ nid002199: thread 0 -&gt; cores [ 64: 79]</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="go">rank   2 @ nid002199: thread 0 -&gt; cores [ 16: 31]</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="go">rank   3 @ nid002199: thread 0 -&gt; cores [ 80: 95]</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="go">rank   4 @ nid002199: thread 0 -&gt; cores [ 32: 47]</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="go">rank   5 @ nid002199: thread 0 -&gt; cores [ 96:111]</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="go">rank   6 @ nid002199: thread 0 -&gt; cores [ 48: 63]</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="go">rank   7 @ nid002199: thread 0 -&gt; cores [112:127]</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Always test</p>
<p>It might still be optimal for applications that have high threading efficiency and benefit from using fewer MPI ranks to have one rank per socket or even one one rank per node.
Always test!</p>
</div>
<h3 id="openmp">OpenMP<a class="headerlink" href="#openmp" title="Permanent link">&para;</a></h3>
<p>In the above examples all threads on each&mdash;we are effectively allowing the OS to schedule the threads on the available set of cores as it sees fit.
This often gives the best performance, however sometimes it is beneficial to bind threads to explicit cores.</p>
<p>The OpenMP threading runtime provides additional options for controlling the pinning of threads to the cores assigned to each MPI rank.</p>
<p>Use the <code>--omp</code> flag with <code>affinity.mpi</code> to get more detailed information about OpenMP thread affinity.
For example, four MPI ranks on one node with four cores and four OpenMP threads:</p>
<div class="language-console highlight"><span class="filename">No OpenMP binding</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">4</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="gp">$ </span>srun<span class="w"> </span>-n4<span class="w"> </span>-N1<span class="w"> </span>-c4<span class="w"> </span>--hint<span class="o">=</span>nomultithread<span class="w"> </span>./affinity.mpi<span class="w"> </span>--omp
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="go">affinity test for 4 MPI ranks</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="go">rank   0 @ nid001512: threads [0:3] -&gt; cores [  0:  3]</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="go">rank   1 @ nid001512: threads [0:3] -&gt; cores [ 64: 67]</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="go">rank   2 @ nid001512: threads [0:3] -&gt; cores [  4:  7]</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="go">rank   3 @ nid001512: threads [0:3] -&gt; cores [ 68: 71]</span>
</span></code></pre></div>
<p>The status <code>threads [0:3] -&gt; cores [  0:  3]</code> is shorthand &ldquo;there are 4 OpenMP threads, and the OS can schedule them on cores 0, 1, 2 and 3&rdquo;.</p>
<p>Allowing the OS to schedule threads is usually efficient, however to get the most you can try pinning threads to specific cores.
The <a href="https://www.openmp.org/spec-html/5.0/openmpse52.html"><code>OMP_PROC_BIND</code></a> environment variable can be used to tune how OpenMP sets thread affinity.
For example, <code>OMO_PROC_BIND=true</code> will give each thread exclusive affinity with a core:</p>
<div class="language-console highlight"><span class="filename">OMP_PROC_BIND=true</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">4</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_PROC_BIND</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="gp">$ </span>srun<span class="w"> </span>-n4<span class="w"> </span>-N1<span class="w"> </span>-c4<span class="w"> </span>--hint<span class="o">=</span>nomultithread<span class="w"> </span>./affinity.mpi<span class="w"> </span>--omp
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="go">affinity test for 4 MPI ranks</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="go">rank   0 @ nid001512</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="go">  thread 0 -&gt; core   0</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="go">  thread 1 -&gt; core   1</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="go">  thread 2 -&gt; core   2</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="go">  thread 3 -&gt; core   3</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="go">rank   1 @ nid001512</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="go">  thread 0 -&gt; core  64</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="go">  thread 1 -&gt; core  65</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="go">  thread 2 -&gt; core  66</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="go">  thread 3 -&gt; core  67</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="go">rank   2 @ nid001512</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="go">  thread 0 -&gt; core   4</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="go">  thread 1 -&gt; core   5</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="go">  thread 2 -&gt; core   6</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="go">  thread 3 -&gt; core   7</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="go">rank   3 @ nid001512</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="go">  thread 0 -&gt; core  68</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="go">  thread 1 -&gt; core  69</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="go">  thread 2 -&gt; core  70</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="go">  thread 3 -&gt; core  71</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are many OpenMP variables that can be used to fine tune affinity.
See the <a href="https://www.openmp.org/spec-html/5.0/openmpch6.html">OpenMP documentation</a> for more information.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>OMP_*</code> environment variables only affect thread affinity of applications that use OpenMP for thread-level parallelism.
Other threading runtimes will be configured differently, and the <code>affinity.mpi</code> tool will only be able to show the set of cores assigned to the rank.</p>
</div>
<p><a href="" id="ref-slurm-over-subscription"></a></p>
<h2 id="node-over-subscription">Node over-subscription<a class="headerlink" href="#node-over-subscription" title="Permanent link">&para;</a></h2>
<p>The nodes on Alps provide a lot of resources, particularly the GPU nodes that have 4 GPUs.
For workflows and use cases with tasks that require only a subset of these resources, for example a simulation that only needs one GPU, allocating a whole node to run one task is a waste of resources.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>A workflow that runs a single <a class="autorefs autorefs-internal" href="../../software/sciapps/gromacs/#gromacs">GROMACS</a> simulation, that uses one GPU.</p>
<ul>
<li>The optimal use of resources would allocate one quarter of a node, and allow other jobs to access the other three GPUs.</li>
</ul>
<p>A workflow that runs 100 independent <a class="autorefs autorefs-internal" href="../../software/sciapps/gromacs/#gromacs">GROMACS</a> simulations, where each simulation requires two GPUs.</p>
<ul>
<li>The optimal use of resources would allocate 50 nodes, with two simulations run on each node.</li>
</ul>
</div>
<p><a href="" id="ref-slurm-sharing"></a></p>
<h3 id="node-sharing">Node sharing<a class="headerlink" href="#node-sharing" title="Permanent link">&para;</a></h3>
<div class="admonition under-construction">
<p class="admonition-title">Under-construction</p>
<p>Node sharing, whereby jobs can request part of the resources on a node, and multiple jobs can run on a node (possibly from different users) is <em>not currently available on Alps clusters</em>.</p>
<p>CSCS will support this feature on some Alps <a class="autorefs autorefs-internal" title="Alps Clusters" href="../../clusters/#alps-clusters">clusters</a> in the near-medium future.</p>
</div>
<p><a href="" id="ref-slurm-exclusive"></a></p>
<h3 id="running-more-than-one-job-step-per-node">Running more than one job step per node<a class="headerlink" href="#running-more-than-one-job-step-per-node" title="Permanent link">&para;</a></h3>
<p>Running multiple job steps in parallel on the same allocated set of nodes can improve resource utilization by taking advantage of all the available CPUs, GPUs, or memory within a single job allocation.</p>
<p>The approach is to:</p>
<ol>
<li>first allocate all the resources on each node to the job;</li>
<li>then subdivide those resources at each invocation of srun.</li>
</ol>
<p>If Slurm believes that a request for resources (cores, GPUs, memory) overlaps with what another step has already allocated, it will defer the execution until the resources are relinquished.
This must be avoided.</p>
<p>First ensure that <em>all</em> resources are allocated to the whole job with the following preamble:</p>
<div class="language-bash highlight"><span class="filename">Slurm preamble on a GH200 node</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="ch">#!/usr/bin/env bash</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="c1">#SBATCH --exclusive --mem=450G</span>
</span></code></pre></div>
<ul>
<li><code>--exclusive</code> allocates all the CPUs and GPUs exclusively to this job;</li>
<li><code>--mem=450G</code> most of allowable memory (there are 4 Grace CPUs with ~120 GB of memory on the node)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>--mem=0</code> can generally be used to allocate all memory on the node but the Slurm configuration on clariden doesn&rsquo;t allow this.</p>
</div>
<p>Next, launch your applications using <code>srun</code>, carefully subdividing resources for each job step.
The <code>--exclusive</code> flag must be used again, but note that its meaning differs in the context of <code>srun</code>.
Here, <code>--exclusive</code> ensures that only the resources explicitly requested for a given job step are reserved and allocated to it.
Without this flag, Slurm reserves all resources for the job step, even if it only allocates a subset&mdash;effectively blocking further parallel <code>srun</code> invocations from accessing unrequested but needed resources.</p>
<p>Be sure to background each <code>srun</code> command with <code>&amp;</code>, so that subsequent job steps start immediately without waiting for previous ones to finish.
A final <code>wait</code> command ensures that your submission script does not exit until all job steps complete.</p>
<p>Slurm will automatically set <code>CUDA_VISIBLE_DEVICES</code> for each <code>srun</code> call, restricting GPU access to only the devices assigned to that job step.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">single node</label><label for="__tabbed_1_2">multi-node</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="admonition example">
<p class="admonition-title">Three jobs on one node</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="ch">#!/usr/bin/env bash</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c1">#SBATCH --exclusive --mem=450G</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="c1">#SBATCH -N1</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="nv">CMD</span><span class="o">=</span><span class="s2">&quot;echo \$(date) \$(hostname) JobStep:\${SLURM_STEP_ID} ProcID:\${SLURM_PROCID} CUDA_VISIBLE_DEVICES=\${CUDA_VISIBLE_DEVICES}; sleep 5&quot;</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>srun<span class="w"> </span>-N1<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--exclusive<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">2</span><span class="w"> </span>--cpus-per-gpu<span class="o">=</span><span class="m">5</span><span class="w"> </span>--mem<span class="o">=</span>50G<span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w">  </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMD</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>srun<span class="w"> </span>-N1<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--exclusive<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>--cpus-per-gpu<span class="o">=</span><span class="m">5</span><span class="w"> </span>--mem<span class="o">=</span>50G<span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w">  </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMD</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>srun<span class="w"> </span>-N1<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--exclusive<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>--cpus-per-gpu<span class="o">=</span><span class="m">5</span><span class="w"> </span>--mem<span class="o">=</span>50G<span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w">  </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMD</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="nb">wait</span>
</span></code></pre></div>
<p>Output (exact output will vary):
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>$ cat out-537506.*.log
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>Tue Jul 1 11:40:46 CEST 2025 nid007104 JobStep:0 ProcID:0 CUDA_VISIBLE_DEVICES=0
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>Tue Jul 1 11:40:46 CEST 2025 nid007104 JobStep:1 ProcID:0 CUDA_VISIBLE_DEVICES=1
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>Tue Jul 1 11:40:46 CEST 2025 nid007104 JobStep:2 ProcID:0 CUDA_VISIBLE_DEVICES=2,3
</span></code></pre></div></p>
</div>
</div>
<div class="tabbed-block">
<div class="admonition example">
<p class="admonition-title">Three jobs on two nodes</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="ch">#!/usr/bin/env bash</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="c1">#SBATCH --exclusive --mem=450G</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="c1">#SBATCH -N2</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="nv">CMD</span><span class="o">=</span><span class="s2">&quot;echo \$(date) \$(hostname) JobStep:\${SLURM_STEP_ID} ProcID:\${SLURM_PROCID} CUDA_VISIBLE_DEVICES=\${CUDA_VISIBLE_DEVICES}; sleep 5&quot;</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>srun<span class="w"> </span>-N2<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">2</span><span class="w"> </span>--exclusive<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>--cpus-per-gpu<span class="o">=</span><span class="m">5</span><span class="w"> </span>--mem<span class="o">=</span>50G<span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w">  </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMD</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>srun<span class="w"> </span>-N2<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--exclusive<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>--cpus-per-gpu<span class="o">=</span><span class="m">5</span><span class="w"> </span>--mem<span class="o">=</span>50G<span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w">  </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMD</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>srun<span class="w"> </span>-N2<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--exclusive<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>--cpus-per-gpu<span class="o">=</span><span class="m">5</span><span class="w"> </span>--mem<span class="o">=</span>50G<span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w">  </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMD</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="nb">wait</span>
</span></code></pre></div>
<p>Output (exact output will vary):
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>$ cat out-537539.*.log
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>Tue Jul 1 12:02:01 CEST 2025 nid005085 JobStep:0 ProcID:2 CUDA_VISIBLE_DEVICES=0
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>Tue Jul 1 12:02:01 CEST 2025 nid005085 JobStep:0 ProcID:3 CUDA_VISIBLE_DEVICES=1
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>Tue Jul 1 12:02:01 CEST 2025 nid005080 JobStep:0 ProcID:0 CUDA_VISIBLE_DEVICES=0
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>Tue Jul 1 12:02:01 CEST 2025 nid005080 JobStep:0 ProcID:1 CUDA_VISIBLE_DEVICES=1
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>Tue Jul 1 12:02:01 CEST 2025 nid005085 JobStep:1 ProcID:1 CUDA_VISIBLE_DEVICES=2
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>Tue Jul 1 12:02:01 CEST 2025 nid005080 JobStep:1 ProcID:0 CUDA_VISIBLE_DEVICES=2
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>Tue Jul 1 12:02:01 CEST 2025 nid005085 JobStep:2 ProcID:1 CUDA_VISIBLE_DEVICES=3
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>Tue Jul 1 12:02:01 CEST 2025 nid005080 JobStep:2 ProcID:0 CUDA_VISIBLE_DEVICES=3
</span></code></pre></div></p>
</div>
</div>
</div>
</div>
<h3 id="running-more-than-one-job-step-per-gpu">Running more than one job step per GPU<a class="headerlink" href="#running-more-than-one-job-step-per-gpu" title="Permanent link">&para;</a></h3>
<div class="admonition under-construction">
<p class="admonition-title">Under-construction</p>
<p>This section will be refined in the future, to multiple nodes and better handling of CPU affinity.
The current version assumes that the job steps have approximately the same runtime and resource requirements.</p>
</div>
<p>Given the strong capabilities of GH200 GPUs, some workflows may benefit from running more than one job step per GPU.
For example, a workflow that runs many small simulations that do not fully utilize a GPU individually
may benefit from running multiple simulations on the same GPU simultaneously.
While some GPU resources will be shared, causing some performance degradation, the overall throughput of the workflow may increase.</p>
<p>In order to run more than one job per GPU, it is important to enable MPS (Multi-Process Service) on the GPUs.
If multiple GPUs on one node are used, an MPS daemon must be started for each GPU.
Using a single MPS daemon for multiple GPUs can become the bottleneck.</p>
<p>The following script shows how to run four independent job steps on two GPUs:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1">#SBATCH --job-name=multi-jobstep-per-gpu</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1">#SBATCH --time=00:01:00</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="c1">#SBATCH --nodes=1</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="nv">CMD</span><span class="o">=</span><span class="s2">&quot;echo \$(date) \$(hostname) SLURM_STEP_ID:\${SLURM_STEP_ID} SLURM_PROCID:\${SLURM_PROCID} CUDA_MPS_PIPE_DIRECTORY=\${CUDA_MPS_PIPE_DIRECTORY} CUDA_MPS_LOG_DIRECTORY=\${CUDA_MPS_LOG_DIRECTORY} CUDA_VISIBLE_DEVICES=\${CUDA_VISIBLE_DEVICES} CPU_MASK=\$(hwloc-bind --get --taskset) ; sleep 10&quot;</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_DEVICE_MAX_COPY_CONNECTIONS</span><span class="o">=</span><span class="m">8</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_DEVICE_MAX_CONNECTIONS</span><span class="o">=</span><span class="m">8</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-mps-0<span class="w"> </span><span class="nv">CUDA_MPS_LOG_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-log-0<span class="w"> </span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>hwloc-bind<span class="w"> </span>--cpubind<span class="w"> </span>core:0-71<span class="w"> </span>nvidia-cuda-mps-control<span class="w"> </span>-d
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-mps-1<span class="w"> </span><span class="nv">CUDA_MPS_LOG_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-log-1<span class="w"> </span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>hwloc-bind<span class="w"> </span>--cpubind<span class="w"> </span>core:72-143<span class="w"> </span>nvidia-cuda-mps-control<span class="w"> </span>-d
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="c1"># Wait for MPS daemons to be ready</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="k">until</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;/tmp/nvidia-mps-0/nvidia-cuda-mps-control.pid&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;/tmp/nvidia-mps-1/nvidia-cuda-mps-control.pid&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">1</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="k">done</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>srun<span class="w"> </span>-u<span class="w"> </span>--overlap<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w"> </span>./gpubind0.sh<span class="w"> </span>hwloc-bind<span class="w"> </span>--cpubind<span class="w"> </span>core:0-35<span class="w"> </span>--<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CMD</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="nv">j01</span><span class="o">=</span><span class="nv">$!</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>srun<span class="w"> </span>-u<span class="w"> </span>--overlap<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w"> </span>./gpubind0.sh<span class="w"> </span>hwloc-bind<span class="w"> </span>--cpubind<span class="w"> </span>core:36-71<span class="w"> </span>--<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CMD</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="nv">j02</span><span class="o">=</span><span class="nv">$!</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>srun<span class="w"> </span>-u<span class="w"> </span>--overlap<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w"> </span>./gpubind1.sh<span class="w"> </span>hwloc-bind<span class="w"> </span>--cpubind<span class="w"> </span>core:72-107<span class="w"> </span>--<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CMD</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="nv">j11</span><span class="o">=</span><span class="nv">$!</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>srun<span class="w"> </span>-u<span class="w"> </span>--overlap<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;out-%J.log&quot;</span><span class="w"> </span>./gpubind1.sh<span class="w"> </span>hwloc-bind<span class="w"> </span>--cpubind<span class="w"> </span>core:108-143<span class="w"> </span>--<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CMD</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="nv">j12</span><span class="o">=</span><span class="nv">$!</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="nb">wait</span><span class="w"> </span><span class="nv">$j01</span><span class="w"> </span><span class="nv">$j02</span><span class="w"> </span><span class="nv">$j11</span><span class="w"> </span><span class="nv">$j12</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="nb">echo</span><span class="w"> </span>quit<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-mps-0<span class="w"> </span><span class="nv">CUDA_MPS_LOG_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-log-0<span class="w"> </span>nvidia-cuda-mps-control
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="nb">echo</span><span class="w"> </span>quit<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-mps-1<span class="w"> </span><span class="nv">CUDA_MPS_LOG_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-log-1<span class="w"> </span>nvidia-cuda-mps-control
</span></code></pre></div>
<p>The <code>gpubind*.sh</code> scripts set the appropriate MPS environment variables. For example, <code>gpubind0.sh</code>:</p>
<div class="language-bash highlight"><span class="filename">gpubind0.sh</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_MPS_PIPE_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-mps-0
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_MPS_LOG_DIRECTORY</span><span class="o">=</span>/tmp/nvidia-log-0
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy", "content.action.edit", "navigation.indexes", "search.share", "navigation.instant", "navigation.tracking", "navigation.path", "navigation.top", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>