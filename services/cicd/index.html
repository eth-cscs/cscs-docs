
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.cscs.ch/services/cicd/">
      
      
        <link rel="prev" href="../devportal/">
      
      
        <link rel="next" href="../kubernetes/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>CI/CD - CSCS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#continuous-integration-continuous-deployment-cicd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CSCS Documentation" class="md-header__button md-logo" aria-label="CSCS Documentation" data-md-component="logo">
      
  <img src="../../assets/cscs-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CSCS Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CI/CD
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/eth-cscs/cscs-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CSCS Documentation" class="md-nav__button md-logo" aria-label="CSCS Documentation" data-md-component="logo">
      
  <img src="../../assets/cscs-logo.png" alt="logo">

    </a>
    CSCS Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eth-cscs/cscs-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../alps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Alps
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Alps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/platforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Platforms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../clusters/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Clusters
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Clusters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/besso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Besso
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/bristen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bristen
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/clariden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clariden
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/daint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Daint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/eiger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eiger
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/santis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Santis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/mlp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Machine Learning Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Machine Learning Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/clariden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clariden
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/bristen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bristen
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/hpcp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    HPC Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            HPC Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/daint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Daint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/eiger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eiger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/cwp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Climate and Weather Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Climate and Weather Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/santis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Santis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../access/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Connecting to Alps
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Connecting to Alps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/mfa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi Factor Authentication (MFA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/web/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/ssh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/firecrest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FirecREST
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/hpc-console/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HPC Console
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/jupyterlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JupyterLab
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/vscode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../running/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Running Jobs
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Running Jobs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running/slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slurm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running/hyperqueue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HyperQueue
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running/known-issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known issues
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../environments/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Environments
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Environments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/terminal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started in the terminal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/uenv/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    uenv
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            uenv
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/configure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/container-engine/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Container Engine
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Container Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/container-engine/run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the Container Engine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/container-engine/resource-hook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hooks and native resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/container-engine/edf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EDF reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/container-engine/known-issue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known issues
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../build-install/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Building and Installing Software
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Building and Installing Software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/prgenv/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Programming Environments
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Programming Environments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/prgenv-gnu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prgenv-gnu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/prgenv-nvfortran/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prgenv-nvfortran
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/linalg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linalg
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/julia/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    julia
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/prgenv/cpe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cray modules (CPE)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How to build software
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            How to build software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uenv
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Packaging and Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Packaging and Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/uenv/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating Containers with podman
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Applications and Frameworks
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Applications and Frameworks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/sciapps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Scientific Applications
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Scientific Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/cp2k/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CP2K
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/gromacs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GROMACS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/lammps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LAMMPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/namd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NAMD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/quantumespresso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantum ESPRESSO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciapps/vasp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VASP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/ml/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Machine Learning
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Machine Learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/ml/pytorch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyTorch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/ml/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3_3" id="__nav_7_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ml/llm-inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Inference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ml/llm-fine-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Fine-tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ml/llm-nanotron-training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Pre-training
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/cw/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Climate and Weather
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Climate and Weather
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/cw/wrf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WRF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/cw/netcdf-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    netcdf-tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/communication/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Communication Libraries
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Communication Libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/cray-mpich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cray MPICH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/mpich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MPICH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/openmpi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenMPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/nccl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NCCL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/rccl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RCCL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/communication/libfabric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    libfabric
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/commercial/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Commercial software
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            Commercial software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/commercial/matlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Matlab
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/sciviz/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Scientific Visualization
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            Scientific Visualization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/sciviz/paraview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ParaView
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/unsupported/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prohibited Software
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../software/devtools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Debugging and Performance Analysis
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Debugging and Performance Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/nvidia-nsight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using NVIDIA Nsight
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Using Linaro Forge
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Using Linaro Forge
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/linaro-uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linaro uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/linaro-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linaro performance analysis tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/linaro-ddt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linaro debugger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software/devtools/vihps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Score-P/Scalasca
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running/jobreport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job report
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../storage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Data Management and Storage
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Data Management and Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/filesystems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Systems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/transfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Transfer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/longterm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Long Term Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/object/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Object Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devportal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Portal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-containerized-cicd" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction containerized CI/CD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction containerized CI/CD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorial-hello-world" class="md-nav__link">
    <span class="md-ellipsis">
      Tutorial Hello World
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ci-at-cscs" class="md-nav__link">
    <span class="md-ellipsis">
      CI at CSCS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CI at CSCS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-ci-for-your-project" class="md-nav__link">
    <span class="md-ellipsis">
      Enable CI for your project
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enable CI for your project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clarifications-and-pitfalls-to-the-above-mentioned-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Clarifications and pitfalls to the above-mentioned steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-when-ci-is-triggered" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding when CI is triggered
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding when CI is triggered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#push-events" class="md-nav__link">
    <span class="md-ellipsis">
      Push events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-requests-merge-requests" class="md-nav__link">
    <span class="md-ellipsis">
      Pull requests (Merge requests)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs-ci-run-comment" class="md-nav__link">
    <span class="md-ellipsis">
      cscs-ci run comment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-call-triggering" class="md-nav__link">
    <span class="md-ellipsis">
      API call triggering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-underlying-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the underlying workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding the underlying workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-exemplified-on-a-github-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (exemplified on a GitHub repository)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containerized-ci-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Containerized CI - best practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Containerized CI - best practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-architecture-images" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-architecture images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-management" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependency management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem" class="md-nav__link">
    <span class="md-ellipsis">
      Problem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    <span class="md-ellipsis">
      Solution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-dependency-update" class="md-nav__link">
    <span class="md-ellipsis">
      Manual dependency update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-dependency-update" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic dependency update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      Image cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party-registries" class="md-nav__link">
    <span class="md-ellipsis">
      Third party registries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Third party registries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clone-image-from-cscs-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Clone image from CSCS registry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spack-based-images" class="md-nav__link">
    <span class="md-ellipsis">
      Spack based images
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spack based images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-helper-script" class="md-nav__link">
    <span class="md-ellipsis">
      Install helper script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Building Docker images
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building Docker images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-images-naming-scheme" class="md-nav__link">
    <span class="md-ellipsis">
      Docker images naming scheme
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Docker registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Example Dockerfile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-container-build" class="md-nav__link">
    <span class="md-ellipsis">
      Manual container build
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cscs-ci-specifics" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS CI specifics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CSCS CI specifics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#restart-ci-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Restart CI jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Common pitfalls
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ci-variables" class="md-nav__link">
    <span class="md-ellipsis">
      CI variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CI variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cscs_registry" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_REGISTRY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_registry_path" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_REGISTRY_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_ci_mw_url" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CI_MW_URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_ci_default_slurm_account" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CI_DEFAULT_SLURM_ACCOUNT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_ci_orig_clone_url" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CI_ORIG_CLONE_URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arch" class="md-nav__link">
    <span class="md-ellipsis">
      ARCH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runners-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Runners reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runners reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container-builder" class="md-nav__link">
    <span class="md-ellipsis">
      container-builder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="container-builder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      DOCKERFILE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persist_image_name" class="md-nav__link">
    <span class="md-ellipsis">
      PERSIST_IMAGE_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_build_in_memory" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_BUILD_IN_MEMORY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker_build_args" class="md-nav__link">
    <span class="md-ellipsis">
      DOCKER_BUILD_ARGS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_rebuild_policy" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_REBUILD_POLICY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary_registry" class="md-nav__link">
    <span class="md-ellipsis">
      SECONDARY_REGISTRY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary_registry_username" class="md-nav__link">
    <span class="md-ellipsis">
      SECONDARY_REGISTRY_USERNAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary_registry_password" class="md-nav__link">
    <span class="md-ellipsis">
      SECONDARY_REGISTRY_PASSWORD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom_registry_username" class="md-nav__link">
    <span class="md-ellipsis">
      CUSTOM_REGISTRY_USERNAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom_registry_password" class="md-nav__link">
    <span class="md-ellipsis">
      CUSTOM_REGISTRY_PASSWORD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Build arguments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build arguments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cscs_registry_path_1" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_REGISTRY_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num_procs" class="md-nav__link">
    <span class="md-ellipsis">
      NUM_PROCS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-context" class="md-nav__link">
    <span class="md-ellipsis">
      Build context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-runner" class="md-nav__link">
    <span class="md-ellipsis">
      container-runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="container-runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_1" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      GIT_STRATEGY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_cuda_mps" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CUDA_MPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use_mpi" class="md-nav__link">
    <span class="md-ellipsis">
      USE_MPI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use_nccl" class="md-nav__link">
    <span class="md-ellipsis">
      USE_NCCL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edf_append" class="md-nav__link">
    <span class="md-ellipsis">
      EDF_APPEND
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_additional_mounts" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_ADDITIONAL_MOUNTS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-runner-lightweight" class="md-nav__link">
    <span class="md-ellipsis">
      container-runner-lightweight
    </span>
  </a>
  
    <nav class="md-nav" aria-label="container-runner-lightweight">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_2" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes_cpu_request" class="md-nav__link">
    <span class="md-ellipsis">
      KUBERNETES_CPU_REQUEST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes_cpu_limit" class="md-nav__link">
    <span class="md-ellipsis">
      KUBERNETES_CPU_LIMIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes_memory_request" class="md-nav__link">
    <span class="md-ellipsis">
      KUBERNETES_MEMORY_REQUEST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes_memory_limit" class="md-nav__link">
    <span class="md-ellipsis">
      KUBERNETES_MEMORY_LIMIT
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv-builder" class="md-nav__link">
    <span class="md-ellipsis">
      uenv-builder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="uenv-builder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_3" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uenv_name" class="md-nav__link">
    <span class="md-ellipsis">
      UENV_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv_version" class="md-nav__link">
    <span class="md-ellipsis">
      UENV_VERSION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv_recipe" class="md-nav__link">
    <span class="md-ellipsis">
      UENV_RECIPE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv_tag" class="md-nav__link">
    <span class="md-ellipsis">
      UENV_TAG
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs_3" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv-runner" class="md-nav__link">
    <span class="md-ellipsis">
      uenv-runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="uenv-runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_4" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with_uenv_view" class="md-nav__link">
    <span class="md-ellipsis">
      WITH_UENV_VIEW
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_cuda_mps_1" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CUDA_MPS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs_4" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#baremetal-runner" class="md-nav__link">
    <span class="md-ellipsis">
      baremetal-runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="baremetal-runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-job" class="md-nav__link">
    <span class="md-ellipsis">
      Example job
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f7t-controller" class="md-nav__link">
    <span class="md-ellipsis">
      f7t-controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="f7t-controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-job_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example job
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reframe-runner" class="md-nav__link">
    <span class="md-ellipsis">
      reframe-runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="reframe-runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_5" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rfm_version" class="md-nav__link">
    <span class="md-ellipsis">
      RFM_VERSION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfm_config" class="md-nav__link">
    <span class="md-ellipsis">
      RFM_CONFIG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfm_checkpath" class="md-nav__link">
    <span class="md-ellipsis">
      RFM_CHECKPATH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-job_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example job
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firecrest" class="md-nav__link">
    <span class="md-ellipsis">
      FirecREST
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-projects" class="md-nav__link">
    <span class="md-ellipsis">
      Example projects
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../kubernetes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/clusters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clusters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/kubernetes-upgrades/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes Upgrades
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/node-updates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node OS Updates
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../accounts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Accounts and Projects
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Accounts and Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accounts/ump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Account and Resources Management Tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accounts/waldur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project and Resources Management Tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accounts/account-create/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating a new account
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/internet-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internet Access on Alps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../policies/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Policies
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13" id="__nav_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Policies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/regulations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Regulations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/code-of-conduct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Support Policies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/slack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slack Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/maintenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scheduled Maintenance and System Unavailability Policies
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../contributing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-containerized-cicd" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction containerized CI/CD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction containerized CI/CD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorial-hello-world" class="md-nav__link">
    <span class="md-ellipsis">
      Tutorial Hello World
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ci-at-cscs" class="md-nav__link">
    <span class="md-ellipsis">
      CI at CSCS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CI at CSCS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-ci-for-your-project" class="md-nav__link">
    <span class="md-ellipsis">
      Enable CI for your project
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enable CI for your project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clarifications-and-pitfalls-to-the-above-mentioned-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Clarifications and pitfalls to the above-mentioned steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-when-ci-is-triggered" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding when CI is triggered
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding when CI is triggered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#push-events" class="md-nav__link">
    <span class="md-ellipsis">
      Push events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-requests-merge-requests" class="md-nav__link">
    <span class="md-ellipsis">
      Pull requests (Merge requests)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs-ci-run-comment" class="md-nav__link">
    <span class="md-ellipsis">
      cscs-ci run comment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-call-triggering" class="md-nav__link">
    <span class="md-ellipsis">
      API call triggering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-underlying-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the underlying workflow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding the underlying workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-exemplified-on-a-github-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (exemplified on a GitHub repository)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containerized-ci-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Containerized CI - best practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Containerized CI - best practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-architecture-images" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-architecture images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-management" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependency management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem" class="md-nav__link">
    <span class="md-ellipsis">
      Problem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    <span class="md-ellipsis">
      Solution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-dependency-update" class="md-nav__link">
    <span class="md-ellipsis">
      Manual dependency update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-dependency-update" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic dependency update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      Image cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party-registries" class="md-nav__link">
    <span class="md-ellipsis">
      Third party registries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Third party registries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clone-image-from-cscs-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Clone image from CSCS registry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spack-based-images" class="md-nav__link">
    <span class="md-ellipsis">
      Spack based images
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spack based images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-helper-script" class="md-nav__link">
    <span class="md-ellipsis">
      Install helper script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Building Docker images
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building Docker images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-images-naming-scheme" class="md-nav__link">
    <span class="md-ellipsis">
      Docker images naming scheme
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Docker registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Example Dockerfile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-container-build" class="md-nav__link">
    <span class="md-ellipsis">
      Manual container build
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cscs-ci-specifics" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS CI specifics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CSCS CI specifics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#restart-ci-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Restart CI jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Common pitfalls
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ci-variables" class="md-nav__link">
    <span class="md-ellipsis">
      CI variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CI variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cscs_registry" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_REGISTRY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_registry_path" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_REGISTRY_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_ci_mw_url" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CI_MW_URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_ci_default_slurm_account" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CI_DEFAULT_SLURM_ACCOUNT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_ci_orig_clone_url" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CI_ORIG_CLONE_URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arch" class="md-nav__link">
    <span class="md-ellipsis">
      ARCH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runners-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Runners reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runners reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container-builder" class="md-nav__link">
    <span class="md-ellipsis">
      container-builder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="container-builder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      DOCKERFILE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persist_image_name" class="md-nav__link">
    <span class="md-ellipsis">
      PERSIST_IMAGE_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_build_in_memory" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_BUILD_IN_MEMORY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker_build_args" class="md-nav__link">
    <span class="md-ellipsis">
      DOCKER_BUILD_ARGS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_rebuild_policy" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_REBUILD_POLICY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary_registry" class="md-nav__link">
    <span class="md-ellipsis">
      SECONDARY_REGISTRY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary_registry_username" class="md-nav__link">
    <span class="md-ellipsis">
      SECONDARY_REGISTRY_USERNAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary_registry_password" class="md-nav__link">
    <span class="md-ellipsis">
      SECONDARY_REGISTRY_PASSWORD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom_registry_username" class="md-nav__link">
    <span class="md-ellipsis">
      CUSTOM_REGISTRY_USERNAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom_registry_password" class="md-nav__link">
    <span class="md-ellipsis">
      CUSTOM_REGISTRY_PASSWORD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Build arguments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build arguments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cscs_registry_path_1" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_REGISTRY_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num_procs" class="md-nav__link">
    <span class="md-ellipsis">
      NUM_PROCS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-context" class="md-nav__link">
    <span class="md-ellipsis">
      Build context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-runner" class="md-nav__link">
    <span class="md-ellipsis">
      container-runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="container-runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_1" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      GIT_STRATEGY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_cuda_mps" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CUDA_MPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use_mpi" class="md-nav__link">
    <span class="md-ellipsis">
      USE_MPI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use_nccl" class="md-nav__link">
    <span class="md-ellipsis">
      USE_NCCL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edf_append" class="md-nav__link">
    <span class="md-ellipsis">
      EDF_APPEND
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_additional_mounts" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_ADDITIONAL_MOUNTS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-runner-lightweight" class="md-nav__link">
    <span class="md-ellipsis">
      container-runner-lightweight
    </span>
  </a>
  
    <nav class="md-nav" aria-label="container-runner-lightweight">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_2" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes_cpu_request" class="md-nav__link">
    <span class="md-ellipsis">
      KUBERNETES_CPU_REQUEST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes_cpu_limit" class="md-nav__link">
    <span class="md-ellipsis">
      KUBERNETES_CPU_LIMIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes_memory_request" class="md-nav__link">
    <span class="md-ellipsis">
      KUBERNETES_MEMORY_REQUEST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes_memory_limit" class="md-nav__link">
    <span class="md-ellipsis">
      KUBERNETES_MEMORY_LIMIT
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv-builder" class="md-nav__link">
    <span class="md-ellipsis">
      uenv-builder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="uenv-builder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_3" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uenv_name" class="md-nav__link">
    <span class="md-ellipsis">
      UENV_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv_version" class="md-nav__link">
    <span class="md-ellipsis">
      UENV_VERSION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv_recipe" class="md-nav__link">
    <span class="md-ellipsis">
      UENV_RECIPE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv_tag" class="md-nav__link">
    <span class="md-ellipsis">
      UENV_TAG
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs_3" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uenv-runner" class="md-nav__link">
    <span class="md-ellipsis">
      uenv-runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="uenv-runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_4" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with_uenv_view" class="md-nav__link">
    <span class="md-ellipsis">
      WITH_UENV_VIEW
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cscs_cuda_mps_1" class="md-nav__link">
    <span class="md-ellipsis">
      CSCS_CUDA_MPS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-jobs_4" class="md-nav__link">
    <span class="md-ellipsis">
      Example jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#baremetal-runner" class="md-nav__link">
    <span class="md-ellipsis">
      baremetal-runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="baremetal-runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-job" class="md-nav__link">
    <span class="md-ellipsis">
      Example job
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f7t-controller" class="md-nav__link">
    <span class="md-ellipsis">
      f7t-controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="f7t-controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-job_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example job
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reframe-runner" class="md-nav__link">
    <span class="md-ellipsis">
      reframe-runner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="reframe-runner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables_5" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rfm_version" class="md-nav__link">
    <span class="md-ellipsis">
      RFM_VERSION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfm_config" class="md-nav__link">
    <span class="md-ellipsis">
      RFM_CONFIG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfm_checkpath" class="md-nav__link">
    <span class="md-ellipsis">
      RFM_CHECKPATH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-job_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example job
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firecrest" class="md-nav__link">
    <span class="md-ellipsis">
      FirecREST
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-projects" class="md-nav__link">
    <span class="md-ellipsis">
      Example projects
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/eth-cscs/cscs-docs/edit/main/docs/services/cicd.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  


<p><a href="" id="ref-cicd"></a></p>
<h1 id="continuous-integration-continuous-deployment-cicd">Continuous Integration / Continuous Deployment (CI/CD)<a class="headerlink" href="#continuous-integration-continuous-deployment-cicd" title="Permanent link">&para;</a></h1>
<div class="admonition info">
<p class="admonition-title">External references</p>
<p>It is helpful to consult the <a href="https://docs.gitlab.com/ee/ci/yaml/">GitLab CI yaml</a> reference documentation and the <a href="https://docs.gitlab.com/ee/ci/variables/predefined_variables.html">predefined pipeline variables reference</a>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Webinar video</p>
<p>Watch the latest <a href="https://www.youtube.com/watch?v=6cnm32nFw0A">webinar video</a> for an overview of CI/CD and its features</p>
</div>
<p><a href="" id="ref-cicd-containerized-intro"></a></p>
<h2 id="introduction-containerized-cicd">Introduction containerized CI/CD<a class="headerlink" href="#introduction-containerized-cicd" title="Permanent link">&para;</a></h2>
<p>Containerized CI/CD allows you to build containers and run them at scale on CSCS systems.
The basic idea is that you provide a <a href="https://docs.docker.com/reference/dockerfile/">Dockerfile</a> with build instructions and run the newly created container.
Most of the boilerplate work is being taken care by the CI implementation such that you can concentrate on providing build instructions and testing.
The important information is provided to you from the CI side for the configuration of your repository.</p>
<p>We support any git provider that supports <a href="https://en.wikipedia.org/wiki/Webhook">webhooks</a>.
This includes GitHub, GitLab and Bitbucket.
A typical pipeline consists of at least one build job and one test job.
The build job makes sure that a new container with your most recent code changes is built.
The test step uses the new container as part of an MPI job; e.g., it can run your tests on multiple nodes with GPU support.</p>
<p>Building your software inside a container requires a Dockerfile and a name for the container in the registry where the container will be stored.
Testing your software then requires the commands that must be executed to run the tests.
No explicit container spawning is required (and also not possible).
Your test jobs need to specify the number of nodes and tasks required for the test and the test commands.</p>
<p><a href="" id="ref-cicd-containerized-tutorial"></a></p>
<h3 id="tutorial-hello-world">Tutorial Hello World<a class="headerlink" href="#tutorial-hello-world" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Hello World</p>
<p>See the <a href="https://github.com/finkandreas/containerised_ci_helloworld">hello world example</a> on GitHub for a project that demonstrates a containerized end to end CI/CD workflow.</p>
</div>
<p>In this example we are using the <a href="https://github.com/finkandreas/containerised_ci_helloworld">containerized hello world repository</a>.
This is a sample Hello World CMake project.
The application only echos <code>Hello from $HOSTNAME</code>, but this should demonstrate the idea of how to run a program on multiple nodes.
The pipeline instructions are inside the file <code>ci/cscs.yml</code>.
Let&rsquo;s walk through the pipeline bit by bit.
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">remote</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://gitlab.com/cscs-ci/recipes/-/raw/master/templates/v2/.ci-ext.yml&#39;</span>
</span></code></pre></div></p>
<p>This block includes a yaml file which contains definitions with default values to build and run containers.
Have a look inside this file to see available building blocks.
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span></code></pre></div>
Here we define two different stages, named <code>build</code> and <code>test</code>.
The names can be chosen freely.
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/helloworld:$CI_COMMIT_SHORT_SHA</span>
</span></code></pre></div></p>
<p>This block defines variables that will apply to all jobs.
See <a href="https://confluence.cscs.ch/spaces/KB/pages/868812112/Continuous+Integration+Continuous+Deployment#ContinuousIntegration/ContinuousDeployment-CIvariables">CI variables</a>.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">build_job</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile.build</span>
</span></code></pre></div>
<p>This adds a job named <code>build_job</code> to the stage <code>build</code>.
This runner expects a Dockerfile as input, which is specified in the variable <code>DOCKERFILE</code>.
The resulting container name is specified with the variable <code>PERSIST_IMAGE_NAME</code>, which has been defined already above, therefore it does not need to be explicitly mentioned in the <code>variables</code> block, again.
Further refinements can be found at the <a href="#container-builder">reference documentation</a></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nt">test_job</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-runner-eiger-zen2</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$PERSIST_IMAGE_NAME</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/helloworld/bin/hello</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="nt">SLURM_JOB_NUM_NODES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="nt">SLURM_NTASKS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span></code></pre></div>
<p>This block defines a test job.
The job will be executed by the <a href="#container-runner">.container-runner-eiger-zen2</a>.</p>
<p>This runner will pull the image on the cluster Eiger and run the commands as specified in the <code>script</code> tag.
In this example we are requesting 2 nodes with 1 task on each node, i.e. 2 tasks total.
All <a href="https://slurm.schedmd.com/srun.html#SECTION_INPUT-ENVIRONMENT-VARIABLES">Slurm environment variables</a> are supported.
The commands will be running inside the container specified by the <code>image</code> tag.</p>
<p><a href="" id="ref-cicd-cscs-impl"></a></p>
<h2 id="ci-at-cscs">CI at CSCS<a class="headerlink" href="#ci-at-cscs" title="Permanent link">&para;</a></h2>
<h3 id="enable-ci-for-your-project">Enable CI for your project<a class="headerlink" href="#enable-ci-for-your-project" title="Permanent link">&para;</a></h3>
<p>While the procedure to enable CSCS CI for your repository consists of only a few steps outlined below, many of them require features in GitHub, GitLab or Bitbucket.
The links in the text contain additional steps which may be needed.
Some of those documents are non-trivial, especially if you do not have considerable background in the repository features.
Plan sufficient time for the setup and contact a GitHub/GitLab/Bitbucket professional, if needed.</p>
<ol>
<li><strong>Register your project with CSCS</strong>: The first step to use containerized CI/CD is to register your Git repository with CSCS.
Please open a <a href="https://support.cscs.ch/">Service Desk ticket</a> and include which repository should be registered, and who should own the registration (by default it would be the requester).
Once your project has been registered you will be provided with a webhook-secret.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CSCS staff members can directly register their project by clicking on <a href="https://cicd-ext-mw.cscs.ch/ci/register">register new
project</a> at the bottom right of the <a href="https://cicd-ext-mw.cscs.ch/ci/overview">CI overview
page</a>.</p>
</div>
<ol>
<li>
<p><strong>Set up CI</strong>: Head to the <a href="https://cicd-ext-mw.cscs.ch/ci/overview">CI overview page</a>, login with your CSCS credentials, and go to the newly registered project.</p>
</li>
<li>
<p><strong>Add FirecREST tokens</strong>: Expand the <code>Admin config</code>, and follow the guide (click on the small black triangle next to Firecrest Consumer Key).
Enter all fields for FirecREST, i.e.,</p>
<ul>
<li>Consumer Key</li>
<li>Consumer Secret</li>
<li>default Slurm account for job submission (what you normally provide in the <code>--account</code>/<code>-A</code> flag to Slurm)</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">FirecREST credentials</p>
<p>If you don&rsquo;t already know how to obtain FirecREST credentials, you can find more information on <a class="autorefs autorefs-internal" href="../devportal/#developer-portal">CSCS Developer Portal</a>.
You must subscribe your application to the FirecREST API of the platform to which you want to submit jobs, e.g.
<code>FirecREST-HPC</code> for the HPC platform.
If <code>v2</code> is available for your platform, then subscribe to <code>v2</code> of the API, otherwise <code>v1</code> will work too.
It is not mandatory to subscribe to the <code>ciext-container-builder</code> API to use pure CI workflows (this API is only used for building manually container images).</p>
</div>
</li>
<li>
<p><strong>(Optional) Private project</strong>: If your Git repository is a private repository make sure to check the <code>Private repository</code> box and follow the instructions to add an SSH key to your Git repository.</p>
</li>
<li>
<p><strong>Add notification token</strong>: On the setup page you will also find the field <code>Notification token</code>.
The token is live tested, and you will see a green checkmark when the token is valid and can be used by the CI.
It is mandatory to add a token so that your Git repository will be notified about the status of the build jobs.
You cannot save anything as long as the notification token is invalid.
(Click on the small triangle to get further instructions)</p>
</li>
<li>
<p><strong>Add webhook</strong>: On the CI setup page you will find the <code>Setup webhook details</code> button (go to the <a href="https://cicd-ext-mw.cscs.ch">CI overview</a>, then the project, and there is a blue button with the text <code>Setup webhook details</code>).
If you click on it you will see all the entries which have to be added to a new webhook in your Git repository.
Follow the link given there to your repository, and add the webhook with the given entries.</p>
</li>
<li>
<p><strong>Default trusted users and default CI-enabled branches</strong>: Provide the default list of trusted users and CI-enabled branches.
The global configuration will apply to all pipelines that do not overwrite it explicitly.</p>
</li>
<li>
<p><strong>Pipeline default</strong>: Your first pipeline has the name <code>default</code>.
Click on <code>Pipeline default</code> to see the pipeline setup details.
The name can be chosen freely but it cannot contain whitespace (a short descriptive name).
Update the entry point, trusted users and CI-enabled branches.</p>
</li>
<li>
<p><strong>Submit your changes</strong></p>
</li>
<li>
<p><strong>(Optional) Add other pipelines</strong>: Add other pipelines with a different entry point if you need more pipelines.</p>
</li>
<li>
<p><strong>Add entry point yaml files to Git repository</strong>: Commit the yaml entry point files to your repository.
You should get notifications about the build status in your repository if everything is correct.
See the <a href="#ref-cicd-containerized-tutorial">Hello World Tutorial</a> for a simple yaml-file.</p>
</li>
</ol>
<h4 id="clarifications-and-pitfalls-to-the-above-mentioned-steps">Clarifications and pitfalls to the above-mentioned steps<a class="headerlink" href="#clarifications-and-pitfalls-to-the-above-mentioned-steps" title="Permanent link">&para;</a></h4>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This section exemplifies on GitHub, but similar settings are available on GitLab and Bitbucket</p>
</div>
<p>The <code>notification token</code> setup step is crucial, because this is the number one entrypoint for receiving initial feedback on any errors.
You will not be able to save any changes on the CI setup page, as long as the notification token is invalid.
The token is checked live, whether it can be used to do notifications.</p>
<p>Notification tokens on GitHub can be setup using <code>Classic token</code> or <code>Fine-grained token</code>.
We discourage the use of fine-grained tokens.
Fine-grained tokens are unsupported, and come with many pitfalls.
They can work, but must be enabled at the organization level by an admin, and must be created in the correct organization.
You must choose the correct resource owner, i.e., the organization that the project belongs to.
If the organization is not listed, then it has disabled fine-grained tokens at the organization level.
It can only be enabled globally on an organization by an admin.
As for the repository you can restrict it to only the repository that you want to notify with this token or all repositories.
Even if you choose &ldquo;All repositories&rdquo;, it is still restricted to the organization, and does not grant the access to any repository outside of the resource owner.</p>
<p>Another crucial setup step is the correct webhook setup.
The repository provider (GitHub, GitLab, Bitbucket) gives you the ability to see what happened, when the webhook event was sent.
If the webhook was not setup correctly, you will receive an HTTP error for the webhook events.
The error message can be found in the webhook event response.
As an example, here is how you would find it on GitHub: <strong>Settings &gt; Webhooks &gt; <code>Edit</code> button of the webhook &gt; <code>Recent Deliveries</code> tab &gt; Choose a webhook event from the list &gt; <code>Response</code> tab &gt; Check for potential error message</strong>.</p>
<p>A typical error is accepting to defaults of GitHub for new webhooks, where only <code>Push</code> events are being sent.
When you forget to select <code>Send me everything</code>, then some events will not trigger pipelines.
Double check your webhook settings.</p>
<p><a href="" id="ref-cicd-pipeline-triggers"></a></p>
<h2 id="understanding-when-ci-is-triggered">Understanding when CI is triggered<a class="headerlink" href="#understanding-when-ci-is-triggered" title="Permanent link">&para;</a></h2>
<p><a href="" id="ref-cicd-pipeline-triggers-push"></a></p>
<h4 id="push-events">Push events<a class="headerlink" href="#push-events" title="Permanent link">&para;</a></h4>
<ul>
<li>Every pipeline can define its own list of CI-enabled branches</li>
<li>If a pipeline does not define a list of CI-enabled branches, the global list will be used</li>
<li>If you push changes to a branch every pipeline that has this branch in its list of CI-enabled branches will be triggered</li>
<li>If the global list and all pipelines have an empty list of CI-enabled branches, then CI will never be triggered on push events</li>
</ul>
<p><a href="" id="ref-cicd-pipeline-triggers-pr"></a></p>
<h4 id="pull-requests-merge-requests">Pull requests (Merge requests)<a class="headerlink" href="#pull-requests-merge-requests" title="Permanent link">&para;</a></h4>
<ul>
<li>For simplicity we use PR to mean Pull Request, although some providers call it a Merge request.
It is the same thing.</li>
<li>Every pipeline can define its own list of trusted users.</li>
<li>If a pipeline does not define a list of trusted users, the global list will be used.</li>
<li>If a PR is opened/edited and targets a CI-enabled branch, and the source branch is not from a fork, then all pipelines will be started that have the target branch in its list of CI-enabled branches.</li>
<li>If a PR is opened/edited and targets a CI-enabled branch, but the source branch is from a fork, then a pipeline will be automatically started if and only if the fork is from a user in the pipeline&rsquo;s trusted user list and the target branch is in the pipeline&rsquo;s CI-enabled branches.</li>
</ul>
<p><a href="" id="ref-cicd-pipeline-triggers-comment"></a></p>
<h4 id="cscs-ci-run-comment"><code>cscs-ci run</code> comment<a class="headerlink" href="#cscs-ci-run-comment" title="Permanent link">&para;</a></h4>
<ul>
<li>You have an open PR</li>
<li>You want to trigger a specific pipeline</li>
<li>Write a comment inside the PR with the text
  <div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>cscs-ci run PIPELINE_NAME_1,PIPELINE_NAME_2
</span></code></pre></div></li>
<li>Special case: You have only one pipeline, then you can skip the pipeline names and write only the comment <code>cscs-ci run</code></li>
<li>The pipeline will only be triggered, if the commenting user is in the pipeline&rsquo;s trusted users list.</li>
<li>Only the first line of the comment will be evaluated, i.e. you can add context from line 2 onwards.</li>
<li>The target branch is ignored, i.e. you can test a pipeline even if the target branch is not in the pipeline&rsquo;s CI-enabled branches.</li>
<li>Advanced <code>cscs-ci</code> run command is possible to inject variables into the pipeline (exposed as environment variables)<ul>
<li>Triggering a pipeline with additional variables
  <div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>cscs-ci run PIPELINE_NAME;MY_VARIABLE=some_value;ANOTHER_VAR=other_value
</span></code></pre></div>
  This will trigger the pipeline PIPELINE_NAME, and in your jobs there will be the environment variables MY_VARIABLE and ANOTHER_VAR available.</li>
<li>Disallowed characters for PIPELINE_NAME, variable name and variable value are the characters <code>,;=</code> (comma, semicolon, equal), because they serve as separators of the different components.</li>
</ul>
</li>
</ul>
<p><a href="" id="ref-cicd-pipeline-triggers-api"></a></p>
<h4 id="api-call-triggering">API call triggering<a class="headerlink" href="#api-call-triggering" title="Permanent link">&para;</a></h4>
<ul>
<li>It is possible to trigger a pipeline via an API call</li>
<li>Create a file <code>data.yaml</code>, with the content
    <div class="language-yaml highlight"><span class="filename">data.yaml</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nt">ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pipeline_name</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="nt">MY_VARIABLE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">some_value</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span><span class="nt">ANOTHER_VAR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">other_value</span>
</span></code></pre></div></li>
<li>Send a POST request to the middleware (replace <code>repository_id</code> and <code>webhook_secret</code>)
    <div class="language-console highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="gp">$ </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;repository_id:webhook_secret&#39;</span><span class="w"> </span>--data-binary<span class="w"> </span>@data.yaml<span class="w"> </span>https://cicd-ext-mw.cscs.ch/ci/pipeline/trigger
</span></code></pre></div></li>
<li>To trigger a pull-request use <code>ref: 'pr:&lt;pr-number&gt;'</code></li>
<li>To trigger a tag use <code>ref: 'tag:&lt;tag-name&gt;'</code></li>
<li>To trigger on a specific commit SHA use <code>ref: 'sha:&lt;commit-sha&gt;'</code></li>
</ul>
<h3 id="understanding-the-underlying-workflow">Understanding the underlying workflow<a class="headerlink" href="#understanding-the-underlying-workflow" title="Permanent link">&para;</a></h3>
<p>Typical users do not need to know the underlying workflow behind the scenes, so you can stop reading here.
However, it might put the above-mentioned steps into perspective.
It also can give you background for inquiring if and when something in the procedure does not go as expected.</p>
<h4 id="workflow-exemplified-on-a-github-repository">Workflow (exemplified on a GitHub repository)<a class="headerlink" href="#workflow-exemplified-on-a-github-repository" title="Permanent link">&para;</a></h4>
<ol>
<li>(Prerequisite) Repository in GitHub will have a webhook set up, with the setup details from the CI setup page</li>
<li>You push some change to the GitHub repository</li>
<li>GitHub sends a (push) webhook event to <code>cicd-ext-mw.cscs.ch</code> (CI middleware)</li>
<li>CI middleware fetches your repository from GitHub and pushes a &ldquo;mirror&rdquo; to GitLab</li>
<li>GitLab receives the change in the &ldquo;mirror&rdquo; repository and a pipeline is triggered (i.e. it uses the CI yaml as entry point)</li>
<li>If the repository uses git submodules, <code>GIT_SUBMODULE_STRATEGY: recursive</code> has to be specified (see <a href="https://docs.gitlab.com/ee/ci/git_submodules.html#use-git-submodules-in-cicd-jobs">GitLab documentation</a>)</li>
<li>The <a href="#container-builder">container-builder</a>, which has as input a Dockerfile (specified in the variable <code>DOCKERFILE</code>), will take this Dockerfile and execute something similar to <code>docker build -f $DOCKERFILE .</code>, where the <a href="#build-context">build context</a> is the whole (recursively) cloned repository</li>
</ol>
<h2 id="containerized-ci-best-practices">Containerized CI - best practices<a class="headerlink" href="#containerized-ci-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="multi-architecture-images">Multi-architecture images<a class="headerlink" href="#multi-architecture-images" title="Permanent link">&para;</a></h3>
<p>With the introduction of Grace-Hopper nodes, we have now <code>aarch64</code> and <code>x86_64</code> machines.
This implies that the container images should be built for the correct architecture.
This can be achieved by the following example
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">remote</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://gitlab.com/cscs-ci/recipes/-/raw/master/templates/v2/.ci-ext.yml&#39;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">make_multiarch</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="nt">.build</span><span class="p">:</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/my_dockerfile</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/${ARCH}/my_image_name:${CI_COMMIT_SHORT_SHA}</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="nt">build aarch64</span><span class="p">:</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">.container-builder-cscs-gh200</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">.build</span><span class="p p-Indicator">]</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="nt">build x86_64</span><span class="p">:</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">.container-builder-cscs-zen2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">.build</span><span class="p p-Indicator">]</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="nt">make multiarch</span><span class="p">:</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.make-multiarch-image</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">make_multiarch</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/my_multiarch_image:${CI_COMMIT_SHORT_SHA}</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME_AARCH64</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/aarch64/my_image_name:${CI_COMMIT_SHORT_SHA}</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME_X86_64</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/x86_64/my_image_name:${CI_COMMIT_SHORT_SHA}</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="nt">.run</span><span class="p">:</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/my_multiarch_image:${CI_COMMIT_SHORT_SHA}</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uname -a</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="nt">run aarch64</span><span class="p">:</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">.container-runner-daint-gh200</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">.run</span><span class="p p-Indicator">]</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="nt">run x86_64</span><span class="p">:</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">.container-runner-eiger-mc</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">.run</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p>
<p>We first create two container images which have different names.
Then we combine these two names to a single name, with both architectures.
Finally in the run step we use the multi-architecture image, where the container runtime will pull the correct architecture.</p>
<p>It is <em>not</em> mandatory to combine the container images to a multi-architecture image, i.e. a CI setup which consistently uses the correct architecture specific paths can work.
A multi-architecture image is convenient when you plan to distribute it to other users.</p>
<h3 id="dependency-management">Dependency management<a class="headerlink" href="#dependency-management" title="Permanent link">&para;</a></h3>
<h4 id="problem">Problem<a class="headerlink" href="#problem" title="Permanent link">&para;</a></h4>
<p>A common observation is that your software has many dependencies that are more or less static, i.e. they can change but do so very rarely.
A common pattern one can observe to work around rebuilding base images unnecessarily is a multi-stage CI setup</p>
<ol>
<li>Build (rarely but manually) a base container with all static dependencies and push it to a public container registry</li>
<li>Use the base container and build the software container</li>
<li>Test the newly created software container</li>
<li>Deploy the software container</li>
</ol>
<p>This works fine but has the drawback that one has to do a manual step whenever the dependencies change, e.g. when one wants to upgrade to new versions of the dependencies.
Another drawback of this is that it allows to keep the recipe of the base container outside of the repository, which makes it harder to reproduce results, especially when colleagues want to reproduce a build.</p>
<h4 id="solution">Solution<a class="headerlink" href="#solution" title="Permanent link">&para;</a></h4>
<p>A common solution to this problem is that you have a multi stage setup.
Your repository should have (at least) two Dockerfiles, let us call them <code>Dockerfile.base</code> and <code>Dockerfile</code>.</p>
<ul>
<li><code>Dockerfile.base</code>: This dockerfile contains the recipe to build your base-container, it normally derives <code>FROM</code> a very basic container, e.g. <code>docker.io/ubuntu:24.04</code> or CSCS spack base containers.
Let us call the container image that is built using this recipe <code>BASE_IMG</code>.</li>
<li><code>Dockerfile</code>: This Dockerfile contains the recipe to build your software-container.
It must start with <code>FROM $BASE_IMG</code>.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Have a look at the <a href="#spack-based-images">Spack based images</a> section, to manage software installed in base containers via Spack</p>
</div>
<p>The <code>.container-builder-cscs-*</code> blocks can be used to solve this problem.
The runner supports the variable <code>CSCS_REBUILD_POLICY</code>, which by default is set to <code>if-not-exists</code>.</p>
<p>This means that the runner will check the remote registry if the container image specified in <code>PERSIST_IMAGE_NAME</code> exists.
A new container image is built only if it does not exist yet.
Note: In case you have one build job, <code>PERSIST_IMAGE_NAME</code> can be specified in the <code>variables:</code> field of this build job or as a global variable, like in the Hello World example.
In case you have multiple build jobs and you specify the <code>PERSIST_IMAGE_NAME</code> variable per build job, you need to specify the exact name of the image to be used in the <code>image</code> field of the test job.</p>
<p>CI files would look in the simplest case like this:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">CI YAML</label><label for="__tabbed_1_2">Dockerfile base image</label><label for="__tabbed_1_3">Dockerfile application</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><span class="filename">ci/cscs.yml</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">remote</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://gitlab.com/cscs-ci/recipes/-/raw/master/templates/v2/.ci-ext.yml&#39;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nt">stages</span><span class="p">:</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build_base</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="nt">build base</span><span class="p">:</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build_base</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile.base</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/base/my_base_container:1.0</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">    </span><span class="nt">CSCS_REBUILD_POLICY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">if-not-exists</span><span class="w"> </span><span class="c1"># default anyway, only here for verbosity</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="nt">build software</span><span class="p">:</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/software/my_software:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">    </span><span class="nt">DOCKER_BUILD_ARGS</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[&quot;BASE_IMG=$CSCS_REGISTRY_PATH/base/my_base_container:1.0&quot;]&#39;</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="nt">test software single node</span><span class="p">:</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-runner-daint-gpu</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/software/my_software:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./test_suite_1.sh</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./test_suite_2.sh</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">    </span><span class="nt">SLURM_JOB_NUM_NODES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="nt">test software multi</span><span class="p">:</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-runner-daint-gpu</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/software/my_software:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./test_suite_1.sh</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./test_suite_2.sh</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">    </span><span class="nt">SLURM_JOB_NUM_NODES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-Dockerfile highlight"><span class="filename">ci/docker/Dockerfile.base</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">docker.io/finkandreas/spack:0.19.2-cuda11.7.1-ubuntu22.04</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">ARG</span><span class="w"> </span>NUM_PROCS
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="k">RUN</span><span class="w"> </span>spack-install-helper<span class="w"> </span>daint-gpu<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span>petsc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span>trilinos
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-Dockerfile highlight"><span class="filename">ci/docker/Dockerfile</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">ARG</span><span class="w"> </span>BASE_IMG
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">$BASE_IMG</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="k">ARG</span><span class="w"> </span>NUM_PROCS
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cmake<span class="w"> </span>/sourcecode<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>-j<span class="nv">$NUM_PROCS</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>A setup like this would run the very first time and build the container image <code>$CSCS_REGISTRY_PATH/base/my_base_container:1.0</code>, followed by the job that builds the container image <code>$CSCS_REGISTRY_PATH/software/my_software:1.0</code>.
The next time CI is triggered the <code>.container-builder-cscs-zen2</code> would check the remote repository if the target tag (<code>PERSIST_IMAGE_NAME</code>) exists, and only build a new container image if it does not exist yet.
Since the tag for the job <code>build base</code> is static, i.e. it is the same for every run of CI, it would build the first time it is running, but not for subsequent runs.
In contrast to this is the job <code>build software</code>: Here the tag changes with every CI run, since the variable <code>CI_COMMIT_SHORT_SHA</code> is different for every run.</p>
<h5 id="manual-dependency-update">Manual dependency update<a class="headerlink" href="#manual-dependency-update" title="Permanent link">&para;</a></h5>
<p>At some point you realise that you have to update some of the dependencies.
You can use a manual update process to update your base-container, where you ensure that you update all necessary image tags.
In our example, this means updating in <code>ci/cscs.yml</code> all occurences of <code>$CSCS_REGISTRY_PATH/base/my_base_container:1.0</code> to <code>$CSCS_REGISTRY_PATH/base/my_base_container:2.0</code> (or any other versioning scheme - for all that matters is that the full name must change).
Of course something in <code>Dockerfile.base</code> should change too, otherwise you are building the same artifact, with just a different name.</p>
<h5 id="dynamic-dependency-update">Dynamic dependency update<a class="headerlink" href="#dynamic-dependency-update" title="Permanent link">&para;</a></h5>
<p>While manually updating image tags works fine, it has the drawback that it is error-prone.
Take for example the situation where you update the tag in <code>build base</code>, but forget to change it in <code>build software</code>.
Your pipeline would still run fine, because the dependency of <code>build software</code> exists.
Since there is no explicit error for the inconsistencies it is hard to find the error.</p>
<p>Therefore, there is also the possibility to have a dynamic way of naming your container images.
The idea is the same, i.e. we build first a base-container, and use this base-container to build our software-container.</p>
<p>The <code>build base</code> and <code>build software</code> jobs would look similar to this:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">build base</span><span class="p">:</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build_base</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_TAG=`cat ci/docker/Dockerfile.base | sha256sum - | head -c 16`</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export PERSIST_IMAGE_NAME=$CSCS_REGISTRY_PATH/base/my_base_image:$DOCKER_TAG</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;BASE_IMAGE=$PERSIST_IMAGE_NAME&quot; &gt; build.env</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build.env</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile.base</span><span class="w"> </span><span class="c1"># overwrite with the real path of the Dockerfile</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="nt">build software</span><span class="p">:</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/software/my_software:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">    </span><span class="nt">DOCKER_BUILD_ARGS</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[&quot;BASE_IMG=$BASE_IMAGE&quot;]&#39;</span>
</span></code></pre></div></p>
<p>Let us walk through the changes in the <code>build base</code> job:</p>
<ul>
<li><code>DOCKER_TAG</code> is computed at runtime by the sha256sum of the <code>Dockerfile.base</code>, i.e. it would change, when you change the content of <code>Dockerfile.base</code> (we keep only the first 16 characters, this is random enough to guarantee that we have a unique name).</li>
<li>We export <code>PERSIST_IMAGE_NAME</code> to the dynamic name with <code>DOCKER_TAG</code>.</li>
<li>We write the dynamic name to the file <code>build.env</code></li>
<li>We tell the CI system to keep the <code>build.env</code> as an artifact (see <a href="https://docs.gitlab.com/ee/ci/yaml/artifacts_reports.html#artifactsreportsdotenv">here</a> the documentation of this)</li>
</ul>
<p>Note: The dotenv artifacts of a specific job for public projects is available at <code>https://gitlab.com/cscs-ci/ci-testing/webhook-ci/mirrors/&lt;project_id&gt;/&lt;pipeline_id&gt;/-/jobs/&lt;job_id&gt;/artifacts/download?file_type=dotenv</code>.</p>
<p>Now let us look at the changes in the <code>build software</code> job:</p>
<ul>
<li><code>DOCKER_BUILD_ARGS</code> is now using <code>$BASE_IMAGE</code>.
This variable exists, because we transferred the information via a <code>dotenv</code> artifact from <code>build base</code> to this job.</li>
</ul>
<p>In this example the names <code>BASE_IMG</code> and <code>BASE_IMAGE</code> are chosen to be different, for clarification where the different variables are set and used.
Feel free to use the same names for consistent naming.
The default behaviour is to import all artifacts from all previous jobs.
If you want only specific artifacts in your job, you should have a look at <a href="https://docs.gitlab.com/ee/ci/yaml/#dependencies">dependencies</a>.</p>
<p>There is also a building block in the templates, name <code>.dynamic-image-name</code>, which you can use to get rid for most of the boilerplate.
It is important to note that this building block will export the dynamic name under the hardcoded name <code>BASE_IMAGE</code> in the <code>dotenv</code> file.
The variable <code>DOCKER_TAG</code>, containing the tag of the image, is also exported in the <code>dotenv</code> file.
The jobs would look something like this:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nt">build base</span><span class="p">:</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">.container-builder-cscs-zen2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">.dynamic-image-name</span><span class="p p-Indicator">]</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build_base</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile.base</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/base/my_base_image</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="nt">WATCH_FILECHANGES</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ci/docker/Dockerfile.base&#39;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="nt">build software</span><span class="p">:</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/software/my_software:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">    </span><span class="nt">DOCKER_BUILD_ARGS</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[&quot;BASE_IMG=$BASE_IMAGE&quot;]&#39;</span>
</span></code></pre></div></p>
<p><code>build base</code> is using additionally the building block <code>.dynamic-image-name</code>, while <code>build software</code> is unchanged.
Have a look at the definition of the block <code>.dynamic-image-name</code> in the file <a href="https://gitlab.com/cscs-ci/recipes/-/blob/master/templates/v2/.ci-ext.yml">.ci-ext.yml</a> for further notes.</p>
<div class="admonition example">
<p class="admonition-title">GT4Py example</p>
<p>An example using <code>.dynamic-image-name</code> in action can be found in the <a href="https://github.com/GridTools/gt4py/tree/main/ci">gt4py repository</a>.</p>
</div>
<h3 id="image-cleanup">Image cleanup<a class="headerlink" href="#image-cleanup" title="Permanent link">&para;</a></h3>
<p>Images pushed to <a href="#ci-variables">CSCS_REGISTRY_PATH</a> are cleaned daily according to the following rules:</p>
<ul>
<li>No deletion if total storage usage &lt; 300GB</li>
<li>No deletion of images newer than 30 days</li>
<li>First cleanup excluding folders <code>base</code>, <code>baseimg</code>, <code>baseimage</code>, <code>deploy</code>, <code>deployment</code><ul>
<li>Delete images that have been unused for more than 30 days (usage means that the image has been downloaded)</li>
</ul>
</li>
<li>Second cleanup if storage usage is still &gt; 300GB<ul>
<li>Delete images in the above mentioned excluded folders if the image has been unused for more than 365 days</li>
</ul>
</li>
</ul>
<h3 id="third-party-registries">Third party registries<a class="headerlink" href="#third-party-registries" title="Permanent link">&para;</a></h3>
<p>While it is recommended to work with the CSCS provided registry at <a href="#ci-variables">CSCS_REGISTRY_PATH</a>, due to fastest network connection, it is also possible to work with third party registries like dockerhub.com or quay.io.
When you work with third party registries, then you have to provide login credentials for the CI jobs.</p>
<p>There are two possible ways to push images to third party registries (it is assumed that you have stored the variable <code>DOCKERHUB_ACCESS_TOKEN</code> at the CI setup page):</p>
<p>The first approach will push both, CSCS registry and third party registry <code>dockerhub.com</code>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">my_job</span><span class="p">:</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_stage</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/Dockerfile</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/my_image:${CI_COMMIT_SHORT_SHA}</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="nt">SECONDARY_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.io/your_dockerhub_username/my_image:${CI_COMMIT_SHORT_SHA}</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="nt">SECONDARY_IMAGE_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your_dockerhub_username</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">    </span><span class="nt">SECONDARY_IMAGE_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$DOCKERHUB_ACCESS_TOKEN</span>
</span></code></pre></div></p>
<p>The second approach will only push to the third party registry <code>dockerhub.com</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">my_job</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_stage</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/Dockerfile</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.io/your_dockerhub_username/my_image:${CI_COMMIT_SHORT_SHA}</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="nt">CUSTOM_REGISTRY_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your_dockerhub_username</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="nt">CUSTOM_REGISTRY_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$DOCKERHUB_ACCESS_TOKEN</span>
</span></code></pre></div></p>
<h4 id="clone-image-from-cscs-registry">Clone image from CSCS registry<a class="headerlink" href="#clone-image-from-cscs-registry" title="Permanent link">&para;</a></h4>
<p>CI has access to the CSCS registry while a job is running.
However you cannot download images from the CSCS registry directly, because you do not have valid credentials to access the images.
If the image has not been pushed to a third party registry like hinted above, and one still wants to inspect the image, one can instruct manually CI to copy the image to a third party registry.
Create a yaml file with the content
<div class="language-yaml highlight"><span class="filename">copy_image.yaml</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;repository-id&gt;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;webhook-secret&gt;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nt">from_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/my_cool_image:1.0</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="nt">to_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.io/your_dockerhub_username/my_cool_image_cloned:latest</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="nt">registry_credentials</span><span class="p">:</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your_registry_username</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your_registry_password</span>
</span></code></pre></div></p>
<ul>
<li><code>from_image</code>: The image that you want to copy out of CSCS registry.
It must begin with <code>$CSCS_REGISTRY_PATH</code></li>
<li><code>to_image</code>: The path where the image should be copied</li>
<li><code>registry_credentials</code>: The credentials which allow to login to the registry specified in <code>to_image</code>.
Many registries allow you to create access tokens, which should be preferred to your password.</li>
</ul>
<p>To trigger the copy POST a request to https://cicd-ext-mw.cscs.ch/ci/image/clone (e.g. with <code>curl</code>)
<div class="language-console highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="gp">$ </span>curl<span class="w"> </span>--data-binary<span class="w"> </span>@copy_image.yaml<span class="w"> </span>https://cicd-ext-mw.cscs.ch/ci/image/clone
</span></code></pre></div>
The call might take some time, depending on image size.</p>
<h3 id="spack-based-images">Spack based images<a class="headerlink" href="#spack-based-images" title="Permanent link">&para;</a></h3>
<h4 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h4>
<p><a href="https://spack.io/">Spack</a> is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments.
It was designed for administrators in large supercomputing centres, where many users and application teams share common installations of software on clusters.
It can also be used by users to install software environments exactly for their needs.</p>
<p>We provide Docker images with preinstalled Spack, its configuration for the hardware available at CSCS, and helper scripts that simplify using Spack in a Dockerfile.</p>
<h4 id="install-helper-script">Install helper script<a class="headerlink" href="#install-helper-script" title="Permanent link">&para;</a></h4>
<p>In the image, we provide a <code>spack-install-helper</code> script that helps build a list of packages for a desired architecture.
The script can be used as follows:
<div class="language-console highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="gp">$ </span>spack-install-helper<span class="w"> </span>--target<span class="w"> </span>&lt;target-arch&gt;<span class="w"> </span><span class="o">[</span>--add-repo<span class="w"> </span>&lt;repo&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--only-dependencies<span class="w"> </span>&lt;spec&gt;<span class="o">]</span><span class="w"> </span>&lt;spec&gt;<span class="w"> </span><span class="o">[</span>&lt;spec&gt;...<span class="o">]</span>
</span></code></pre></div></p>
<ul>
<li><code>--target</code> (mandatory) specifying the target architecture.
  Possible values are <code>alps-zen2</code>, <code>alps-a100</code>, <code>alps-gh200</code>, <code>alps-mi200</code>, <code>alps-mi300a</code></li>
<li><code>--add-repo</code> (optional) adds an additional custom Spack repository`</li>
<li><code>--only-dependencies</code> (optional) install only dependencies of the spec.
  It is useful if you want to install a package manually, e.g. for debugging purposes, or together with <code>--add-repo</code> for developing spack&rsquo;s <code>package.py</code></li>
<li><code>spec</code> are any specs that can be passed to the <code>spack install</code> command</li>
</ul>
<h4 id="building-docker-images">Building Docker images<a class="headerlink" href="#building-docker-images" title="Permanent link">&para;</a></h4>
<p>It is good practice to keep Docker images as small as possible, with only the software needed and nothing more.
To support this philosophy, we create our image in a <a href="https://docs.docker.com/build/building/multi-stage/">multistage build</a>.
In the first stage, Spack is used to install the software stack we need.
In the second stage, the software installed in the first stage is copied (without build dependencies and Spack).
After that, we can add to the image anything we need.
We can, for example, build our software, prepare tests, &hellip;</p>
<h5 id="docker-images-naming-scheme">Docker images naming scheme<a class="headerlink" href="#docker-images-naming-scheme" title="Permanent link">&para;</a></h5>
<p>We provide two different images that can be used in the first and second stages of the multistage build.
The image <code>spack-build</code> is used in the first stage and has Spack installed.
The image <code>spack-runtime</code>  is the same, but without spack, only with scripts that make the software installed with spack available.</p>
<p>Both images are available with different versions of installed software, this is encoded in the docker tag.
The tag of the <code>spack-build</code> image has the following scheme <code>spack&lt;version&gt;-&lt;os&gt;&lt;version&gt;-&lt;arch&gt;[version]</code>, e.g. <code>spack-build:spack0.21.0-ubuntu22.04-cuda12.4.1</code> is an image based on <code>ubuntu-22.04</code> with <code>cuda-12.4.1</code> and <code>spack-0.21.0</code>.
The tag of the <code>spack-runtime</code> image has the same scheme, but without <code>spack&lt;version&gt;-</code>, as spack is not installed in this image, e.g. <code>spack-runtime:ubuntu22.04-cuda12.4.1</code>.
It is strongly recommended to always use both images with the same OS and arch for the first and the second stage.</p>
<p>We provide images based on <code>Ubuntu 22.04 LTS</code>  for three different architectures:</p>
<ul>
<li>CPU (x86_64)</li>
<li>CUDA (<code>x86_64+A100</code> and <code>arm64+GH200</code>)</li>
<li>ROCm (<code>x86_64+MI250</code>)</li>
</ul>
<h5 id="docker-registry">Docker registry<a class="headerlink" href="#docker-registry" title="Permanent link">&para;</a></h5>
<p>We provide these images in two docker registries:</p>
<ul>
<li>JFrog hosted at CSCS (jfrog.svc.cscs.ch)<ul>
<li><code>FROM $CSCS_REGISTRY/docker-ci-ext/base-containers/public/spack-build:&lt;tag&gt;</code></li>
<li><code>FROM $CSCS_REGISTRY/docker-ci-ext/base-containers/public/spack-runtime:&lt;tag&gt;</code></li>
<li>Available only on the CSCS network</li>
<li>Recommended for CI/CD workflows at CSCS</li>
</ul>
</li>
<li><a href="https://github.com/orgs/eth-cscs/packages">GitHub Container Registry</a><ul>
<li><code>FROM ghcr.io/eth-cscs/docker-ci-ext/base-containers/spack-build:&lt;tag&gt;</code></li>
<li><code>FROM ghcr.io/eth-cscs/docker-ci-ext/base-containers/spack-runtime:&lt;tag&gt;</code></li>
<li>Available from everywhere</li>
<li>Recommended for manual workflows</li>
</ul>
</li>
</ul>
<h5 id="example-dockerfile">Example Dockerfile<a class="headerlink" href="#example-dockerfile" title="Permanent link">&para;</a></h5>
<p>Use this Dockerfile template.
Adjust the <code>spack-install-helper</code> command as needed, especially the target architecture and list of packages.
Add any commands after <code>fix_spack_install</code> or drop all of them if you need only the software installed by spack.</p>
<div class="language-Dockerfile highlight"><span class="filename">Dockerfile</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c"># use spack to install the software stack</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">$CSCS_REGISTRY/docker-ci-ext/base-containers/public/spack-build:spack0.21.0-ubuntu22.04-cuda12.4.1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c"># number or processes used for building the spack software stack</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="k">ARG</span><span class="w"> </span>NUM_PROCS
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="k">RUN</span><span class="w"> </span>spack-install-helper<span class="w"> </span>--target<span class="w"> </span>alps-gh200<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="s2">&quot;git&quot;</span><span class="w"> </span><span class="s2">&quot;cmake&quot;</span><span class="w"> </span><span class="s2">&quot;valgrind&quot;</span><span class="w"> </span><span class="s2">&quot;python@3.11&quot;</span><span class="w"> </span><span class="s2">&quot;vim +python +perl +lua&quot;</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="c"># end of builder container, now we are ready to copy necessary files</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="c"># copy only relevant parts to the final container</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="k">FROM</span><span class="w"> </span><span class="s">$CSCS_REGISTRY/docker-ci-ext/base-containers/public/spack-runtime:ubuntu22.04-cuda12.4.1</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="c"># it is important to keep the paths, otherwise your installation is broken</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="c"># all these paths are created with the above `spack-install-helper` invocation</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/opt/spack-environment<span class="w"> </span>/opt/spack-environment
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/opt/software<span class="w"> </span>/opt/software
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/opt/._view<span class="w"> </span>/opt/._view
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/etc/profile.d/z10_spack_environment.sh<span class="w"> </span>/etc/profile.d/z10_spack_environment.sh
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="c"># Some boilerplate to get all paths correctly - fix_spack_install is part of the base image</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="c"># and makes sure that all important things are being correctly setup</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="k">RUN</span><span class="w"> </span>fix_spack_install
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="c"># Finally install software that is needed, e.g. compilers</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="c"># It is also possible to build compilers via spack and let all dependencies be handled by spack</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>-yqq<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>-yqq<span class="w"> </span>upgrade<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>-yqq<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>gfortran<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*
</span></code></pre></div>
<h3 id="manual-container-build">Manual container build<a class="headerlink" href="#manual-container-build" title="Permanent link">&para;</a></h3>
<p>It is possible to use CI&rsquo;s mechanisms to build a container image manually providing a <code>Dockerfile</code>, or even a full build context with a <code>Dockerfile</code>.
For reproducibility one should aim to use a code versioning system like <code>git</code>, but for debugging a manual API call might not pollute the code history so much.</p>
<p>To use the API endpoint you need to create API credentials (one time setup) using the developer portal.
Please follow <a class="autorefs autorefs-internal" title="Developer Portal" href="../devportal/#developer-portal">this guide</a>.
To be able to use manual API container builds you must subscribe your application to the <code>ciext-container-builder</code> API.</p>
<p>After your application is created the tab <code>APIs</code> will appear at the top of the developer portal, which allows you to inspect the API for <code>ciext-container-builder</code>.
The section <code>Documents</code> is very helpful as it contains the endpoint documentation for <code>/container/build POST</code>.
Refer to the documentation there for all parameters.</p>
<p>The endpoint can work in two different modes:</p>
<ol>
<li>Send just a Dockerfile</li>
<li>Send a full build context as a tar.gz-archive and tell the API where the Dockerfile inside the tarball is.</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Create access token</p>
<p>To send any request to the API endpoint, we first need to create an access token, which can be done with the Consumer Key and Consumer secret.
<div class="language-console highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="gp">$ </span><span class="nv">ACCESS_TOKEN</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>curl<span class="w">  </span>-u<span class="w"> </span>&lt;your-consumer-key&gt;:&lt;your-consumer-secret&gt;<span class="w"> </span>--silent<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://auth.cscs.ch/auth/realms/firecrest-clients/protocol/openid-connect/token<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;grant_type=client_credentials&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.access_token&#39;</span><span class="k">)</span><span class="s2">&quot;</span>
</span></code></pre></div>
The token is stored in the variable ACCESS_TOKEN.
This token has only a short validity, so you need to create a fresh access token, whenever the current one becomes invalid (about 5 minutes validity).</p>
</div>
<div class="admonition info">
<p class="admonition-title">Build from Dockerfile</p>
<p><div class="language-console highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="gp">$ </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>--data-binary<span class="w"> </span>@path/to/Dockerfile<span class="w"> </span><span class="s2">&quot;https://api.cscs.ch/ciext/v1/container/build?arch=x86_64&quot;</span>
</span></code></pre></div>
It is mandatory to specify for which architecture you want to build the container.
Valid choices are:</p>
<ul>
<li><code>x86_64</code> - Correct for all nodes that are not Grace-Hopper</li>
<li><code>aarch64</code> - ARM architecture - Correct for Grace-Hopper</li>
</ul>
<p>The API call above sends the Dockerfile to the server, and the server will reply with a link, where you can see the build log.
The final container image will be pushed to JFrog, a CSCS internal container registry.
Once the container image is built, it can be pulled from any CSCS machine.</p>
<p>If you want to push the image to your Docker Hub account, you need to create a Docker Hub access token with write permissions, and then use the API call (similarly for other OCI registry providers)
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>$ curl -H &quot;Authorization: Bearer $ACCESS_TOKEN&quot; -H &quot;X-Registry-Username &lt;your-dockerhub-username&gt;&quot; -H &quot;X-Registry-Password: &lt;your-dockerhub-token&gt;&quot; --data-binary @path/to/Dockerfile &quot;https://api.cscs.ch/ciext/v1/container/build?arch=x86_64&amp;image=docker.io/&lt;your-dockerhub-username&gt;/my_image_name:latest&quot;
</span></code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">Build with code</p>
<p>If you are using <code>COPY</code> or <code>ADD</code> statements in your Dockerfile, you will need to send the build context too.
To send a full archive the easiest is via the API call
<div class="language-console highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="gp">$ </span>tar<span class="w"> </span>-C<span class="w"> </span>path/to/build-context<span class="w"> </span>-czf<span class="w"> </span>-<span class="w"> </span>.<span class="w"> </span><span class="p">|</span><span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$ACCESS_TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>--data-binary<span class="w"> </span>@-<span class="w"> </span><span class="s2">&quot;https://api.cscs.ch/ciext/v1/container/build?arch=x86_64&amp;dockerfile=relative/path/to/Dockerfile&quot;</span>
</span></code></pre></div>
This is similar to
<div class="language-console highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="gp">$ </span>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>relative/path/to/Dockerfile<span class="w"> </span>.
</span></code></pre></div></p>
</div>
<h2 id="cscs-ci-specifics">CSCS CI specifics<a class="headerlink" href="#cscs-ci-specifics" title="Permanent link">&para;</a></h2>
<h3 id="restart-ci-jobs">Restart CI jobs<a class="headerlink" href="#restart-ci-jobs" title="Permanent link">&para;</a></h3>
<p>This section applies for public projects.
Public projects get as notification a link to the pipeline in the Gitlab mirror repository.
Since a user does not have any special permissions to the mirror repository, it is not possible to restart jobs through the Gitlab UI.
However, it is possible to see an alternative view of your pipeline result in a CSCS-provided pipeline overview.
Private projects will always get as notification a link to the CSCS pipeline overview, since the mirror repository is private and the pipeline results are not visible publicly.</p>
<p>To view the CSCS pipeline overview for a public project and restart / cancel jobs, follow these steps:</p>
<ul>
<li>Copy the web link of the CSCS CI status of your project and remove the from the link the <code>type=gitlab</code>.</li>
<li>Alternatively, assemble the link yourself, it has the form <code>https://cicd-ext-mw.cscs.ch/ci/pipeline/results/&lt;repository_id&gt;/&lt;project_id&gt;/&lt;pipeline_nb&gt;</code> (the IDs can be found on the Gitlab page of your mirror project).</li>
<li>Click on <code>Login to restart jobs</code> at the bottom right and login with your CSCS credentials</li>
<li>Click <code>Cancel running</code> or <code>Restart jobs</code> or cancel individual jobs (button next to job&rsquo;s name)</li>
<li>Everybody that has at least <em>Manager</em> access can restart / cancel jobs (access level is managed on the CI setup page in the Admin section)</li>
</ul>
<h3 id="common-pitfalls">Common pitfalls<a class="headerlink" href="#common-pitfalls" title="Permanent link">&para;</a></h3>
<p>The CI service uses GitLab to run the pipelines, with the familiar GitLab YAML configuration.
However, some features described in the official documentation will not work as expected.</p>
<p>Below are known differences:</p>
<ul>
<li><code>CI_PIPELINE_SOURCE</code> always has the value <code>trigger</code>, i.e. it is never <code>push</code> or <code>merge_request</code>, or any other value mentioned in the GitLab documentation.</li>
<li><code>rules: changes</code> will not work, as you never run a branch or a merge request pipeline</li>
<li><code>only / except</code> and <code>rules</code> can restrict jobs to specific branches, but remember that a pipeline is only triggered if it matches the rules defined on your repository&rsquo;s setup page.</li>
<li>Trigger jobs for child pipelines must use <code>trigger:forward:pipeline_variables: true</code>, i.e.
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nt">my trigger job</span><span class="p">:</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="nt">trigger</span><span class="p">:</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/child/pipeline.yml</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="nt">forward</span><span class="p">:</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">      </span><span class="nt">pipeline_variables</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></li>
</ul>
<h2 id="ci-variables">CI variables<a class="headerlink" href="#ci-variables" title="Permanent link">&para;</a></h2>
<p>Many variables exist during a pipeline run, they are documented at <a href="https://docs.gitlab.com/ee/ci/variables/predefined_variables.html">Gitlab&rsquo;s predefined variables</a>.
Variables are exposed as environment variables during job execution, where the key is the environment variable&rsquo;s name.
Additionally to CI variables available through Gitlab, there are a few CSCS specific variables:</p>
<h3 id="cscs_registry"><code>CSCS_REGISTRY</code><a class="headerlink" href="#cscs_registry" title="Permanent link">&para;</a></h3>
<p>value: <code>jfrog.svc.cscs.ch</code></p>
<p>CSCS internal registry, preferred registry to store your container images</p>
<h3 id="cscs_registry_path"><code>CSCS_REGISTRY_PATH</code><a class="headerlink" href="#cscs_registry_path" title="Permanent link">&para;</a></h3>
<p>value: <code>jfrog.svc.cscs.ch/docker-ci-ext/&lt;repository-id&gt;</code></p>
<p>The prefix path in the CSCS internal container image registry, to which your pipeline has write access.
Within this prefix, you can choose any directory structure.
Images that are pushed to a path matching <code>**/public/**</code>, can be pulled by anybody within CSCS network</p>
<h3 id="cscs_ci_mw_url"><code>CSCS_CI_MW_URL</code><a class="headerlink" href="#cscs_ci_mw_url" title="Permanent link">&para;</a></h3>
<p>value: <code>https://cicd-ext-mw.cscs.ch/ci</code></p>
<p>The URL of the middleware, the orchestrator software</p>
<h3 id="cscs_ci_default_slurm_account"><code>CSCS_CI_DEFAULT_SLURM_ACCOUNT</code><a class="headerlink" href="#cscs_ci_default_slurm_account" title="Permanent link">&para;</a></h3>
<p>value: Configured on the CI setup page in the admin section <code>Firecrest Slurm Account</code></p>
<p>The project to which Slurm accounting will go to by default.
It can be overwritten via <code>SLURM_ACCOUNT</code> for individual jobs.</p>
<h3 id="cscs_ci_orig_clone_url"><code>CSCS_CI_ORIG_CLONE_URL</code><a class="headerlink" href="#cscs_ci_orig_clone_url" title="Permanent link">&para;</a></h3>
<p>value:</p>
<ul>
<li>public repositories: HTTPS clone URL, e.g. <code>https://github.com/my-org/my-project</code></li>
<li>private repositories: SSH clone URL, e.g. <code>git@github.com:my-org/my-project</code></li>
</ul>
<p>Clone URL for git.
This is needed for some implementation details of the gitlab-runner custom executor.
This is the clone URL of the registered project, i.e. this is not the clone URL of the mirror project.</p>
<h3 id="arch"><code>ARCH</code><a class="headerlink" href="#arch" title="Permanent link">&para;</a></h3>
<p>value: <code>x86_64</code> or <code>aarch64</code></p>
<p>This is the architecture of the runner. It is either an ARM64 machine, i.e. <code>aarch64</code>, or a traditional <code>x86_64</code> machine.</p>
<h2 id="runners-reference">Runners reference<a class="headerlink" href="#runners-reference" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This section is a reference documentation.
It is not meant as a starting point to understand the CI/CD workflow.
It documents the interface that a runner provides and the input variables that it accepts.
It is a good place for quick lookup, once you have a pipeline already set up.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Use CSCS&rsquo; runners</p>
<p>Each runner and its interface are described below.
To use a runner provided by CSCS you must include the runners configuration yaml file in your pipeline like this:
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>include:
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>  - remote: &#39;https://gitlab.com/cscs-ci/recipes/-/raw/master/templates/v2/.ci-ext.yml&#39;
</span></code></pre></div></p>
</div>
<p>The runners <code>container-runner</code>, <code>uenv-builder</code>, <code>uenv-runner</code>, and <code>baremetal-runner</code> will submit a Slurm job to a cluster.
To configure your Slurm job, you must use the <code>variables</code> section in your job&rsquo;s yaml config.
Accepted variables are documented at <a href="https://slurm.schedmd.com/srun.html#SECTION_INPUT-ENVIRONMENT-VARIABLES">Slurm&rsquo;s srun man page</a>.</p>
<div class="admonition example">
<p class="admonition-title">Parametrizing Slurm</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nt">my job</span><span class="p">:</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-runner-daint-gh200</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/my_image:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;I am running as rank $SLURM_PROCID on $(hostname)&quot;</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">        </span><span class="nt">SLURM_JOB_NUM_NODES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">        </span><span class="nt">SLURM_NTASKS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">        </span><span class="nt">SLURM_TIMELIMIT</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;00:10:00&#39;</span>
</span></code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">SLURM_TIMELIMIT</p>
<p>Special attention should go the variable <code>SLURM_TIMELIMIT</code>, which sets the maximum time of your Slurm job.
You will be billed the node hours that your CI jobs are spending on the cluster, i.e. you want to set the <code>SLURM_TIMELIMIT</code> to the maximum time that you expect the job to run.
You should also pay attention to wrap the value in quotes, because the gitlab-runner interprets the time differently than Slurm, when it is not wrapped in quotes, i.e. This is correct:
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>SLURM_TIMELIMIT: &quot;00:30:00&quot;
</span></code></pre></div>
Without quotes the value will be converted to the integer 1800 internally, before being passed to the runner (i.e. number of seconds), however for Slurm the convention is that an integer value is in the unit minutes.</p>
</div>
<h3 id="container-builder">container-builder<a class="headerlink" href="#container-builder" title="Permanent link">&para;</a></h3>
<p>We provide the <code>container-builder</code> runner for every available CPU architecture at CSCS.
This runner takes as input a Dockerfile, builds a container image based on the recipe in the Dockerfile and publishes the image to an OCI registry.</p>
<p>The naming for the runner is <code>.container-builder-cscs-&lt;MICROARCHITECTURE&gt;</code>.</p>
<p>The following runners are available:</p>
<ul>
<li><code>.container-builder-cscs-zen2</code></li>
<li><code>.container-builder-cscs-gh200</code></li>
</ul>
<h4 id="variables">Variables<a class="headerlink" href="#variables" title="Permanent link">&para;</a></h4>
<h5 id="dockerfile"><code>DOCKERFILE</code><a class="headerlink" href="#dockerfile" title="Permanent link">&para;</a></h5>
<p>Mandatory variable, example value: <code>ci/docker/Dockerfile</code></p>
<p>Relative path in your repository to the Dockerfile recipe.</p>
<h5 id="persist_image_name"><code>PERSIST_IMAGE_NAME</code><a class="headerlink" href="#persist_image_name" title="Permanent link">&para;</a></h5>
<p>Mandatory variable, example value: <code>$CSCS_REGISTRY_PATH/subdirectory/my_image:$CI_COMMIT_SHORT_SHA</code></p>
<p>The path where to store the container image.
CSCS provides a registry through the variable <code>CSCS_REGISTRY_PATH</code>.
Images stored in the CSCS provided registry can only be accessed from the CSCS network.
A pipeline has read and write access to any path inside <code>$CSCS_REGISTRY_PATH</code>.</p>
<p>See also <a href="#dependency-management">dependency management</a> for common naming and <a href="#third-party-registries">third party registry usage</a>.</p>
<h5 id="cscs_build_in_memory"><code>CSCS_BUILD_IN_MEMORY</code><a class="headerlink" href="#cscs_build_in_memory" title="Permanent link">&para;</a></h5>
<p>Optional variable, default: <code>TRUE</code></p>
<p>Instruct the runner that the whole build process will build in memory.
The default value is <code>TRUE</code>, and you should only set it to <code>FALSE</code> if you see your job failing due to out-of-memory errors.</p>
<h5 id="docker_build_args"><code>DOCKER_BUILD_ARGS</code><a class="headerlink" href="#docker_build_args" title="Permanent link">&para;</a></h5>
<p>Optional variable, example value: <code>["ARG1=val1", "ARG2=val2"]</code></p>
<p>This allows the usage of the keyword ARG  in your Dockerfile.
The value must be a valid JSON array, where each entry is a string.</p>
<p>It is almost always correct to wrap the full value in single-quotes.</p>
<p>It is also possible to define the argument&rsquo;s values as an entry in <code>variables</code>, and then reference in <code>DOCKER_BUILD_ARGS</code> only the variables that you want to expose to the build process, i.e. something like this:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nt">my job</span><span class="p">:</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-gh200</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="nt">VAR1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">some value</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">    </span><span class="nt">VAR2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">another variable</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">    </span><span class="nt">DOCKER_BUILD_ARGS</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[&quot;VAR1&quot;,</span><span class="nv"> </span><span class="s">&quot;VAR2&quot;]&#39;</span>
</span></code></pre></div></p>
<h5 id="cscs_rebuild_policy"><code>CSCS_REBUILD_POLICY</code><a class="headerlink" href="#cscs_rebuild_policy" title="Permanent link">&para;</a></h5>
<p>Optional variable, default: <code>if-not-exists</code></p>
<p>This variable can be:</p>
<ul>
<li><code>always</code><ul>
<li>A new container image will always we built.</li>
</ul>
</li>
<li><code>if-not-exists</code><ul>
<li>The runner will first check on the registry if the image <code>$PERSIST_IMAGE_NAME</code>  exists already.
  If it exists, then the runner will not rebuild the image.
  This is useful to disable rebuilding of base containers.
  See section <a href="#dependency-management">dependency management</a>.</li>
</ul>
</li>
</ul>
<h5 id="secondary_registry"><code>SECONDARY_REGISTRY</code><a class="headerlink" href="#secondary_registry" title="Permanent link">&para;</a></h5>
<p>Optional variable, example value: <code>docker.io/username/my_image:1.0</code></p>
<p>Allows pushing also to <code>$SECONDARY_REGISTRY</code>, additionally to <code>$PERSIST_IMAGE_NAME</code>.
The result image will pushed to both registries.</p>
<h5 id="secondary_registry_username"><code>SECONDARY_REGISTRY_USERNAME</code><a class="headerlink" href="#secondary_registry_username" title="Permanent link">&para;</a></h5>
<p>Optional variable</p>
<p>The username to push to <code>$SECONDARY_REGISTRY</code>.
Mandatory when using <code>SECONDARY_REGISTRY</code>.</p>
<h5 id="secondary_registry_password"><code>SECONDARY_REGISTRY_PASSWORD</code><a class="headerlink" href="#secondary_registry_password" title="Permanent link">&para;</a></h5>
<p>Optional variable</p>
<p>The password/token to push to <code>$SECONDARY_REGISTRY</code>.
Mandatory when using <code>SECONDARY_REGISTRY</code>
For security you should store a secret variable on the CI setup page, and forward it in the job yaml.
If possible do not use your password, but create an access token.</p>
<h5 id="custom_registry_username"><code>CUSTOM_REGISTRY_USERNAME</code><a class="headerlink" href="#custom_registry_username" title="Permanent link">&para;</a></h5>
<p>Optional variable</p>
<p>If <code>$PERSIST_IMAGE_NAME</code> is not inside the CSCS default registry, then you have to provide the credentials for pushing to the registry.</p>
<h5 id="custom_registry_password"><code>CUSTOM_REGISTRY_PASSWORD</code><a class="headerlink" href="#custom_registry_password" title="Permanent link">&para;</a></h5>
<p>Optional variable</p>
<p>If <code>$PERSIST_IMAGE_NAME</code> is not inside the CSCS default registry, then you have to provide the credentials for pushing to the registry.
For security you should store a secret variable on the CI setup page, and forward it in the job yaml.
If possible do not use your password, but create an access token.</p>
<h4 id="build-arguments">Build arguments<a class="headerlink" href="#build-arguments" title="Permanent link">&para;</a></h4>
<p>Build arguments are configured with the variable <a href="#docker_build_args"><code>DOCKER_BUILD_ARGS</code></a>.
Additionally these build arguments are injected</p>
<h5 id="cscs_registry_path_1"><code>CSCS_REGISTRY_PATH</code><a class="headerlink" href="#cscs_registry_path_1" title="Permanent link">&para;</a></h5>
<p>This allows to do in your <code>Dockerfile</code> this:
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">ARG</span><span class="w"> </span>CSCS_REGISTRY_PATH
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">$CSCS_REGISTRY_PATH/some_subdir/my_base_image:1.0</span>
</span></code></pre></div></p>
<h5 id="num_procs"><code>NUM_PROCS</code><a class="headerlink" href="#num_procs" title="Permanent link">&para;</a></h5>
<p>This is an integer value with the numbers of CPU cores assigned to your build process.
This is useful as number of jobs for <code>make</code>.
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">ARG</span><span class="w"> </span>NUM_PROCS
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>-j<span class="nv">$NUM_PROCS</span>
</span></code></pre></div></p>
<h4 id="build-context">Build context<a class="headerlink" href="#build-context" title="Permanent link">&para;</a></h4>
<p>The <a href="https://docs.docker.com/build/concepts/context/">build context</a> during the build process is the cloned repository, which allows you to copy the sources inside the image via
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>/tmp/cloned_repository
</span></code></pre></div></p>
<p>Additionally the cloned repository is bind-mounted inside the build process under the path <code>/sourcecode</code>, which allows you to read files from there, without the need to copy them inside the container image..
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">RUN</span><span class="w"> </span>cp<span class="w"> </span>-a<span class="w"> </span>/sourcecode<span class="w"> </span>/tmp/cloned_repository
</span></code></pre></div></p>
<h4 id="example-jobs">Example jobs<a class="headerlink" href="#example-jobs" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nt">job1</span><span class="p">:</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-zen2</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/x86_64/my_image:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="nt">job2</span><span class="p">:</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-builder-cscs-gh200</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="nt">DOCKERFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/docker/Dockerfile</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="nt">PERSIST_IMAGE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/aarch64/my_image:$CI_COMMIT_SHORT_SHA</span>
</span></code></pre></div>
<h3 id="container-runner">container-runner<a class="headerlink" href="#container-runner" title="Permanent link">&para;</a></h3>
<p>This runner submits SLURM jobs through FirecREST.
See the <a href="#firecrest">comments below</a> and the <a class="autorefs autorefs-internal" href="../../access/firecrest/#firecrest">FirecREST documentation</a> for additional FirecREST information.</p>
<p>The naming for the runner is <code>.container-runner-&lt;CLUSTERNAME&gt;-&lt;MICROARCHITECTURE&gt;</code></p>
<p>The following runners are available:</p>
<ul>
<li><code>.container-runner-eiger-zen2</code></li>
<li><code>.container-runner-daint-gh200</code></li>
<li><code>.container-runner-santis-gh200</code></li>
<li><code>.container-runner-clariden-gh200</code></li>
</ul>
<p>The container image is specified in the tag <code>image</code> in the job yaml.
This tag is mandatory.</p>
<h4 id="variables_1">Variables<a class="headerlink" href="#variables_1" title="Permanent link">&para;</a></h4>
<h5 id="git_strategy"><code>GIT_STRATEGY</code><a class="headerlink" href="#git_strategy" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is <code>none</code></p>
<p>This is a <a href="https://docs.gitlab.com/ee/ci/runners/configure_runners.html#git-strategy">default Gitlab variable</a>, but mentioned here explicitly, because very often you do not need to clone the repository source code when you run your containerized application.</p>
<p>The default is <code>none</code>, and you must explicitly set it to <code>fetch</code>  or <code>clone</code>  to fetch the source code by the runner.</p>
<h5 id="cscs_cuda_mps"><code>CSCS_CUDA_MPS</code><a class="headerlink" href="#cscs_cuda_mps" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is <code>NO</code></p>
<p>Enable running with <code>nvidia-mps-server</code>, which allows multiple ranks sharing the same GPU.</p>
<h5 id="use_mpi"><code>USE_MPI</code><a class="headerlink" href="#use_mpi" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is <code>AUTO</code></p>
<p>Enable running with MPI hooks enabled.
This allows to inject the host MPI library inside the container runtime for native MPI speed.</p>
<p>This variable is optional and the default value is <code>AUTO</code> , where it is set to <code>YES</code>, if you run with more than 1 rank, otherwise <code>NO</code>.</p>
<h5 id="use_nccl"><code>USE_NCCL</code><a class="headerlink" href="#use_nccl" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is empty</p>
<p>Set to the <a class="autorefs autorefs-internal" title="AWS OFI NCCL hook" href="../../software/container-engine/resource-hook/#aws-ofi-nccl-hook">NCCL variant</a> that you would like to use (e.g. <code>cuda12</code>)
This adds the annotations <code>aws_ofi_nccl.variant=&lt;value&gt;</code> and <code>aws_ofi_nccl.enabled=true</code>.</p>
<h5 id="edf_append"><code>EDF_APPEND</code><a class="headerlink" href="#edf_append" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is empty</p>
<p>This allows to append any user-defined additional EDF keys that are not yet controlled by explicit variables.</p>
<p>In general you should prefer using the variables to enable/disable specific annotations.</p>
<h5 id="cscs_additional_mounts"><code>CSCS_ADDITIONAL_MOUNTS</code><a class="headerlink" href="#cscs_additional_mounts" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is empty</p>
<p>This allows mounting user defined host directories inside the container.
The value must be a valid JSON array of strings, where each entry is of the form <code>&lt;host-path&gt;:&lt;container-path&gt;</code>.
Example:
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>CSCS_ADDITIONAL_MOUNTS: &#39;[&quot;/scratch/capstor/cscs:/scratch&quot;, &quot;/users/&lt;my-username&gt;:/home/cscs_home&quot;]&#39;
</span></code></pre></div></p>
<h4 id="example-jobs_1">Example jobs<a class="headerlink" href="#example-jobs_1" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nt">job1</span><span class="p">:</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-runner-daint-gh200</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/aarch64/my_image:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/my_application /data/some_input.xml</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">    </span><span class="nt">CSCS_ADDITIONAL_MOUNTS</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[&quot;/capstor/scratch/cscs/&lt;my_username&gt;/data:/data&quot;]&#39;</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="nt">job2</span><span class="p">:</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-runner-eiger-zen2</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CSCS_REGISTRY_PATH/x86_64/my_image:$CI_COMMIT_SHORT_SHA</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/my_application ./data_in_repository.txt</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">    </span><span class="nt">GIT_STRATEGY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetch</span>
</span></code></pre></div>
<h3 id="container-runner-lightweight">container-runner-lightweight<a class="headerlink" href="#container-runner-lightweight" title="Permanent link">&para;</a></h3>
<p>This runner allows lightweight jobs that do not need many resources.
The advantage is that the job is not running via Slurm and can therefore start faster.
The maximum timeout for this runner is 60 minutes and you can request at most 4 CPUs and 4GB of memory.
If your job does not fit these requirements, then you must use the default <a href="#container-runner">container-runner</a>.</p>
<p>Typical examples of when this runner is the right choice (not limited to these use cases though):</p>
<ul>
<li>Upload code coverage artifacts</li>
<li>Create a <a href="https://docs.gitlab.com/ee/ci/pipelines/downstream_pipelines.html#dynamic-child-pipelines">dynamic pipeline</a> yaml file</li>
</ul>
<p>The naming for the runner is <code>.container-runner-lightweight-&lt;MICROARCHITECTURE&gt;</code></p>
<p>The following runners are available:</p>
<ul>
<li><code>.container-runner-lightweight-zen2</code></li>
<li><code>.container-runner-lightweight-gh200</code></li>
</ul>
<p>This runner is restricted to public images.
It is not possible to run an image that cannot be pulled anonymously.
If you have built a container image in a previous stage and stored it in <code>$CSCS_REGISTRY_PATH</code>, then you must ensure that it is in a subdirectory with the name <code>public</code>, i.e., the image path must match the wildcard <code>$CSCS_REGISTRY_PATH/**/public/**</code>.</p>
<p>You can set the CPU and memory requests/limits with variables.
A request specifies the minimum amount of resources that your job requires.
Your job will not be scheduled until the requested resources are available.
A limit is the maximum that your job might be able to use if available, but the job is not guaranteed to be allocated that limit.</p>
<h4 id="variables_2">Variables<a class="headerlink" href="#variables_2" title="Permanent link">&para;</a></h4>
<h5 id="kubernetes_cpu_request"><code>KUBERNETES_CPU_REQUEST</code><a class="headerlink" href="#kubernetes_cpu_request" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is 1</p>
<p>Number of CPUs minimally needed to schedule this job.</p>
<h5 id="kubernetes_cpu_limit"><code>KUBERNETES_CPU_LIMIT</code><a class="headerlink" href="#kubernetes_cpu_limit" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is 1
Limit the job to use at most that many CPUs.</p>
<h5 id="kubernetes_memory_request"><code>KUBERNETES_MEMORY_REQUEST</code><a class="headerlink" href="#kubernetes_memory_request" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is <code>1Gi</code></p>
<p>The amount of memory minimally needed to schedule the job.</p>
<h5 id="kubernetes_memory_limit"><code>KUBERNETES_MEMORY_LIMIT</code><a class="headerlink" href="#kubernetes_memory_limit" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is <code>1Gi</code></p>
<p>Limit the job to use at most this much memory.
You will get an OOM (out-of-memory) error, if you exceed the limit.</p>
<h4 id="example-jobs_2">Example jobs<a class="headerlink" href="#example-jobs_2" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nt">job1</span><span class="p">:</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-runner-lightweight-zen2</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.io/python:3.11</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/pipeline/generate_pipeline.py &gt; dynamic_pipeline.yaml</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynamic_pipeline.yaml</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="nt">job2</span><span class="p">:</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.container-runner-lightweight-aarch64</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.io/python:3.11</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/upload_code_coverage.sh</span>
</span></code></pre></div>
<h3 id="uenv-builder">uenv-builder<a class="headerlink" href="#uenv-builder" title="Permanent link">&para;</a></h3>
<p>This runner submits SLURM jobs through FirecREST.
See the <a href="#firecrest">comments below</a> and the <a class="autorefs autorefs-internal" href="../../access/firecrest/#firecrest">FirecREST documentation</a> for additional FirecREST information.</p>
<p>The naming for the runner is <code>.uenv-builder-&lt;CLUSTERNAME&gt;-&lt;MICROARCHITECTURE&gt;</code></p>
<p>The following runners are available:</p>
<ul>
<li><code>.uenv-builder-eiger-zen2</code></li>
<li><code>.uenv-builder-daint-gh200</code></li>
<li><code>.uenv-builder-santis-gh200</code></li>
<li><code>.uenv-builder-clariden-gh200</code></li>
</ul>
<p><code>uenv-builder</code> is very similar to <a href="#container-builder">container-builder</a>, the main difference is that you are building a uenv based on a recipe directory instead of Dockerfile.</p>
<p>The uenv will be registered under the name <code>$UENV_NAME/$UENV_VERSION:$UENV_TAG</code>.</p>
<p>A uenv will only be rebuilt, if there is no uenv already registered under that name.</p>
<p>The tag&rsquo;s default value is calculated as a hash from the contents of your uenv recipe yaml files, which ensures that a uenv is rebuilt every time the content of the recipe&rsquo;s yaml files changes.
Additionally to the computed hash value, the uenv image will also be registered under the name <code>$UENV_NAME/$UENV_VERSION:$CI_PIPELINE_ID</code>, which allows to refer to the image in subsequent <a href="#uenv-runner">uenv-runner</a> jobs.</p>
<h4 id="variables_3">Variables<a class="headerlink" href="#variables_3" title="Permanent link">&para;</a></h4>
<h5 id="uenv_name"><code>UENV_NAME</code><a class="headerlink" href="#uenv_name" title="Permanent link">&para;</a></h5>
<p>Mandatory variable, default is empty</p>
<p>The name of the uenv.
Use alpha-numeric characters, dash (<code>-</code>), underscore (<code>_</code>), and dot (<code>.</code>).</p>
<h5 id="uenv_version"><code>UENV_VERSION</code><a class="headerlink" href="#uenv_version" title="Permanent link">&para;</a></h5>
<p>Mandatory variable, default is empty</p>
<p>The version of the uenv.
Use alpha-numeric characters, dash (<code>-</code>), underscore (<code>_</code>), and dot (<code>.</code>).</p>
<h5 id="uenv_recipe"><code>UENV_RECIPE</code><a class="headerlink" href="#uenv_recipe" title="Permanent link">&para;</a></h5>
<p>Mandatory variable, default is empty</p>
<p>The relative path to the directory containing the recipe yaml files.</p>
<h5 id="uenv_tag"><code>UENV_TAG</code><a class="headerlink" href="#uenv_tag" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is a computed hash</p>
<p>Set to an explicit tag, if you want to opt-out of the feature that a uenv is automatically rebuilt, when the contents of the recipe yaml files changes.
Please keep in mind that a uenv is only rebuilt, when the full uenv name changes.</p>
<h4 id="example-jobs_3">Example jobs<a class="headerlink" href="#example-jobs_3" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nt">job1</span><span class="p">:</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.uenv-builder-eiger-zen2</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span><span class="nt">UENV_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prgenv-gnu</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">    </span><span class="nt">UENV_VERSION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24.10</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">    </span><span class="nt">UENV_RECIPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/uenv-recipes/prgenv-gnu/eiger-zen2</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="nt">job2</span><span class="p">:</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.uenv-builder-daint-gh200</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">    </span><span class="nt">UENV_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prgenv-gnu</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">    </span><span class="nt">UENV_VERSION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24.10</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">    </span><span class="nt">UENV_RECIPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ci/uenv-recipes/prgenv-gnu/daint-gh200</span>
</span></code></pre></div>
<h3 id="uenv-runner">uenv-runner<a class="headerlink" href="#uenv-runner" title="Permanent link">&para;</a></h3>
<p>This runner submits SLURM jobs through FirecREST.
See the <a href="#firecrest">comments below</a> and the <a class="autorefs autorefs-internal" href="../../access/firecrest/#firecrest">FirecREST documentation</a> for additional FirecREST information.</p>
<p>The naming for the runner is <code>.uenv-runner-&lt;CLUSTERNAME&gt;-&lt;MICROARCHITECTURE&gt;</code></p>
<p>The following runners are available:</p>
<ul>
<li><code>.uenv-runner-eiger-zen2</code></li>
<li><code>.uenv-runner-daint-gh200</code></li>
<li><code>.uenv-runner-santis-gh200</code></li>
<li><code>.uenv-runner-clariden-gh200</code></li>
</ul>
<p><code>uenv-runner</code> is very similar to <a href="#container-runner">container-runner</a>, the main difference is that you are running with a uenv image mounted instead of inside a container.</p>
<p>The uenv image is specified in the tag <code>image</code> in the job yaml.
This tag is mandatory.</p>
<h4 id="variables_4">Variables<a class="headerlink" href="#variables_4" title="Permanent link">&para;</a></h4>
<h5 id="with_uenv_view"><code>WITH_UENV_VIEW</code><a class="headerlink" href="#with_uenv_view" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is empty</p>
<p>Loads the view of a uenv.</p>
<h5 id="cscs_cuda_mps_1"><code>CSCS_CUDA_MPS</code><a class="headerlink" href="#cscs_cuda_mps_1" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is <code>NO</code></p>
<p>Enable running with <code>nvidia-mps-server</code>, which allows multiple ranks sharing the same GPU.</p>
<h4 id="example-jobs_4">Example jobs<a class="headerlink" href="#example-jobs_4" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nt">job1</span><span class="p">:</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.uenv-runner-eiger-zen2</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prgenv-gnu/24.7:v3</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc --version</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">    </span><span class="nt">WITH_UENV_VIEW</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;default&#39;</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="nt">job2</span><span class="p">:</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.uenv-runner-daint-gh200</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">gromacs/2024:v1</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gmx_mpi --version</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">    </span><span class="nt">WITH_UENV_VIEW</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;gromacs&#39;</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">    </span><span class="nt">SLURM_JOB_NUM_NODES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">    </span><span class="nt">SLURM_NTASKS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span></code></pre></div>
<h3 id="baremetal-runner">baremetal-runner<a class="headerlink" href="#baremetal-runner" title="Permanent link">&para;</a></h3>
<p>This runner submits SLURM jobs through FirecREST.
See the <a href="#firecrest">comments below</a> and the <a class="autorefs autorefs-internal" href="../../access/firecrest/#firecrest">FirecREST documentation</a> for additional FirecREST information.</p>
<p>The naming for the runner is <code>baremetal-runner-&lt;CLUSTERNAME&gt;-&lt;MICROARCHITECTURE&gt;</code></p>
<p>The following runners are available:</p>
<ul>
<li><code>.baremetal-runner-eiger-zen2</code></li>
<li><code>.baremetal-runner-daint-gh200</code></li>
<li><code>.baremetal-runner-santis-gh200</code></li>
<li><code>.baremetal-runner-clariden-gh200</code></li>
</ul>
<p>This runner mode is almost equivalent to writing a Slurm sbatch script.
Instead of <code>#SBATCH</code> instructions, you need to use the <code>SLURM_*</code>  variables to specify your Slurm requirements.
Otherwise all commands in <code>script</code> are executed only on the first allocated node.
To run with multiple ranks, the command in <code>script</code> must switch context via <code>srun</code>.</p>
<p>This runner has no additional variables.</p>
<h4 id="example-job">Example job<a class="headerlink" href="#example-job" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nt">job</span><span class="p">:</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.baremetal-runner-daint-gh200</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostname</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">srun -n 4 --uenv prgenv-gnu/24.7:v3 --view=default ./my_application</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span><span class="nt">SLURM_JOB_NUM_NODES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span></code></pre></div>
<h3 id="f7t-controller">f7t-controller<a class="headerlink" href="#f7t-controller" title="Permanent link">&para;</a></h3>
<p>This runner allows submitting jobs to Slurm clusters using <a class="autorefs autorefs-internal" href="../../access/firecrest/#firecrest">FirecREST</a>.</p>
<p>The following runners are available:</p>
<ul>
<li><code>.f7t-controller</code></li>
</ul>
<p>With this runner, all the dependencies for submitting jobs with FirecREST are already available in the environment.
You can either use the <a href="https://pyfirecrest.readthedocs.io/en/latest/reference_cli.html">client tool</a> <code>firecrest</code>, or a python script that uses the <a href="https://pyfirecrest.readthedocs.io/en/latest/index.html">pyfirecrest library</a>.
When the job starts, the runner will expose four environment variables, which are needed to allow submitting jobs through FirecREST, without further configuration.</p>
<ul>
<li><code>AUTH_TOKEN_URL</code>: This is the same value as the variable F7T_TOKEN_URL in the job description</li>
<li><code>FIRECREST_URL</code>: This is the same value as the variable F7T_URL  in the job description</li>
<li><code>FIRECREST_CLIENT_ID</code>: The value that is set the CI setup page in the admin section</li>
<li><code>FIRECREST_CLIENT_SECRET</code>: The value that is set in the CI setup page in the admin section</li>
</ul>
<p>A job can be submitted with the client, e.g. via
<div class="language-console highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="gp">$ </span>firecrest<span class="w"> </span>submit<span class="w"> </span>--system<span class="w"> </span>eiger<span class="w"> </span>--account<span class="w"> </span><span class="nv">$CSCS_CI_DEFAULT_SLURM_ACCOUNT</span><span class="w"> </span>my_script.sh
</span></code></pre></div></p>
<h4 id="example-job_1">Example job<a class="headerlink" href="#example-job_1" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nt">job</span><span class="p">:</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">  </span><span class="nt">extends</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.f7t-controller</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CLUSTER=eiger</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SUBMISSION=&quot;$(firecrest submit --system eiger --working-dir=/capstor/scratch/cscs/jenkssl/firecrest/$CI_JOB_ID script.sh)&quot;</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$SUBMISSION&quot;</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JOBID=$(echo &quot;$SUBMISSION&quot; | jq -r &#39;.jobId&#39;)</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">      </span><span class="no">while true ; do</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="w">        </span><span class="no">JOB_INFO=$(firecrest job-info --system eiger)</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w">        </span><span class="no">if echo $JOB_INFO | jq -r &quot;.[] | select(.jobId == $JOBID) | .status.state&quot; &gt;/dev/null ; then</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">          </span><span class="no">JOB_STATE=$(echo $JOB_INFO | jq -r &quot;.[] | select(.jobId == $JOBID) | .status.state&quot;)</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="w">          </span><span class="no">echo JOB_STATE=$JOB_STATE</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="w">          </span><span class="no">if [[ -n &quot;$JOB_STATE&quot; &amp;&amp; &quot;$JOB_STATE&quot; != &quot;RUNNING&quot; &amp;&amp; &quot;$JOB_STATE&quot; != &quot;PENDING&quot; ]] ; then</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">              </span><span class="no">echo &quot;Job finished&quot;</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="w">              </span><span class="no">break</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">          </span><span class="no">else</span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="w">              </span><span class="no">echo &quot;job is still in queue/running&quot;</span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="w">          </span><span class="no">fi</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">        </span><span class="no">else</span>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="w">          </span><span class="no">echo &quot;Failed parsing JOB_INFO response as json, retrying to fetch job info&quot;</span>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="w">        </span><span class="no">fi</span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="w">        </span><span class="no">sleep 30</span>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="w">      </span><span class="no">done</span>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a><span class="w">    </span><span class="nt">F7T_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://api.cscs.ch/hpc/firecrest/v2&#39;</span>
</span></code></pre></div>
<h3 id="reframe-runner">reframe-runner<a class="headerlink" href="#reframe-runner" title="Permanent link">&para;</a></h3>
<p>This runner will run <a href="https://reframe-hpc.readthedocs.io/en/stable/index.html">ReFrame</a>.</p>
<p>The following runners are available:</p>
<ul>
<li><code>.reframe-runner</code></li>
</ul>
<p>ReFrame jobs are submitted with FirecREST.
This runner is a thin wrapper over the <a href="#f7t-controller">f7t-controller</a>.
The machine where ReFrame is running does not have to be a powerful machine, hence it does not make sense to start the main ReFrame process from a compute node.
It makes more sense to start the ReFrame process on a cloud machine and submit the compute jobs through FirecREST to the actual cluster.</p>
<p>The easiest way to use the FirecREST scheduler of ReFrame is to use the configuration files that are provided in the main branch of the <a href="https://github.com/eth-cscs/cscs-reframe-tests">CSCS Reframe tests repository</a>.
In case you want to run ReFrame for a system that is not already available in this directory, please open a ticket to the Service Desk and we will add it or help you update one of the existing ones.</p>
<p>Something you should be aware of when running with this scheduler is that ReFrame will not have direct access to the filesystem of the cluster so the stage directory will need to be kept in sync through FirecREST.
It is recommended to try to clean the stage directory whenever possible with the <a href="https://reframe-hpc.readthedocs.io/en/stable/regression_test_api.html#reframe.core.pipeline.RegressionTest.postrun_cmds"><code>postrun_cmds</code></a> and <a href="https://reframe-hpc.readthedocs.io/en/stable/regression_test_api.html#reframe.core.pipeline.RegressionTest.postbuild_cmds"><code>postbuild_cmds</code></a> and to avoid <a href="https://reframe-hpc.readthedocs.io/en/stable/config_reference.html#config.systems.partitions.processor">autodetection of the processor</a> in each run.
Normally ReFrame stores these files in <code>~/.reframe/topology/{system}-{part}/processor.json</code>, but you get a &ldquo;clean&rdquo; runner every time.
You could either add them in the configuration files or store the files in the first run and copy them to the right directory before ReFrame runs.</p>
<p>Finally, you can find some more information <a href="https://github.com/eth-cscs/cscs-reframe-tests/blob/main/config/systems-firecrest/README.md">in the repository</a>.</p>
<p>The default command that is executed is
<div class="language-console highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="gp">$ </span>reframe<span class="w"> </span>-C<span class="w"> </span><span class="nv">$RFM_CONFIG</span><span class="w"> </span>-c<span class="w"> </span><span class="nv">$RFM_CHECKPATH</span><span class="w"> </span>-Sbuild_locally<span class="o">=</span><span class="m">0</span><span class="w"> </span>--report-junit<span class="o">=</span>report.xml<span class="w"> </span>-r
</span></code></pre></div>
This default can be overwritten, by providing a user-defined <code>script</code> tag in the job.</p>
<h4 id="variables_5">Variables<a class="headerlink" href="#variables_5" title="Permanent link">&para;</a></h4>
<h5 id="rfm_version"><code>RFM_VERSION</code><a class="headerlink" href="#rfm_version" title="Permanent link">&para;</a></h5>
<p>Optional variable, default is a recent version of ReFrame</p>
<p>This reframe version will be installed and is available to the job.</p>
<h5 id="rfm_config"><code>RFM_CONFIG</code><a class="headerlink" href="#rfm_config" title="Permanent link">&para;</a></h5>
<p>Mandatory variable, default is empty</p>
<p>The path to the config that is passed to <code>reframe</code> via <code>-C</code>.</p>
<h5 id="rfm_checkpath"><code>RFM_CHECKPATH</code><a class="headerlink" href="#rfm_checkpath" title="Permanent link">&para;</a></h5>
<p>Mandatory variable, default is empty</p>
<p>The path to the checks that is passed to <code>reframe</code> through <code>-c</code>.</p>
<h4 id="example-job_2">Example job<a class="headerlink" href="#example-job_2" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nt">job</span><span class="p">:</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git clone https://github.com/eth-cscs/cscs-reframe-tests</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r cscs-reframe-tests/config/utilities/requirements.txt</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sed -i -e &quot;s/account=csstaff/account=$CSCS_CI_DEFAULT_SLURM_ACCOUNT/&quot; cscs-reframe-tests/config/systems-firecrest/eiger.py</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">    </span><span class="nt">FIRECREST_SYSTEM</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;eiger&#39;</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">    </span><span class="nt">FIRECREST_BASEDIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/capstor/scratch/cscs/jenkssl/reframe-runner</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">    </span><span class="nt">RFM_FIRECREST</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1&#39;</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">    </span><span class="nt">RFM_CONFIG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cscs-reframe-tests/config/cscs.py</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">    </span><span class="nt">RFM_CHECKPATH</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cscs-reframe-tests/checks/microbenchmarks/mpi/halo_exchange</span>
</span></code></pre></div>
<h3 id="firecrest">FirecREST<a class="headerlink" href="#firecrest" title="Permanent link">&para;</a></h3>
<p>This is not a runner per se, but since most runners are built on top of <a class="autorefs autorefs-internal" href="../../access/firecrest/#firecrest">FirecREST</a> some relevant notes how CI is interacting with FirecREST.</p>
<p>The terms <code>Client ID</code> and <code>Consumer Key</code> are meaning the same thing.
In the <a href="https://developer.cscs.ch">developer portal</a> they are called <code>Consumer Key</code> and <code>Consumer Secret</code>, while the standard naming would be <code>Client ID</code> and <code>Client Secret</code>.</p>
<p>CI will submit jobs with the FirecREST client id/secret that have been stored at the project&rsquo;s <a href="https://cicd-ext-mw.cscs.ch">CI setup page</a> (Admin section).
Storing the client id/secret is mandatory, because most runners will not work without these credentials.</p>
<p>The credentials are tied to a CSCS username, hence the pipeline will run within the context of this user.
It is possible and encouraged to request with a Service Desk ticket a CI service account.
Then the FirecREST credentials can be tied to the CI service account.</p>
<p>You will always need 4 pieces of information to interact with FirecREST:</p>
<ul>
<li>Token dispenser URL</li>
<li>API endpoint URL</li>
<li>Client ID</li>
<li>Client Secret</li>
</ul>
<p>In the CI context the token dispenser URL is passed with the variable <code>F7T_TOKEN_URL</code>, the API endpoint is passed with the variable <code>F7T_URL</code>.
The client ID/Secret are stored in the CI setup page.
The client ID/Secret can be overridden on a per-job basis.
The variables for overriding are <code>F7T_CLIENT_ID</code>  and <code>F7T_CLIENT_SECRET</code>.</p>
<p>In a nutshell, the client ID and client secret are used to request from the token dispenser URL an access token.
The token dispenser will reply with an access token, if and only if the client ID/secret pair is valid.
This access token is then used to authorize the API requests that are being sent to the FirecREST API endpoint.</p>
<p>The documented runners above, set the correct <code>F7T_TOKEN_URL</code>  and <code>F7T_URL</code> for the clusters.
When you are running on the <a href="#f7t-controller">f7t-controller</a> runner, then you might have to modify the default variables, because this runner is not targeting a specific cluster, but it can target different clusters in the same job.
Targeting different clusters in the same job can require to provide different <code>F7T_URL</code>.
The <code>F7T_TOKEN_URL</code> is currently the same for all clusters.</p>
<h2 id="example-projects">Example projects<a class="headerlink" href="#example-projects" title="Permanent link">&para;</a></h2>
<p>A couple of projects which use this CI setup.
Please have a look there for more advanced usage:</p>
<ul>
<li><a href="https://github.com/DComEX/dcomex-framework">dcomex-framework</a>: entry point is <code>ci/prototype.yml</code></li>
<li><a href="https://bitbucket.org/zulianp/mars/src/development/">mars</a>: two pipelines, with entry points <code>ci/gitlab/cscs/gpu/gitlab-daint.yml</code> and <code>ci/gitlab/cscs/mc/gitlab-daint.yml</code></li>
<li><a href="https://github.com/lab-cosmo/sparse_accumulation">sparse_accumulation</a>: entry point is <code>ci/pipeline.yml</code></li>
<li><a href="https://github.com/GridTools/gt4py">gt4py</a>: entry point is <code>ci/cscs-ci.yml</code></li>
<li><a href="https://github.com/electronic-structure/SIRIUS">SIRIUS</a>: entry point is <code>ci/cscs-daint.yml</code></li>
<li><a href="https://github.com/lab-cosmo/sphericart">sphericart</a>: entry point is <code>ci/pipeline.yml</code></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.action.edit", "navigation.indexes", "search.share", "navigation.instant", "navigation.tracking", "navigation.path", "navigation.top", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>